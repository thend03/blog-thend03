<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ssh配置 | fayy&amp;fc</title>
<meta name=keywords content="ssh"><meta name=description content="ssh配置"><meta name=author content="since"><link rel=canonical href=https://blog1.thend03.com/posts/ssh-config/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://blog1.thend03.com/img/logo.jpg><link rel=icon type=image/png sizes=16x16 href=https://blog1.thend03.com/img/logo.jpg><link rel=icon type=image/png sizes=32x32 href=https://blog1.thend03.com/img/logo.jpg><link rel=apple-touch-icon href=https://blog1.thend03.com/img/logo.jpg><link rel=mask-icon href=https://blog1.thend03.com/img/logo.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://blog1.thend03.com/posts/ssh-config/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="ssh配置"><meta property="og:description" content="ssh配置"><meta property="og:type" content="article"><meta property="og:url" content="https://blog1.thend03.com/posts/ssh-config/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-19T14:40:56+08:00"><meta property="article:modified_time" content="2023-10-19T14:40:56+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ssh配置"><meta name=twitter:description content="ssh配置"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"📚文章","item":"https://blog1.thend03.com/posts/"},{"@type":"ListItem","position":2,"name":"ssh配置","item":"https://blog1.thend03.com/posts/ssh-config/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ssh配置","name":"ssh配置","description":"ssh配置","keywords":["ssh"],"articleBody":"ssh在了Iinux系统中有着比较重要的位置，想要远程连接服务器进行操作，ssh是不可或缺的步骤。\n我有一台海外的vps，系统是ubuntu，由于使用的机场把22端口封了，导致ssh连接vps非常的不方便，连接一直报如下的错\n ~/ ssh root@107.173.87.238 -p 22 kex_exchange_identification: Connection closed by remote host Connection closed by 107.173.87.238 port 22  ~/ 咨询过机场，机场方出于端口被滥用的目的，将22端口封禁了，这就会导致想使用ssh连接vps，或者使用github ssh，要先关闭代理，关了代理之后其他的网站又无法访问了，非常的麻烦。\n所以本文以此为背景，了解下ssh的配置，达到更换端口，不受限制的目的。\n另外为了使用简便出发，介绍下使用私钥登录，以及将登录配置写进配置文件，以简化连接。\n背景知识 什么是ssh 简单说，SSH是一种网络协议，用于计算机之间的加密登录。使用ssh我们可以从本地机器连接到远程的服务器。\nssh的简单使用 一般我们有2种方式进行ssh连接，一个是使用账号密码，另一个是使用公私钥进行连接\n以账号密码的方式登录,\n ~/ ssh root@107.173.87.238 -p 22 root@107.173.87.238's password: 解释下如上命令\nssh就是我们本文介绍的工具 root是要登录的目标机器的用户 107.173.87.238是我们要登录的服务端的ip -p是指定使用连接的服务端的端口，默认是22 本次目标就是修改22端口，使用别的端口进行ssh连接\n命令行输入命令回车之后，需要我们输入服务端机器的root账号的密码，输入成功之后，就会登录到107.173.87.238，可以使用root账号在这台机器进行操作了。\n另一种是使用秘钥的方式进行登录，首先是生成公钥和私钥，私钥客户端机器自己留着，公钥上传到服务端机器\n ~/ ssh -i ~/.ssh/racknerd_107.173.87.238 -p 2222 root@107.173.87.238 如果私钥正确，输入如上命令回车即可登录远端机器\n-i是指定私钥文件 ~/.ssh/racknerd_107.173.87.238,是我用工具生成的私钥文件 -p是指定连接的端口，默认是22，这里是我修改过的 root@107.173.87.238是指以root用户登录远端机器 修改ssh连接端口 我们主要是要把默认的22端口改掉，换成其他的没有被禁用的端口，保证挂代理的同时，可以使用ssh访问远端服务器\n基本概念 ssh客户端: 这个是我们要通过某台机器访问目标端的机器，假如我们想在自己的电脑上，使用命令行或者xshell/putty等工具连接服务器，那我们的命令行、xshell、putty等就是ssh客户端\nssh服务端: 我们要连接的目标机器\n机器信息 本次服务端是购买的一台vps，系统是ununtu 22.04 LTS\nroot@racknerd-7c9c56:~# uname -a Linux racknerd-7c9c56 5.15.0-76-generic #83-Ubuntu SMP Thu Jun 15 19:16:32 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux root@racknerd-7c9c56:~# lsb_release -a No LSB modules are available. Distributor ID:\tUbuntu Description:\tUbuntu 22.04.2 LTS Release:\t22.04 Codename:\tjammy 客户端是我自己的电脑，命令行执行ssh命令\n修改ssh连接端口 ubuntu系统的ssh配置在/ect/ssh下\n我们如果想修改服务端端口的话，可以选择直接修改sshd_config的文件。\n这里有一个注意点，我们可以放开22端口的注释，然后在port 22下面新增一个port 2222的配置，这样就可以通过22和2222进行ssh连接，如果2222配置错误，我们还可以留有余地，使用22端口进行连接。\n这里解释下ssh_config和sshd_config的区别，ssh_config是ssh客户端的配置，sshd_config是服务端的配置。\n由于我们这次是修改服务端的配置，所以我们需要修改sshd_config的配置\n如果不想修改现有文件，导致错误的话，其实也可以在sshd_config.d/目录下新增xxx.conf文件，在里面新增配置，在这个目录添加配置文件可以生效是因为sshd_config文件里引入了sshd_config.d/*.conf文件\n我是在目录下新建了一个my_sshd.conf文件\n里面有如下配置项，可以看到配置了2个端口，22和2222，如果sshd_config文件里已经放开了22端口，则可以只添加2222\nPort 22 Port 2222 然后将2222端口加入防火墙以放行端口\n使用iptables则执行如下命令\niptables -A INPUT -p tcp --dport 2222 -j ACCEPT 如果使用firewall-cmd则执行如下命令\nfirewall-cmd --zone=public --add-port=2222/tcp --permanent firewall-cmd --reload 如果是公有云平台，则在对应公有云平台的安全组进行设置\n然后执行如下命令重启sshd，则服务端的配置就重启好了\nsudo service sshd restart 执行命令查看ssh端口是否可以启动\nnetstat -nlp|grep 22 可以看到22和2222端口都以正常启动\n接下来就可以使用ssh命令进行连接了，使用 ssh -p 2222 root@107.173.87.238进行账号密码连接，这样就可以避免22端口被禁导致的连接失败的问题了\n详细步骤 这一步只讲步骤，不讲其他的额外知识\n1.使用ssh -p 22 root@107.173.87.238连接到机器上，我们的任何修改都是要先连接到目标机器上，所以这次我们还是先使用22端口连接上去进行修改\n2.在/etc/ssh/sshd_config.d/目录下新增my_sshd.conf文件, 然后使用vim编辑my_sshd.conf,将新的端口配置写入my_sshd.conf里\n首先执行cd /etc/ssh/sshd_config.d/，进入要修改的目录 然后执行touch my_sshd.conf，新增配置文件 执行vim my_sshd.conf ，编辑文件，添加Port 22和Port 22222个端口配置(分2行，详情见上方)，修改完之前:wq保存 最后检查/etc/ssh/sshd_config，看文件里的PermitRootLogin yes配置项是否打开，如果被注释掉，需要去掉#，值为no的话需要修改为yes，这样可以支持使用root用户登录 3.将2222端口添加到防火墙\n如果使用iptables则执行如下命令iptables -A INPUT -p tcp --dport 2222 -j ACCEPT 如果是firewall-cmd则执行如下命令firewall-cmd --zone=public --add-port=2222/tcp --permanent 然后执行reload加载firewall-cmd --reload 如果是公有云则去对应厂商的网络安全策略那里修改 4.重启sshd服务,使用如下命令sudo service sshd restart\n5.重启之后验证端口是否正常启动，使用netstat -nlp|grep 22查看端口占用，如果22和2222都已经启动，则sshd服务正常，否则需要检查原因\n6.客户端重新连接，验证22和2222端口功能是否正常，分别使用ssh -p 22 root@107.173.87.238和ssh -p 2222 root@107.173.87.238，如果2个都能正常连接，则修改成功\n使用公钥和私钥进行连接 在上一步中我们修改了ssh连接的端口，可以使用2222端口进行ssh连接，免去了代理封禁了22端口的困扰。但是每次进行连接的时候总要输一大串的连接命令，还要输入繁杂的密码，相信机器的密码都不会太简单，每次复制粘贴密码比较繁琐。\n那么ssh除了账号密码的方式，还支持公私钥的方式，客户端拿着私钥去连接服务端，我们这一小节就介绍ssh使用秘钥进行连接的方式\n生成公钥和私钥 我们可以使用ssh-keygen命令生成秘钥\n ~/ ssh-keygen -t rsa -f ~/.ssh/test -b 4096 Generating public/private rsa key pair. Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in test Your public key has been saved in test.pub The key fingerprint is: SHA256:yL155XDEOzFmSlHcOvUVTyOrduhjWtfakA9gJhVWBUg since@fengchuangdeMacBook-Pro.local The key's randomart image is: +---[RSA 4096]----+ | oE+=o+o| | .+o =.+| | ..B+ .o| | . o ..==+ .| | o S.oB=o | | o*=o.o | | o .=.= . | | .+ o * | | . . o | +----[SHA256]-----+ 解释下这个命令，这个命令是用来生成ssh密钥对的\n-t用于指定使用的加密算法，支持如下几种加密算法: dsa 、 ecdsa 、 ecdsa-sk 、 ed25519 、 ed25519-sk 、 rsa -b是bits，用来指定生成的密钥对的密钥位数，上述命令是生成4096位密钥文件 -f用于指定生成的秘钥文件名称和存储路径，不止定-f的话会默认生成~/.ssh/id_rsa和~/.ssh/id_rsa.pub -C用于添加评论，本次命令没有使用这个参数 使用上述命令就生成了一个可用的ssh秘钥对，其中~/.ssh/test文件是私钥，ssh客户端连接服务端的时候拿私钥进行连接，~/.ssh/test.pub是公钥文件，需要上传到服务端，客户端连接请求过来的时候，服务端拿着公钥判断权限用的，关于服务端公钥配置，待会再详细介绍。\n服务端设置公钥 上一步生成公钥和私钥之后，私钥客户端留着自己连接的时候用，公钥需要上传到要连接的服务端，建立ssh连接的时候，服务端使用公钥进行鉴权，这一小节介绍服务端如何设置公钥文件\n以下操作会指明各个文件和步骤是服务端操作还是客户端操作，请明确操作环境。\n目前的大前提我们只配置了账号密码登录，配置了22和2222端口用于进行ssh连接。\n首先我们在客户端有~/.ssh/test.pub这个公钥文件，我们需要把公钥信息上传到服务端去，可以看到公钥文件里是一些加密后的字符串，如何把公钥文件上传到服务端，有如下几种方式\n第一种是使用ssh-copy-id\n我们使用ssh-copy-id将test.pub公钥文件，从客户端机器上传到服务端\n ~/.ssh/ ssh-copy-id -i ./test.pub -p 2222 root@107.173.87.238 /usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: \"./test.pub\" /usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed /usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys root@107.173.87.238's password: Number of key(s) added: 1 Now try logging into the machine, with: \"ssh -p '2222' 'root@107.173.87.238'\" and check to make sure that only the key(s) you wanted were added. 看上方的命令和执行结果，-i指定要上传的公钥文件，-p指定端口，其中需要我们输入root账号的密码，然后可以看到公钥就被成功安装了。\n然后上服务器检查，可以发现~下原来没有.ssh文件夹，也没有~/.ssh/authorized_keys文件，ssh-copy-id为我们创建了目录和文件，且把公钥文件写入到authorized_keys文件里了。\n如果没有/root/.ssh文件以及/root/.ssh/authorized_keys文件，需要手动创建目录和文件，再执行上述的ssh-copy-id命令。\n然后在服务端执行以下2个命令,切记要复制这2个命令执行，不要随意修改\nchmod 700 ~/.ssh chmod 600 ~/.ssh/authorized_keys 然后检查~/.ssh/authorized_keys的文件内容是否和test.pub一致，如果一致那就上传公钥成功了\n然后就可以在客户端执行ssh命令进行连接了，尝试一下，可以看到已经可以正常连接了\n ~/.ssh/ ssh -i ~/.ssh/test -p 2222 root@107.173.87.238 root@racknerd-7c9c56:~# 第二种是使用ssh命令执行上传和写入\n第二种我们使用ssh命令，读取test.pub，并执行命令写入服务端的~/.ssh/authorized_keys文件，再执行第2种之前，我们先删掉服务器上的~/.ssh目录，然后再执行命令上传\n详细命令如下,执行之后输入密码，即可将本地的公钥文件写入服务端的~/.ssh/authorized_keys文件里\n ~/.ssh/ ssh -p 2222 root@107.173.87.238 'mkdir -p ~/.ssh \u0026\u0026 cat \u003e\u003e ~/.ssh/authorized_keys' \u003c ~/.ssh/test.pub root@107.173.87.238's password: 这个命令里包含了多个步骤，依次解释下命令含义\nssh -p 2222 root@107.173.87.238这个就是使用ssh连接服务端 mkdir -p ~/.ssh是在服务端创建~/.ssh目录 ‘cat » .ssh/authorized_keys’ \u003c ~/.ssh/id_rsa.pub的作用是，将本地的公钥文件~/.ssh/id_rsa.pub，重定向追加到远程文件authorized_keys的末尾，注意»表示的是追加写入，不会覆盖原文件 然后在服务端执行以下2个命令,切记要复制这2个命令执行，不要随意修改\nchmod 700 ~/.ssh chmod 600 ~/.ssh/authorized_keys 然后就可以在客户端执行ssh命令进行连接了，尝试一下，可以看到已经可以正常连接了\n ~/.ssh/ ssh -i ~/.ssh/test -p 2222 root@107.173.87.238 root@racknerd-7c9c56:~# 第三种是使用scp命令，先将本地的公钥文件上传到服务端，然后在服务端执行cat命令将公钥文件内容写入authorized_keys文件\n第三种就是先将客户端本地的公钥文件上传到服务端，然后使用ssh连接到服务端，执行命令将公钥文件内容写入authorized_keys文件\n照例先删除服务端的~/.ssh文件夹，具体命令如下\n ~/.ssh/ scp -P 2222 ~/.ssh/test.pub root@107.173.87.238:~/ root@107.173.87.238's password: Permission denied, please try again. root@107.173.87.238's password: test.pub 解释下具体的含义，这行命令就是使用scp将客户端本地的~/.ssh/test.pub文件上传到服务端的~/目录下，注意P是大写，代表连接使用的端口\n然后ssh连接到服务端，使用如下命令创建~/.ssh目录和~/.ssh/authorized_keys文件\nmkdir ~/.ssh touch ~/.ssh/authorized_keys 然后服务端执行如下命令授权，不要随意修改\nchmod 700 ~/.ssh chmod 600 ~/.ssh/authorized_keys 然后执行cat命令，将已经上传到服务器的test.pub文件的内容写入~/.ssh/authorized_keys\ncat ~/test.pub \u003e\u003e ~/.ssh/authorized_keys 然后就可以在客户端执行ssh命令进行连接了，尝试一下，可以看到已经可以正常连接了\n ~/.ssh/ ssh -i ~/.ssh/test -p 2222 root@107.173.87.238 root@racknerd-7c9c56:~# 接下来有些注意事项，如果使用ssh -i无法连接，需要检查下/etc/ssh/sshd_config这个文件，看看如下几个配置项是否被注释掉\n如果有#就是被注释了，未生效，需要去掉#号放开，放开之后需要执行service sshd restart重启服务端ssh服务\nRSAAuthentication yes PubkeyAuthentication yes AuthorizedKeysFile .ssh/authorized_keys 综合看下来，还是使用ssh-copy-id比较简单省事，其他两种为我们展示了具体的为服务端添加公钥的过程\n详细步骤 以ssh-copy-id为例，说明下详细步骤\n1.执行ssh-copy-id命令将客户端公钥文件上传到服务端ssh-copy-id -i ./test.pub -p 2222 root@107.173.87.238\n2.检查服务端是否存在~/.ssh目录，是否存在~/.ssh/authorized_keys文件，如果任一不存在，则执行mkdir ~/.ssh \u0026\u0026touch ~/.ssh/authorized_keys 创建路径和文件之后，重复执行第一步\n3.执行命令为服务端公钥文件授权,需要执行chmod 700 ~/.ssh和chmod 600 ~/.ssh/authorized_keys\n4.检查服务端~/.ssh/authorized_keys文件内容是否和客户端的公钥文件内容一致，一致则说明上传成功\n5.客户端使用ssh -i ~/.ssh/test -p 2222 root@107.173.87.238尝试连接，如果成功则添加秘钥方式修改成功\n6.如果客户端连接失败，检查下/etc/ssh/sshd_config文件的RSAAuthentication，PubkeyAuthentication，AuthorizedKeysFile等key是否放开，如果注释掉需要放开，执行``service sshd restart`重启sshd服务\nssh使用config进行登录 上面2种登录方式，不管是使用使用用户密码，还是使用公私钥，都需要在命令行输入一大串命令，比较繁琐。\n使用命令行进行ssh连接的时候，虽然有历史记录，但仍比较繁琐，需要频繁复制输入密码，有了私钥认证之后好一点，但还是比较繁琐。\n本小节介绍如何使用配置文件的方式，将连接配置写到配置文件里，简化操作，提高使用ssh连接的效率\nssh有个配置文件，路径是~/.ssh/config，可以在这个文件里面配置ssh连接信息，另外一个配置文件地址是/etc/ssh/ssh_config，这个上一小节有介绍\n我本地有如下3个配置，写在了~/.ssh/config文件里\nHost github.com HostName ssh.github.com User git Port 443 Host vps-racknerd-id HostName 107.173.87.238 User root Port 2222 IdentityFile ~/.ssh/test Host vps-racknerd-pwd HostName 107.173.87.238 User root Port 2222 第一个是github的配置，由于22端口被封，每次git push非常的费劲，后面根据搜索，将端口换成了443,问题得以解决\n第二个是vps的配置，使用了私钥文件鉴权的方式\n第三个是vps的配置，使用了用户密码的鉴权方式\n解释下配置项的含义\nHost配置的要连接的主机名，github的Host好像是固定的，github.com， *为默认值，匹配所有的Host的行为，我理解这里的Host可以相当于别名使用了，ssh 匹配Host，然后执行Host的逻辑 HostName，这个是指定ssh连接的目标地址，可以是域名，也可以是ip User是指定ssh连接的用户 Port是指定ssh连接的端口 IdentityFile是指定的ssh连接的私钥文件地址 我本地连接vps,现在可以使用vps-racknerd-id和vps-racknerd-id进行连接了\n使用vps-racknerd-pwd，还是使用用户密码的方式登录，仍需输入用户对应的密码，优点是少输很多东西\n /etc/ssh/ ssh vps-racknerd-pwd root@107.173.87.238's password: root@racknerd-7c9c56:~# 使用vps-racknerd-id，使用私钥方式登录，不用输入密码，即可直接连接，只需执行一步就可连接\n ~/.ssh/ ssh vps-racknerd-id root@racknerd-7c9c56:~# 总结 本文介绍了3个功能: 修改ssh默认端口，使用私钥登录，使用配置进行登录\n第一个功能实现了修改端口，可以避免代理禁用22端口导致的连接问题\n第二个功能实现了使用私钥文件登录，不用再每次输入密码\n第三个功能实现了将配置信息写到config文件里，简化了连接的命令\n上面介绍的是命令行使用ssh连接的方式，如果有条件的话，可以使用其他的ssh客户端，比如xshell、putty、secureCRT、mobaXterm等工具，这些工具带了界面，可以在界面上进行操作，并且有秘钥文件管理和存储密码的功能\n参考链接 openssh config file examples for linux/unix\nSSH原理与运用-阮一峰\n设置SSH通过秘钥登录\nSSH教程\n","wordCount":"6616","inLanguage":"zh","datePublished":"2023-10-19T14:40:56+08:00","dateModified":"2023-10-19T14:40:56+08:00","author":{"@type":"Person","name":"since"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog1.thend03.com/posts/ssh-config/"},"publisher":{"@type":"Organization","name":"fayy\u0026fc","logo":{"@type":"ImageObject","url":"https://blog1.thend03.com/img/logo.jpg"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog1.thend03.com/ accesskey=h title="fayy&amp;fc (Alt + H)"><img src=https://blog1.thend03.com/img/logo.jpg alt=logo aria-label=logo height=35>fayy&amp;fc</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://blog1.thend03.com/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li><li><a href=https://blog1.thend03.com/ title="🏠 主页"><span>🏠 主页</span></a></li><li><a href=https://blog1.thend03.com/tags title="🧩 标签"><span>🧩 标签</span></a></li><li><a href=https://blog1.thend03.com/archives/ title="⏱️ 归档"><span>⏱️ 归档</span></a></li><li><a href=https://blog1.thend03.com/about title="🙋🏻‍♂️ 关于"><span>🙋🏻‍♂️ 关于</span></a></li><li><a href=https://blog1.thend03.com/links title="🤝 友链"><span>🤝 友链</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://blog1.thend03.com/>🏠 主页</a>&nbsp;»&nbsp;<a href=https://blog1.thend03.com/posts/>📚文章</a></div><h1 class=post-title>ssh配置</h1><div class=post-description>ssh配置</div><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2023-10-19
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>6616字
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>14分钟
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>since
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://blog1.thend03.com/tags/ssh/ style=color:var(--secondary)!important>Ssh</a>
</span></span></span></span><span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;
</span></span><span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://blog1.thend03.com/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:null,region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e8%83%8c%e6%99%af%e7%9f%a5%e8%af%86 aria-label=背景知识>背景知识</a><ul><li><a href=#%e4%bb%80%e4%b9%88%e6%98%afssh aria-label=什么是ssh>什么是ssh</a></li><li><a href=#ssh%e7%9a%84%e7%ae%80%e5%8d%95%e4%bd%bf%e7%94%a8 aria-label=ssh的简单使用>ssh的简单使用</a></li></ul></li><li><a href=#%e4%bf%ae%e6%94%b9ssh%e8%bf%9e%e6%8e%a5%e7%ab%af%e5%8f%a3 aria-label=修改ssh连接端口>修改ssh连接端口</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5 aria-label=基本概念>基本概念</a></li><li><a href=#%e6%9c%ba%e5%99%a8%e4%bf%a1%e6%81%af aria-label=机器信息>机器信息</a></li><li><a href=#%e4%bf%ae%e6%94%b9ssh%e8%bf%9e%e6%8e%a5%e7%ab%af%e5%8f%a3-1 aria-label=修改ssh连接端口>修改ssh连接端口</a></li><li><a href=#%e8%af%a6%e7%bb%86%e6%ad%a5%e9%aa%a4 aria-label=详细步骤>详细步骤</a></li></ul></li><li><a href=#%e4%bd%bf%e7%94%a8%e5%85%ac%e9%92%a5%e5%92%8c%e7%a7%81%e9%92%a5%e8%bf%9b%e8%a1%8c%e8%bf%9e%e6%8e%a5 aria-label=使用公钥和私钥进行连接>使用公钥和私钥进行连接</a><ul><li><a href=#%e7%94%9f%e6%88%90%e5%85%ac%e9%92%a5%e5%92%8c%e7%a7%81%e9%92%a5 aria-label=生成公钥和私钥>生成公钥和私钥</a></li><li><a href=#%e6%9c%8d%e5%8a%a1%e7%ab%af%e8%ae%be%e7%bd%ae%e5%85%ac%e9%92%a5 aria-label=服务端设置公钥>服务端设置公钥</a></li><li><a href=#%e8%af%a6%e7%bb%86%e6%ad%a5%e9%aa%a4-1 aria-label=详细步骤>详细步骤</a></li></ul></li><li><a href=#ssh%e4%bd%bf%e7%94%a8config%e8%bf%9b%e8%a1%8c%e7%99%bb%e5%bd%95 aria-label=ssh使用config进行登录>ssh使用config进行登录</a></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=总结>总结</a></li><li><a href=#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5 aria-label=参考链接>参考链接</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>ssh在了Iinux系统中有着比较重要的位置，想要远程连接服务器进行操作，ssh是不可或缺的步骤。</p><p>我有一台海外的vps，系统是ubuntu，由于使用的机场把22端口封了，导致ssh连接vps非常的不方便，连接一直报如下的错</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> ~/ ssh root@107.173.87.238 -p <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>kex_exchange_identification: Connection closed by remote host
</span></span><span style=display:flex><span>Connection closed by 107.173.87.238 port <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span> ~/
</span></span></code></pre></div><p>咨询过机场，机场方出于端口被滥用的目的，将22端口封禁了，这就会导致想使用ssh连接vps，或者使用github ssh，要先关闭代理，关了代理之后其他的网站又无法访问了，非常的麻烦。</p><p>所以本文以此为背景，了解下ssh的配置，达到更换端口，不受限制的目的。</p><p>另外为了使用简便出发，介绍下使用私钥登录，以及将登录配置写进配置文件，以简化连接。</p><h2 id=背景知识>背景知识<a hidden class=anchor aria-hidden=true href=#背景知识>#</a></h2><h3 id=什么是ssh>什么是ssh<a hidden class=anchor aria-hidden=true href=#什么是ssh>#</a></h3><p>简单说，SSH是一种网络协议，用于计算机之间的加密登录。使用ssh我们可以从本地机器连接到远程的服务器。</p><h3 id=ssh的简单使用>ssh的简单使用<a hidden class=anchor aria-hidden=true href=#ssh的简单使用>#</a></h3><p>一般我们有2种方式进行ssh连接，一个是使用账号密码，另一个是使用公私钥进行连接</p><p>以账号密码的方式登录,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> ~/ ssh root@107.173.87.238 -p <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>root@107.173.87.238<span style=color:#960050;background-color:#1e0010>&#39;</span>s password:
</span></span></code></pre></div><p>解释下如上命令</p><ul><li>ssh就是我们本文介绍的工具</li><li>root是要登录的目标机器的用户</li><li>107.173.87.238是我们要登录的服务端的ip</li><li>-p是指定使用连接的服务端的端口，默认是22</li></ul><p>本次目标就是修改22端口，使用别的端口进行ssh连接</p><p>命令行输入命令回车之后，需要我们输入服务端机器的root账号的密码，输入成功之后，就会登录到107.173.87.238，可以使用root账号在这台机器进行操作了。</p><p>另一种是使用秘钥的方式进行登录，首先是生成公钥和私钥，私钥客户端机器自己留着，公钥上传到服务端机器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> ~/ ssh -i ~/.ssh/racknerd_107.173.87.238 -p <span style=color:#ae81ff>2222</span> root@107.173.87.238
</span></span></code></pre></div><p>如果私钥正确，输入如上命令回车即可登录远端机器</p><ul><li>-i是指定私钥文件</li><li><code>~/.ssh/racknerd_107.173.87.238</code>,是我用工具生成的私钥文件</li><li>-p是指定连接的端口，默认是22，这里是我修改过的</li><li><a href=mailto:root@107.173.87.238>root@107.173.87.238</a>是指以root用户登录远端机器</li></ul><h2 id=修改ssh连接端口>修改ssh连接端口<a hidden class=anchor aria-hidden=true href=#修改ssh连接端口>#</a></h2><p>我们主要是要把默认的22端口改掉，换成其他的没有被禁用的端口，保证挂代理的同时，可以使用ssh访问远端服务器</p><h3 id=基本概念>基本概念<a hidden class=anchor aria-hidden=true href=#基本概念>#</a></h3><p>ssh客户端: 这个是我们要通过某台机器访问目标端的机器，假如我们想在自己的电脑上，使用命令行或者xshell/putty等工具连接服务器，那我们的命令行、xshell、putty等就是ssh客户端</p><p>ssh服务端: 我们要连接的目标机器</p><h3 id=机器信息>机器信息<a hidden class=anchor aria-hidden=true href=#机器信息>#</a></h3><p>本次服务端是购买的一台vps，系统是ununtu 22.04 LTS</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>root@racknerd-7c9c56:~# uname -a
</span></span><span style=display:flex><span>Linux racknerd-7c9c56 5.15.0-76-generic <span style=color:#75715e>#83-Ubuntu SMP Thu Jun 15 19:16:32 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@racknerd-7c9c56:~# lsb_release -a
</span></span><span style=display:flex><span>No LSB modules are available.
</span></span><span style=display:flex><span>Distributor ID:	Ubuntu
</span></span><span style=display:flex><span>Description:	Ubuntu 22.04.2 LTS
</span></span><span style=display:flex><span>Release:	22.04
</span></span><span style=display:flex><span>Codename:	jammy
</span></span></code></pre></div><p>客户端是我自己的电脑，命令行执行ssh命令</p><h3 id=修改ssh连接端口-1>修改ssh连接端口<a hidden class=anchor aria-hidden=true href=#修改ssh连接端口-1>#</a></h3><p>ubuntu系统的ssh配置在/ect/ssh下</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202310191538012.png alt=image-20231019153828910></p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202310191544315.png alt=image-20231019154403289></p><p>我们如果想修改服务端端口的话，可以选择直接修改sshd_config的文件。</p><p>这里有一个注意点，我们可以放开22端口的注释，然后在port 22下面新增一个port 2222的配置，这样就可以通过22和2222进行ssh连接，如果2222配置错误，我们还可以留有余地，使用22端口进行连接。</p><p>这里解释下ssh_config和sshd_config的区别，ssh_config是ssh客户端的配置，sshd_config是服务端的配置。</p><p>由于我们这次是修改服务端的配置，所以我们需要修改sshd_config的配置</p><p>如果不想修改现有文件，导致错误的话，其实也可以在sshd_config.d/目录下新增xxx.conf文件，在里面新增配置，在这个目录添加配置文件可以生效是因为sshd_config文件里引入了sshd_config.d/*.conf文件</p><p>我是在目录下新建了一个my_sshd.conf文件</p><p>里面有如下配置项，可以看到配置了2个端口，22和2222，如果sshd_config文件里已经放开了22端口，则可以只添加2222</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Port <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>Port <span style=color:#ae81ff>2222</span>
</span></span></code></pre></div><p>然后将2222端口加入防火墙以放行端口</p><p>使用iptables则执行如下命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>iptables -A INPUT -p tcp --dport <span style=color:#ae81ff>2222</span> -j ACCEPT
</span></span></code></pre></div><p>如果使用firewall-cmd则执行如下命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>firewall-cmd --zone<span style=color:#f92672>=</span>public --add-port<span style=color:#f92672>=</span>2222/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><p>如果是公有云平台，则在对应公有云平台的安全组进行设置</p><p>然后执行如下命令重启sshd，则服务端的配置就重启好了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo service sshd restart
</span></span></code></pre></div><p>执行命令查看ssh端口是否可以启动</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>netstat -nlp|grep <span style=color:#ae81ff>22</span>
</span></span></code></pre></div><p>可以看到22和2222端口都以正常启动</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202310191610746.png alt=image-20231019161001703></p><p>接下来就可以使用ssh命令进行连接了，使用 <code>ssh -p 2222 root@107.173.87.238</code>进行账号密码连接，这样就可以避免22端口被禁导致的连接失败的问题了</p><h3 id=详细步骤>详细步骤<a hidden class=anchor aria-hidden=true href=#详细步骤>#</a></h3><p>这一步只讲步骤，不讲其他的额外知识</p><p>1.使用<code>ssh -p 22 root@107.173.87.238</code>连接到机器上，我们的任何修改都是要先连接到目标机器上，所以这次我们还是先使用22端口连接上去进行修改</p><p>2.在/etc/ssh/sshd_config.d/目录下新增my_sshd.conf文件, 然后使用vim编辑my_sshd.conf,将新的端口配置写入my_sshd.conf里</p><ul><li>首先执行<code>cd /etc/ssh/sshd_config.d/</code>，进入要修改的目录</li><li>然后执行<code>touch my_sshd.conf</code>，新增配置文件</li><li>执行<code>vim my_sshd.conf</code> ，编辑文件，添加<code>Port 22</code>和<code>Port 2222</code>2个端口配置(分2行，详情见上方)，修改完之前:wq保存</li><li>最后检查/etc/ssh/sshd_config，看文件里的<code>PermitRootLogin yes</code>配置项是否打开，如果被注释掉，需要去掉#，值为no的话需要修改为yes，这样可以支持使用root用户登录</li></ul><p>3.将2222端口添加到防火墙</p><ul><li>如果使用iptables则执行如下命令<code>iptables -A INPUT -p tcp --dport 2222 -j ACCEPT</code></li><li>如果是firewall-cmd则执行如下命令<code>firewall-cmd --zone=public --add-port=2222/tcp --permanent</code> 然后执行reload加载<code>firewall-cmd --reload</code></li><li>如果是公有云则去对应厂商的网络安全策略那里修改</li></ul><p>4.重启sshd服务,使用如下命令<code>sudo service sshd restart</code></p><p>5.重启之后验证端口是否正常启动，使用<code>netstat -nlp|grep 22</code>查看端口占用，如果22和2222都已经启动，则sshd服务正常，否则需要检查原因</p><p>6.客户端重新连接，验证22和2222端口功能是否正常，分别使用<code>ssh -p 22 root@107.173.87.238</code>和<code>ssh -p 2222 root@107.173.87.238</code>，如果2个都能正常连接，则修改成功</p><h2 id=使用公钥和私钥进行连接>使用公钥和私钥进行连接<a hidden class=anchor aria-hidden=true href=#使用公钥和私钥进行连接>#</a></h2><p>在上一步中我们修改了ssh连接的端口，可以使用2222端口进行ssh连接，免去了代理封禁了22端口的困扰。但是每次进行连接的时候总要输一大串的连接命令，还要输入繁杂的密码，相信机器的密码都不会太简单，每次复制粘贴密码比较繁琐。</p><p>那么ssh除了账号密码的方式，还支持公私钥的方式，客户端拿着私钥去连接服务端，我们这一小节就介绍ssh使用秘钥进行连接的方式</p><h3 id=生成公钥和私钥>生成公钥和私钥<a hidden class=anchor aria-hidden=true href=#生成公钥和私钥>#</a></h3><p>我们可以使用ssh-keygen命令生成秘钥</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> ~/ ssh-keygen -t rsa -f ~/.ssh/test -b <span style=color:#ae81ff>4096</span>
</span></span><span style=display:flex><span>Generating public/private rsa key pair.
</span></span><span style=display:flex><span>Enter passphrase <span style=color:#f92672>(</span>empty <span style=color:#66d9ef>for</span> no passphrase<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>Enter same passphrase again:
</span></span><span style=display:flex><span>Your identification has been saved in test
</span></span><span style=display:flex><span>Your public key has been saved in test.pub
</span></span><span style=display:flex><span>The key fingerprint is:
</span></span><span style=display:flex><span>SHA256:yL155XDEOzFmSlHcOvUVTyOrduhjWtfakA9gJhVWBUg since@fengchuangdeMacBook-Pro.local
</span></span><span style=display:flex><span>The key<span style=color:#960050;background-color:#1e0010>&#39;</span>s randomart image is:
</span></span><span style=display:flex><span>+---<span style=color:#f92672>[</span>RSA 4096<span style=color:#f92672>]</span>----+
</span></span><span style=display:flex><span>|          oE<span style=color:#f92672>+=</span>o+o|
</span></span><span style=display:flex><span>|          .+o <span style=color:#f92672>=</span>.+|
</span></span><span style=display:flex><span>|          ..B+ .o|
</span></span><span style=display:flex><span>|     . o ..<span style=color:#f92672>==</span>+  .|
</span></span><span style=display:flex><span>|      o S.oB<span style=color:#f92672>=</span>o   |
</span></span><span style=display:flex><span>|         o*<span style=color:#f92672>=</span>o.o  |
</span></span><span style=display:flex><span>|        o .<span style=color:#f92672>=</span>.<span style=color:#f92672>=</span> . |
</span></span><span style=display:flex><span>|         .+ o *  |
</span></span><span style=display:flex><span>|         .   . o |
</span></span><span style=display:flex><span>+----<span style=color:#f92672>[</span>SHA256<span style=color:#f92672>]</span>-----+
</span></span></code></pre></div><p>解释下这个命令，这个命令是用来生成ssh密钥对的</p><ul><li>-t用于指定使用的加密算法，支持如下几种加密算法: dsa 、 ecdsa 、 ecdsa-sk 、 ed25519 、 ed25519-sk 、 rsa</li><li>-b是bits，用来指定生成的密钥对的密钥位数，上述命令是生成4096位密钥文件</li><li>-f用于指定生成的秘钥文件名称和存储路径，不止定-f的话会默认生成~/.ssh/id_rsa和~/.ssh/id_rsa.pub</li><li>-C用于添加评论，本次命令没有使用这个参数</li></ul><p>使用上述命令就生成了一个可用的ssh秘钥对，其中<code>~/.ssh/test</code>文件是私钥，ssh客户端连接服务端的时候拿私钥进行连接，<code>~/.ssh/test.pub</code>是公钥文件，需要上传到服务端，客户端连接请求过来的时候，服务端拿着公钥判断权限用的，关于服务端公钥配置，待会再详细介绍。</p><h3 id=服务端设置公钥>服务端设置公钥<a hidden class=anchor aria-hidden=true href=#服务端设置公钥>#</a></h3><p>上一步生成公钥和私钥之后，私钥客户端留着自己连接的时候用，公钥需要上传到要连接的服务端，建立ssh连接的时候，服务端使用公钥进行鉴权，这一小节介绍服务端如何设置公钥文件</p><p>以下操作会指明各个文件和步骤是服务端操作还是客户端操作，请明确操作环境。</p><p>目前的大前提我们只配置了账号密码登录，配置了22和2222端口用于进行ssh连接。</p><p>首先我们在客户端有<code>~/.ssh/test.pub</code>这个公钥文件，我们需要把公钥信息上传到服务端去，可以看到公钥文件里是一些加密后的字符串，如何把公钥文件上传到服务端，有如下几种方式</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202310192248883.png alt=image-20231019224844800></p><p><em><strong>第一种是使用ssh-copy-id</strong></em></p><p>我们使用ssh-copy-id将test.pub公钥文件，从客户端机器上传到服务端</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> ~/.ssh/ ssh-copy-id -i ./test.pub -p <span style=color:#ae81ff>2222</span> root@107.173.87.238
</span></span><span style=display:flex><span>/usr/bin/ssh-copy-id: INFO: Source of key<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> to be installed: <span style=color:#e6db74>&#34;./test.pub&#34;</span>
</span></span><span style=display:flex><span>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>, to filter out any that are already installed
</span></span><span style=display:flex><span>/usr/bin/ssh-copy-id: INFO: <span style=color:#ae81ff>1</span> key<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> remain to be installed -- <span style=color:#66d9ef>if</span> you are prompted now it is to install the new keys
</span></span><span style=display:flex><span>root@107.173.87.238<span style=color:#e6db74>&#39;s password:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Number of key(s) added:        1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Now try logging into the machine, with:   &#34;ssh -p &#39;</span>2222<span style=color:#e6db74>&#39; &#39;</span>root@107.173.87.238<span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>and check to make sure that only the key(s) you wanted were added.
</span></span></span></code></pre></div><p>看上方的命令和执行结果，-i指定要上传的公钥文件，-p指定端口，其中需要我们输入root账号的密码，然后可以看到公钥就被成功安装了。</p><p>然后上服务器检查，可以发现~下原来没有.ssh文件夹，也没有~/.ssh/authorized_keys文件，ssh-copy-id为我们创建了目录和文件，且把公钥文件写入到authorized_keys文件里了。</p><p>如果没有/root/.ssh文件以及/root/.ssh/authorized_keys文件，需要手动创建目录和文件，再执行上述的ssh-copy-id命令。</p><p>然后在<em><strong>服务端</strong></em>执行以下2个命令,切记要复制这2个命令执行，不要随意修改</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>chmod <span style=color:#ae81ff>700</span> ~/.ssh
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> ~/.ssh/authorized_keys
</span></span></code></pre></div><p>然后检查~/.ssh/authorized_keys的文件内容是否和test.pub一致，如果一致那就上传公钥成功了</p><p>然后就可以在客户端执行ssh命令进行连接了，尝试一下，可以看到已经可以正常连接了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> ~/.ssh/ ssh -i ~/.ssh/test -p <span style=color:#ae81ff>2222</span> root@107.173.87.238
</span></span><span style=display:flex><span>root@racknerd-7c9c56:~#
</span></span></code></pre></div><p><em><strong>第二种是使用ssh命令执行上传和写入</strong></em></p><p>第二种我们使用ssh命令，读取test.pub，并执行命令写入服务端的~/.ssh/authorized_keys文件，再执行第2种之前，我们先删掉服务器上的~/.ssh目录，然后再执行命令上传</p><p>详细命令如下,执行之后输入密码，即可将本地的公钥文件写入服务端的~/.ssh/authorized_keys文件里</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> ~/.ssh/ ssh -p <span style=color:#ae81ff>2222</span> root@107.173.87.238 <span style=color:#e6db74>&#39;mkdir -p ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys&#39;</span> &lt; ~/.ssh/test.pub
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@107.173.87.238<span style=color:#960050;background-color:#1e0010>&#39;</span>s password:
</span></span></code></pre></div><p>这个命令里包含了多个步骤，依次解释下命令含义</p><ul><li>ssh -p 2222 <a href=mailto:root@107.173.87.238>root@107.173.87.238</a>这个就是使用ssh连接服务端</li><li>mkdir -p ~/.ssh是在服务端创建~/.ssh目录</li><li>&lsquo;cat &#187; .ssh/authorized_keys&rsquo; &lt; ~/.ssh/id_rsa.pub的作用是，将本地的公钥文件~/.ssh/id_rsa.pub，重定向追加到远程文件authorized_keys的末尾，注意&#187;表示的是追加写入，不会覆盖原文件</li></ul><p>然后在服务端执行以下2个命令,切记要复制这2个命令执行，不要随意修改</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>chmod <span style=color:#ae81ff>700</span> ~/.ssh
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> ~/.ssh/authorized_keys
</span></span></code></pre></div><p>然后就可以在客户端执行ssh命令进行连接了，尝试一下，可以看到已经可以正常连接了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> ~/.ssh/ ssh -i ~/.ssh/test -p <span style=color:#ae81ff>2222</span> root@107.173.87.238
</span></span><span style=display:flex><span>root@racknerd-7c9c56:~#
</span></span></code></pre></div><p><em><strong>第三种是使用scp命令，先将本地的公钥文件上传到服务端，然后在服务端执行cat命令将公钥文件内容写入authorized_keys文件</strong></em></p><p>第三种就是先将客户端本地的公钥文件上传到服务端，然后使用ssh连接到服务端，执行命令将公钥文件内容写入authorized_keys文件</p><p>照例先删除服务端的~/.ssh文件夹，具体命令如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> ~/.ssh/ scp -P <span style=color:#ae81ff>2222</span> ~/.ssh/test.pub root@107.173.87.238:~/
</span></span><span style=display:flex><span>root@107.173.87.238<span style=color:#e6db74>&#39;s password:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Permission denied, please try again.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>root@107.173.87.238&#39;</span>s password:
</span></span><span style=display:flex><span>test.pub
</span></span></code></pre></div><p>解释下具体的含义，这行命令就是使用scp将客户端本地的~/.ssh/test.pub文件上传到服务端的~/目录下，注意P是大写，代表连接使用的端口</p><p>然后ssh连接到服务端，使用如下命令创建~/.ssh目录和~/.ssh/authorized_keys文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir ~/.ssh
</span></span><span style=display:flex><span>touch ~/.ssh/authorized_keys
</span></span></code></pre></div><p>然后服务端执行如下命令授权，不要随意修改</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>chmod <span style=color:#ae81ff>700</span> ~/.ssh
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> ~/.ssh/authorized_keys
</span></span></code></pre></div><p>然后执行cat命令，将已经上传到服务器的test.pub文件的内容写入~/.ssh/authorized_keys</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat ~/test.pub &gt;&gt; ~/.ssh/authorized_keys
</span></span></code></pre></div><p>然后就可以在客户端执行ssh命令进行连接了，尝试一下，可以看到已经可以正常连接了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> ~/.ssh/ ssh -i ~/.ssh/test -p <span style=color:#ae81ff>2222</span> root@107.173.87.238
</span></span><span style=display:flex><span>root@racknerd-7c9c56:~#
</span></span></code></pre></div><p>接下来有些注意事项，如果使用ssh -i无法连接，需要检查下/etc/ssh/sshd_config这个文件，看看如下几个配置项是否被注释掉</p><p>如果有#就是被注释了，未生效，需要去掉#号放开，放开之后需要执行<code>service sshd restart</code>重启服务端ssh服务</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>　RSAAuthentication yes
</span></span><span style=display:flex><span>　PubkeyAuthentication yes
</span></span><span style=display:flex><span>　AuthorizedKeysFile .ssh/authorized_keys
</span></span></code></pre></div><p>综合看下来，还是使用ssh-copy-id比较简单省事，其他两种为我们展示了具体的为服务端添加公钥的过程</p><h3 id=详细步骤-1>详细步骤<a hidden class=anchor aria-hidden=true href=#详细步骤-1>#</a></h3><p>以ssh-copy-id为例，说明下详细步骤</p><p>1.执行ssh-copy-id命令将客户端公钥文件上传到服务端<code>ssh-copy-id -i ./test.pub -p 2222 root@107.173.87.238</code></p><p>2.检查服务端是否存在~/.ssh目录，是否存在~/.ssh/authorized_keys文件，如果任一不存在，则执行<code>mkdir ~/.ssh &&amp;touch ~/.ssh/authorized_keys </code>创建路径和文件之后，重复执行第一步</p><p>3.执行命令为服务端公钥文件授权,需要执行<code>chmod 700 ~/.ssh</code>和<code>chmod 600 ~/.ssh/authorized_keys</code></p><p>4.检查服务端~/.ssh/authorized_keys文件内容是否和客户端的公钥文件内容一致，一致则说明上传成功</p><p>5.客户端使用<code>ssh -i ~/.ssh/test -p 2222 root@107.173.87.238</code>尝试连接，如果成功则添加秘钥方式修改成功</p><p>6.如果客户端连接失败，检查下<code>/etc/ssh/sshd_config</code>文件的<code>RSAAuthentication</code>，<code>PubkeyAuthentication</code>，<code>AuthorizedKeysFile</code>等key是否放开，如果注释掉需要放开，执行``service sshd restart`重启sshd服务</p><h2 id=ssh使用config进行登录>ssh使用config进行登录<a hidden class=anchor aria-hidden=true href=#ssh使用config进行登录>#</a></h2><p>上面2种登录方式，不管是使用使用用户密码，还是使用公私钥，都需要在命令行输入一大串命令，比较繁琐。</p><p>使用命令行进行ssh连接的时候，虽然有历史记录，但仍比较繁琐，需要频繁复制输入密码，有了私钥认证之后好一点，但还是比较繁琐。</p><p>本小节介绍如何使用配置文件的方式，将连接配置写到配置文件里，简化操作，提高使用ssh连接的效率</p><p>ssh有个配置文件，路径是<code>~/.ssh/config</code>，可以在这个文件里面配置ssh连接信息，另外一个配置文件地址是<code>/etc/ssh/ssh_config</code>，这个上一小节有介绍</p><p>我本地有如下3个配置，写在了<code>~/.ssh/config</code>文件里</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Host github.com
</span></span><span style=display:flex><span>  HostName ssh.github.com
</span></span><span style=display:flex><span>  User git
</span></span><span style=display:flex><span>  Port <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>Host vps-racknerd-id
</span></span><span style=display:flex><span>  HostName 107.173.87.238
</span></span><span style=display:flex><span>  User root
</span></span><span style=display:flex><span>  Port <span style=color:#ae81ff>2222</span>
</span></span><span style=display:flex><span>  IdentityFile ~/.ssh/test
</span></span><span style=display:flex><span>Host vps-racknerd-pwd
</span></span><span style=display:flex><span>  HostName 107.173.87.238
</span></span><span style=display:flex><span>  User root
</span></span><span style=display:flex><span>  Port <span style=color:#ae81ff>2222</span>
</span></span></code></pre></div><p>第一个是github的配置，由于22端口被封，每次git push非常的费劲，后面根据搜索，将端口换成了443,问题得以解决</p><p>第二个是vps的配置，使用了私钥文件鉴权的方式</p><p>第三个是vps的配置，使用了用户密码的鉴权方式</p><p>解释下配置项的含义</p><ul><li>Host配置的要连接的主机名，github的Host好像是固定的，github.com， *为默认值，匹配所有的Host的行为，我理解这里的Host可以相当于别名使用了，ssh 匹配Host，然后执行Host的逻辑</li><li>HostName，这个是指定ssh连接的目标地址，可以是域名，也可以是ip</li><li>User是指定ssh连接的用户</li><li>Port是指定ssh连接的端口</li><li>IdentityFile是指定的ssh连接的私钥文件地址</li></ul><p>我本地连接vps,现在可以使用<code>vps-racknerd-id</code>和<code>vps-racknerd-id</code>进行连接了</p><p>使用vps-racknerd-pwd，还是使用用户密码的方式登录，仍需输入用户对应的密码，优点是少输很多东西</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> /etc/ssh/ ssh vps-racknerd-pwd
</span></span><span style=display:flex><span>root@107.173.87.238<span style=color:#960050;background-color:#1e0010>&#39;</span>s password:
</span></span><span style=display:flex><span>root@racknerd-7c9c56:~#
</span></span></code></pre></div><p>使用vps-racknerd-id，使用私钥方式登录，不用输入密码，即可直接连接，只需执行一步就可连接</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> ~/.ssh/ ssh vps-racknerd-id
</span></span><span style=display:flex><span>root@racknerd-7c9c56:~#
</span></span></code></pre></div><h2 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>本文介绍了3个功能: 修改ssh默认端口，使用私钥登录，使用配置进行登录</p><p>第一个功能实现了修改端口，可以避免代理禁用22端口导致的连接问题</p><p>第二个功能实现了使用私钥文件登录，不用再每次输入密码</p><p>第三个功能实现了将配置信息写到config文件里，简化了连接的命令</p><p>上面介绍的是命令行使用ssh连接的方式，如果有条件的话，可以使用其他的ssh客户端，比如xshell、putty、secureCRT、mobaXterm等工具，这些工具带了界面，可以在界面上进行操作，并且有秘钥文件管理和存储密码的功能</p><h2 id=参考链接>参考链接<a hidden class=anchor aria-hidden=true href=#参考链接>#</a></h2><p><a href=https://www.cyberciti.biz/faq/create-ssh-config-file-on-linux-unix/>openssh config file examples for linux/unix</a></p><p><a href=http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html>SSH原理与运用-阮一峰</a></p><p><a href=https://www.runoob.com/w3cnote/set-ssh-login-key.html>设置SSH通过秘钥登录</a></p><p><a href=https://wangdoc.com/ssh/>SSH教程</a></p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://blog1.thend03.com/img/wechat_pay.png alt=wechat_pay></a><p>微信</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://blog1.thend03.com/img/alipay.png alt=alipay></a><p>支付宝</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>🧧 鼓励</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog1.thend03.com/posts/price-go-and-down/><span class=title>« 上一页</span><br><span>变来变去的价格</span>
</a><a class=next href=https://blog1.thend03.com/posts/fifteen-days-in-beijing-and-nanjing/><span class=title>下一页 »</span><br><span>两京十五日</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share ssh配置 on twitter" href="https://twitter.com/intent/tweet/?text=ssh%e9%85%8d%e7%bd%ae&amp;url=https%3a%2f%2fblog1.thend03.com%2fposts%2fssh-config%2f&amp;hashtags=ssh"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share ssh配置 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog1.thend03.com%2fposts%2fssh-config%2f&amp;title=ssh%e9%85%8d%e7%bd%ae&amp;summary=ssh%e9%85%8d%e7%bd%ae&amp;source=https%3a%2f%2fblog1.thend03.com%2fposts%2fssh-config%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share ssh配置 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog1.thend03.com%2fposts%2fssh-config%2f&title=ssh%e9%85%8d%e7%bd%ae"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share ssh配置 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog1.thend03.com%2fposts%2fssh-config%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share ssh配置 on whatsapp" href="https://api.whatsapp.com/send?text=ssh%e9%85%8d%e7%bd%ae%20-%20https%3a%2f%2fblog1.thend03.com%2fposts%2fssh-config%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share ssh配置 on telegram" href="https://telegram.me/share/url?text=ssh%e9%85%8d%e7%bd%ae&amp;url=https%3a%2f%2fblog1.thend03.com%2fposts%2fssh-config%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></div><style>.comments_details summary::marker{font-size:20px;content:'👉展开评论';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'👇关闭评论';color:var(--content)}</style><div><details class=comments_details><summary style="cursor:pointer;margin:50px 0 20px;width:130px"><span style=font-size:20px;color:var(--content)>...</span></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>twikoo.init({envId:null,el:"#tcomment",lang:"zh-CN",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><span>Copyright
&copy;
2020-2024
<a href=https://blog1.thend03.com/ style=color:#939393>fayy&amp;fc</a>
All Rights Reserved
</span><a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src style="float:left;margin:0 5px 0 0">
</a></span><span id=busuanzi_container><span class="fa fa-user"></span> <span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye"></span> <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

————————————————
版权声明：本文为「fayy&fc」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href,s=window.getSelection().toString()+`

————————————————
版权声明：本文为「fayy&fc」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="复制";function i(){t.innerText="已复制！",setTimeout(()=>{t.innerText="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
————————————————
版权声明：本文为「fayy&fc」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>