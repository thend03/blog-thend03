<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å¦‚ä½•æŸ¥çœ‹jvmè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†classæ–‡ä»¶ | ç«™åœ¨æµ·è¾¹çœ‹è¿œæ–¹</title>
<meta name=keywords content="java"><meta name=description content="å‰è¨€
æœ€è¿‘çœ‹dubboçš„æ—¶å€™ï¼Œçœ‹åˆ°äº†è®²spiçš„éƒ¨åˆ†ï¼Œå…¶ä¸­æåˆ°äº†@Adaptiveæ³¨è§£ç”Ÿæˆäº†ä»£ç†ç±»


æˆ‘åé¢å»debugäº†ä¸€ä¸‹ï¼Œæ‰“äº†æ–­ç‚¹ï¼Œå‘ç°åœ¨è¿è¡Œæ—¶ï¼Œåªæ˜¯æ˜¾ç¤ºäº†classçš„åç§°ï¼Œç”±äºRegistryFactory$Adaptive æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ²¡æœ‰classæ–‡ä»¶ç»“æ„å¯ä»¥çœ‹ï¼Œè€Œæ–‡ç« é‡Œè´´äº†classæ–‡ä»¶ã€‚"><meta name=author content="since"><link rel=canonical href=https://blog.thend03.com/posts/tech/view-jvm-dynamic-class-detail/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://blog.thend03.com/img/logo.jpg><link rel=icon type=image/png sizes=16x16 href=https://blog.thend03.com/img/logo.jpg><link rel=icon type=image/png sizes=32x32 href=https://blog.thend03.com/img/logo.jpg><link rel=apple-touch-icon href=https://blog.thend03.com/img/logo.jpg><link rel=mask-icon href=https://blog.thend03.com/img/logo.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://blog.thend03.com/posts/tech/view-jvm-dynamic-class-detail/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="å¦‚ä½•æŸ¥çœ‹jvmè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†classæ–‡ä»¶"><meta property="og:description" content="å‰è¨€
æœ€è¿‘çœ‹dubboçš„æ—¶å€™ï¼Œçœ‹åˆ°äº†è®²spiçš„éƒ¨åˆ†ï¼Œå…¶ä¸­æåˆ°äº†@Adaptiveæ³¨è§£ç”Ÿæˆäº†ä»£ç†ç±»


æˆ‘åé¢å»debugäº†ä¸€ä¸‹ï¼Œæ‰“äº†æ–­ç‚¹ï¼Œå‘ç°åœ¨è¿è¡Œæ—¶ï¼Œåªæ˜¯æ˜¾ç¤ºäº†classçš„åç§°ï¼Œç”±äºRegistryFactory$Adaptive æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ²¡æœ‰classæ–‡ä»¶ç»“æ„å¯ä»¥çœ‹ï¼Œè€Œæ–‡ç« é‡Œè´´äº†classæ–‡ä»¶ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.thend03.com/posts/tech/view-jvm-dynamic-class-detail/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-11T15:40:13+08:00"><meta property="article:modified_time" content="2024-09-11T15:40:13+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="å¦‚ä½•æŸ¥çœ‹jvmè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†classæ–‡ä»¶"><meta name=twitter:description content="å‰è¨€
æœ€è¿‘çœ‹dubboçš„æ—¶å€™ï¼Œçœ‹åˆ°äº†è®²spiçš„éƒ¨åˆ†ï¼Œå…¶ä¸­æåˆ°äº†@Adaptiveæ³¨è§£ç”Ÿæˆäº†ä»£ç†ç±»


æˆ‘åé¢å»debugäº†ä¸€ä¸‹ï¼Œæ‰“äº†æ–­ç‚¹ï¼Œå‘ç°åœ¨è¿è¡Œæ—¶ï¼Œåªæ˜¯æ˜¾ç¤ºäº†classçš„åç§°ï¼Œç”±äºRegistryFactory$Adaptive æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ²¡æœ‰classæ–‡ä»¶ç»“æ„å¯ä»¥çœ‹ï¼Œè€Œæ–‡ç« é‡Œè´´äº†classæ–‡ä»¶ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://blog.thend03.com/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://blog.thend03.com/posts/tech/"},{"@type":"ListItem","position":3,"name":"å¦‚ä½•æŸ¥çœ‹jvmè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†classæ–‡ä»¶","item":"https://blog.thend03.com/posts/tech/view-jvm-dynamic-class-detail/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"å¦‚ä½•æŸ¥çœ‹jvmè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†classæ–‡ä»¶","name":"å¦‚ä½•æŸ¥çœ‹jvmè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†classæ–‡ä»¶","description":"å‰è¨€ æœ€è¿‘çœ‹dubboçš„æ—¶å€™ï¼Œçœ‹åˆ°äº†è®²spiçš„éƒ¨åˆ†ï¼Œå…¶ä¸­æåˆ°äº†@Adaptiveæ³¨è§£ç”Ÿæˆäº†ä»£ç†ç±»\næˆ‘åé¢å»debugäº†ä¸€ä¸‹ï¼Œæ‰“äº†æ–­ç‚¹ï¼Œå‘ç°åœ¨è¿è¡Œæ—¶ï¼Œåªæ˜¯æ˜¾ç¤ºäº†classçš„åç§°ï¼Œç”±äºRegistryFactory$Adaptive æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ²¡æœ‰classæ–‡ä»¶ç»“æ„å¯ä»¥çœ‹ï¼Œè€Œæ–‡ç« é‡Œè´´äº†classæ–‡ä»¶ã€‚\n","keywords":["java"],"articleBody":"å‰è¨€ æœ€è¿‘çœ‹dubboçš„æ—¶å€™ï¼Œçœ‹åˆ°äº†è®²spiçš„éƒ¨åˆ†ï¼Œå…¶ä¸­æåˆ°äº†@Adaptiveæ³¨è§£ç”Ÿæˆäº†ä»£ç†ç±»\næˆ‘åé¢å»debugäº†ä¸€ä¸‹ï¼Œæ‰“äº†æ–­ç‚¹ï¼Œå‘ç°åœ¨è¿è¡Œæ—¶ï¼Œåªæ˜¯æ˜¾ç¤ºäº†classçš„åç§°ï¼Œç”±äºRegistryFactory$Adaptive æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ²¡æœ‰classæ–‡ä»¶ç»“æ„å¯ä»¥çœ‹ï¼Œè€Œæ–‡ç« é‡Œè´´äº†classæ–‡ä»¶ã€‚\næ‰€ä»¥æ¯”è¾ƒå¥½å¥‡ï¼Œå¦‚ä½•æ‹¿åˆ°classæ–‡ä»¶ã€‚\nç»è¿‡ä¸€ç•ªæœç´¢éªŒè¯ä¹‹åï¼Œæœ‰äº†å¦‚ä¸‹çš„æ–‡ç« \nJavaç”Ÿæˆä»£ç†ç±»çš„æ–¹å¼ é¦–å…ˆå‘¢, javaç”Ÿæˆä»£ç†ç±»æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ã€‚\nåœ¨äº†è§£äº†åŠ¨æ€ä»£ç†çš„ç”Ÿæˆæ–¹å¼ä¹‹åï¼Œå¯ä»¥åˆ†æƒ…å†µè®¨è®ºå¦‚ä½•æ‹¿åˆ°ä»£ç†ç±»çš„classæ–‡ä»¶\nJDKåŠ¨æ€ä»£ç† è¿™ä¸ªæ˜¯javaè‡ªèº«æ”¯æŒçš„ä»£ç†æ–¹å¼ï¼Œè‡ªå¸¦çš„ï¼Œæ— éœ€å¼•å…¥é¢å¤–ç»„ä»¶ï¼Œä½†æ˜¯åªèƒ½ä»£ç†æ¥å£ã€‚\nå› ä¸ºç”Ÿæˆçš„ä»£ç†ç±»éœ€è¦ç»§æ‰¿Proxyç±»ï¼Œjavaæ˜¯å•ç»§æ‰¿çš„ï¼Œæ‰€ä»¥åªèƒ½ä»£ç†æ¥å£ã€‚\nCGLIBåŠ¨æ€ä»£ç† cglibå¯ä»¥ä¸ºclassåˆ›å»ºä»£ç†ç±»ï¼Œç±»ä¸å¿…æ˜¯æ¥å£ï¼Œé‡‡ç”¨çš„æ˜¯ç»§æ‰¿å§”æ‰˜ç±»çš„æ–¹å¼ï¼Œå› æ­¤ä¸èƒ½ä»£ç†finalç±»ï¼Œåªèƒ½ä»£ç†æ‰€æœ‰éfinalçš„public/protectedç±»å‹çš„æ–¹æ³•å®šä¹‰ã€‚\ncglibæ˜¯é‡‡ç”¨çš„asmå­—èŠ‚ç æ‹¼æ¥æŠ€æœ¯ï¼Œç»§æ‰¿ä¸€ä¸ªç±»ï¼Œå­ç±»å¯¹æ–¹æ³•è¿›è¡Œæ‹¦æˆªï¼Œç»‡å…¥æ¨ªåˆ‡é€»è¾‘ã€‚\nJavassist ä½¿ç”¨javassistå¯ä»¥ç›´æ¥æ“çºµå­—èŠ‚ç ï¼Œç”Ÿæˆä»£ç†ç±»ã€‚\ndubboçš„ä»£ç†ç±»å°±æ˜¯ä½¿ç”¨javassistæ‹¼æ¥å‡ºæ¥çš„\nASM asmç›¸æ¯”javassistï¼Œæ›´åŠ çš„ç»†ç²’åº¦ï¼Œä¸”å®ç°æ›´åŠ çš„å¤æ‚ã€‚\nDubboç›¸å…³ä»£ç†ç±»çš„classæ–‡ä»¶ å…·ä½“åˆ°dubboçš„è¯ï¼Œ@Adaptiveä¼šç”Ÿæˆç›¸å…³çš„ä»£ç†ç±»ï¼ŒDubboçš„ä»£ç†ç±»æ˜¯ç”¨javaasistç”Ÿæˆçš„ã€‚\nå†å»¶ä¼¸åˆ°è°ƒç”¨è¿‡ç¨‹ï¼Œconsumerè°ƒproviderï¼Œç”Ÿæˆçš„ä»£ç†ç±»æ˜¯jdkåŠ¨æ€ä»£ç†\nproviderç«¯è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªwarpperä»£ç†ç±»ï¼Œç”Ÿæˆçš„ä»£ç†ç±»æ˜¯ä½¿ç”¨javassistç”Ÿæˆçš„ï¼Œç„¶åé€šè¿‡Warpper0.invokeMethod()æ ¹æ®å…·ä½“çš„è°ƒç”¨ä¿¡æ¯è°ƒç”¨åˆ°å…·ä½“çš„å®ç°ç±»ã€‚\næœ¬æ¬¡ä½¿ç”¨çš„dubboç‰ˆæœ¬æ˜¯3.2.0\nå»å¹´å†™äº†ä¸€ç¯‡å…³äº dubbo spiçš„æ–‡ç« ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œä»‹ç»äº†spiçš„ç›¸å…³å®ç°æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨\nå…·ä½“åˆ°Adaptiveä»£ç†ç±»ï¼Œä½¿ç”¨å¦‚ä¸‹çš„æµ‹è¯•ä»£ç (å®Œæ•´çš„è¿‡ç¨‹å¯ä»¥å‚è€ƒä¸Šé¢çš„æ–‡ç« åœ°å€)\npublic class DubboSpi { public static void main(String[] args) { ExtensionLoader\u003cSimpleExt\u003e extensionLoader = ExtensionLoader.getExtensionLoader(SimpleExt.class); // SimpleExt defaultExtension = extensionLoader.getDefaultExtension(); // SimpleExt dog = extensionLoader.getExtension(\"dog\"); // SimpleExt dog2 = extensionLoader.getExtension(\"dog\", true); // SimpleExt cat = extensionLoader.getExtension(\"cat\"); // dog.yell(null, \"dogdog\"); // SimpleExt dog1 = extensionLoader.getExtension(\"dog\"); // dog1.yell(null, \"dog1\"); SimpleExt adaptiveExtension = extensionLoader.getAdaptiveExtension(); URLAddress urlAddress = new URLAddress(\"127.0.0.1\", 20880); URLParam parse = URLParam.parse(new HashMap\u003c\u003e()); adaptiveExtension.echo(new URL(urlAddress, parse), \"dogs\"); adaptiveExtension.bang(new URL(urlAddress, parse),0); } } å®šä½åˆ°å¦‚ä¸‹ç”Ÿæˆä»£ç†ç±»çš„æ–¹æ³•,ä»£ç åœ¨org.apache.dubbo.common.extension.ExtensionLoader#createAdaptiveExtensionClass\nprivate Class\u003c?\u003e createAdaptiveExtensionClass() { // Adaptive Classes' ClassLoader should be the same with Real SPI interface classes' ClassLoader ClassLoader classLoader = type.getClassLoader(); try { if (NativeUtils.isNative()) { return classLoader.loadClass(type.getName() + \"$Adaptive\"); } } catch (Throwable ignore) { } //è¿™é‡Œç”Ÿæˆclassæ–‡ä»¶ String code = new AdaptiveClassCodeGenerator(type, cachedDefaultName).generate(); org.apache.dubbo.common.compiler.Compiler compiler = extensionDirector.getExtensionLoader( org.apache.dubbo.common.compiler.Compiler.class).getAdaptiveExtension(); return compiler.compile(type, code, classLoader); } æˆ‘ä»¬debugçœ‹ä¸€ä¸‹ç”Ÿæˆçš„code, çœ‹ç±»åï¼Œæ˜¯SimpleExt$Adaptive, é€šè¿‡æ‰‹åŠ¨æ‹¼æ¥çš„æ–¹å¼ï¼Œç”Ÿæˆäº†adaptiveä»£ç†ç±»ã€‚\nè°ƒç”¨AdaptiveCompilerï¼Œæœ€ç»ˆcompileerçš„ç±»å‹ä¸ºJavassistCompilerï¼Œå³é€šè¿‡javassistç”Ÿæˆçš„adaptiveä»£ç†ç±»\né‚£ä¹ˆå›å½’åˆ°æˆ‘ä¸€å¼€å§‹çš„é—®é¢˜ï¼Œå¦‚ä½•æŸ¥çœ‹åŠ¨æ€ç”Ÿæˆçš„classçš„å†…å®¹ï¼Œåœ¨String code = new AdaptiveClassCodeGenerator(type, cachedDefaultName).generate();è¿™ä¸€è¡Œé€šè¿‡debugå°±å¯ä»¥æ‹¿åˆ°å…·ä½“çš„classå†…å®¹äº†\nç”Ÿæˆçš„ä»£ç†ç±»å¦‚ä¸‹æ‰€ç¤º, å¯¹æ¥å£çš„æ–¹æ³•è¿›è¡Œäº†æ‹¦æˆª\npackage com.fc.rpc.dubbo; import org.apache.dubbo.rpc.model.ScopeModel; import org.apache.dubbo.rpc.model.ScopeModelUtil; public class SimpleExt$Adaptive implements com.fc.rpc.dubbo.SimpleExt { public java.lang.String yell(org.apache.dubbo.common.URL arg0, java.lang.String arg1) { if (arg0 == null) throw new IllegalArgumentException(\"url == null\"); org.apache.dubbo.common.URL url = arg0; String extName = url.getParameter(\"key1\", url.getParameter(\"key2\", \"dog\")); if (extName == null) throw new IllegalStateException(\"Failed to get extension (com.fc.rpc.dubbo.SimpleExt) name from url (\" + url.toString() + \") use keys([key1, key2])\"); ScopeModel scopeModel = ScopeModelUtil.getOrDefault(url.getScopeModel(), com.fc.rpc.dubbo.SimpleExt.class); com.fc.rpc.dubbo.SimpleExt extension = (com.fc.rpc.dubbo.SimpleExt) scopeModel.getExtensionLoader(com.fc.rpc.dubbo.SimpleExt.class).getExtension(extName); return extension.yell(arg0, arg1); } public java.lang.String echo(org.apache.dubbo.common.URL arg0, java.lang.String arg1) { if (arg0 == null) throw new IllegalArgumentException(\"url == null\"); org.apache.dubbo.common.URL url = arg0; String extName = url.getParameter(\"simple.ext\", \"dog\"); if (extName == null) throw new IllegalStateException(\"Failed to get extension (com.fc.rpc.dubbo.SimpleExt) name from url (\" + url.toString() + \") use keys([simple.ext])\"); ScopeModel scopeModel = ScopeModelUtil.getOrDefault(url.getScopeModel(), com.fc.rpc.dubbo.SimpleExt.class); com.fc.rpc.dubbo.SimpleExt extension = (com.fc.rpc.dubbo.SimpleExt) scopeModel.getExtensionLoader(com.fc.rpc.dubbo.SimpleExt.class).getExtension(extName); return extension.echo(arg0, arg1); } public java.lang.String bang(org.apache.dubbo.common.URL arg0, int arg1) { throw new UnsupportedOperationException(\"The method public abstract java.lang.String com.fc.rpc.dubbo.SimpleExt.bang(org.apache.dubbo.common.URL,int) of interface com.fc.rpc.dubbo.SimpleExt is not adaptive method!\"); } } å¦å¤–debugçº§åˆ«çš„è¯ï¼Œç”Ÿæˆçš„classä¼šè¾“å‡ºåˆ°æ—¥å¿—\nJDKåŠ¨æ€ä»£ç†çš„classæ–‡ä»¶ å›å½’åˆ°jdkçš„åŠ¨æ€ä»£ç†ï¼Œå¦‚ä½•æŸ¥çœ‹jdkåŠ¨æ€ä»£ç†ç”Ÿæˆçš„classæ–‡ä»¶\nè¿™é‡Œä¸»è¦è®²ä¸€ä¸‹å¦‚ä½•æŸ¥çœ‹åŠ¨æ€ä»£ç†çš„classæ–‡ä»¶ï¼ŒåŠ¨æ€ä»£ç†çš„åŸç†å•¥çš„ä¸æ·±å…¥ã€‚\nè®¾ç½®å‚æ•° åœ¨è°ƒç”¨ä¹‹å‰ï¼Œæ·»åŠ System.getProperties().put(\"sun.misc.ProxyGenerator.saveGeneratedFiles\",\"true\");\nè¿™ä¸ªåªé€‚ç”¨äºjdkåŠ¨æ€ä»£ç†\nå‡†å¤‡ä¸€ä¸‹æµ‹è¯•ç±»\nè¿™æ˜¯è°ƒç”¨å…¥å£\npublic class DynamicProxyMain { public static void main(String[] args) { //åŠ¨æ€ä»£ç†æ—¶ç”Ÿæˆclassæ–‡ä»¶ System.getProperties().put(\"sun.misc.ProxyGenerator.saveGeneratedFiles\",\"true\"); DynamicProxy dynamicProxy = new DynamicProxy(new HumenImpl()); Humen humenProxy = dynamicProxy.getProxy(); humenProxy.eat(\"rice\"); } } DynamicProxyå®ç°äº†InvocationHandlerï¼Œç”¨äºç”Ÿæˆä»£ç†ç±»\nimport java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; public class DynamicProxy implements InvocationHandler { private Object target; public DynamicProxy(Object target) { this.target = target; } @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { this.before(); Object result = method.invoke(target, args); this.after(); return result; } private void before() { System.out.println(\"åƒä¸œè¥¿ä¹‹å‰å…ˆçƒ­èº«\"); } private void after() { System.out.println(\"åƒå®Œé¥­ä¼‘æ¯ä¸€ä¸‹\"); } public \u003cT\u003e T getProxy() { return (T) Proxy.newProxyInstance(target.getClass().getClassLoader(),target.getClass().getInterfaces(),this); } } æµ‹è¯•ç”¨çš„æ¥å£\n/** * äººç±»è¿·æƒ‘è¡Œä¸ºå¤§èµ **/ public interface Humen { /** * åƒä¸œè¥¿ * * @param food é£Ÿç‰© */ void eat(String food); } æµ‹è¯•æ¥å£çš„å®ç°ç±»\n/** * äººç±»è¿·æƒ‘è¡Œä¸ºå¤§èµå…·ä½“æ¡ˆä¾‹ **/ public class HumenImpl implements Humen { @Override public void eat(String food) { System.out.println(\"äººç±»å¼€å§‹è¡Œä¸ºè‰ºæœ¯è¡¨æ¼”ï¼šåƒé£Ÿç‰© \"+food); } } é‚£ä¹ˆä¸»è¦çœ‹ä¸€ä¸‹è¿™ä¸ªé…ç½®System.getProperties().put(\"sun.misc.ProxyGenerator.saveGeneratedFiles\",\"true\");è¿™ä¸ªé…ç½®æ˜¯ç”¨äºä¿å­˜ç”Ÿæˆçš„classçš„ã€‚\nç¼ºç‚¹æ˜¯è¿™ä¸ªå‚æ•°åªé€‚ç”¨äºjdkåŠ¨æ€ä»£ç†\nåŠ ä¸Šè¿™ä¸ªå‚æ•°è¿è¡Œä¸€ä¸‹ï¼Œä¼šå‘ç°ä»£ç†ç±»ä¿å­˜åˆ°äº†é¡¹ç›®è·¯å¾„(classpath)ä¸‹\nçœ‹ä¸€ä¸‹$Proxy0çš„è¯¦ç»†å†…å®¹, ä»£ç†ç±»ç»§æ‰¿äº†Proxy, æ‰€ä»¥jdkåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ¥å£ï¼Œå› ä¸ºJavaæ˜¯å•ç»§æ‰¿çš„\n// // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // package com.sun.proxy; import com.fc.se.proxy.Humen; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.lang.reflect.UndeclaredThrowableException; public final class $Proxy0 extends Proxy implements Humen { private static Method m1; private static Method m2; private static Method m3; private static Method m0; public $Proxy0(InvocationHandler var1) throws { super(var1); } public final boolean equals(Object var1) throws { try { return (Boolean)super.h.invoke(this, m1, new Object[]{var1}); } catch (RuntimeException | Error var3) { throw var3; } catch (Throwable var4) { throw new UndeclaredThrowableException(var4); } } public final String toString() throws { try { return (String)super.h.invoke(this, m2, (Object[])null); } catch (RuntimeException | Error var2) { throw var2; } catch (Throwable var3) { throw new UndeclaredThrowableException(var3); } } public final void eat(String var1) throws { try { super.h.invoke(this, m3, new Object[]{var1}); } catch (RuntimeException | Error var3) { throw var3; } catch (Throwable var4) { throw new UndeclaredThrowableException(var4); } } public final int hashCode() throws { try { return (Integer)super.h.invoke(this, m0, (Object[])null); } catch (RuntimeException | Error var2) { throw var2; } catch (Throwable var3) { throw new UndeclaredThrowableException(var3); } } static { try { m1 = Class.forName(\"java.lang.Object\").getMethod(\"equals\", Class.forName(\"java.lang.Object\")); m2 = Class.forName(\"java.lang.Object\").getMethod(\"toString\"); m3 = Class.forName(\"com.fc.se.proxy.Humen\").getMethod(\"eat\", Class.forName(\"java.lang.String\")); m0 = Class.forName(\"java.lang.Object\").getMethod(\"hashCode\"); } catch (NoSuchMethodException var2) { throw new NoSuchMethodError(var2.getMessage()); } catch (ClassNotFoundException var3) { throw new NoClassDefFoundError(var3.getMessage()); } } } æ„é€ å‡½æ•°ä¼ å…¥äº†InvocationHandlerï¼Œèµ‹å€¼ç»™äº†æˆå‘˜å˜é‡hï¼Œæ‰€ä»¥æ–¹æ³•çš„è°ƒç”¨éƒ½æ˜¯èµ°çš„InvocationHandlerã€‚\næœ¬æ¬¡ç¤ºä¾‹ä¸­ä¸ºDynamicProxy\npublic $Proxy0(InvocationHandler var1) throws { super(var1); } åœ¨é™æ€ä»£ç å—ä¸­ç”Ÿæˆäº†å¯¹åº”çš„æ–¹æ³•ï¼Œç±»é€šç”¨çš„hashCode()ã€toString()ã€equals(), ä»¥åŠéœ€è¦ä»£ç†çš„æ–¹æ³•eat()ã€‚\n$Proxy0è°ƒç”¨eatæ–¹æ³•ï¼Œç„¶åæ‰§è¡Œåˆ°äº†com.fc.se.proxy.DynamicProxy#invoke,\nmethod.invoke(target, args)è°ƒç”¨å…·ä½“çš„å®ç°ç±»æ‰§è¡Œæ–¹æ³•ã€‚\nè¾“å‡ºåˆ°æ–‡ä»¶ ä¸Šä¸€æ­¥ä¸­æˆ‘ä»¬çŸ¥é“äº†ç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åæ˜¯$Proxy0, debugçš„æ—¶å€™ä¹Ÿèƒ½çœ‹åˆ°ç±»åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨æ–¹æ³•å°†è¿™ä¸ªç±»æ‰“å°åˆ°æ–‡ä»¶é‡Œã€‚\næ›´æ–°åçš„æµ‹è¯•ç±»å…¥å£å¦‚ä¸‹\nimport sun.misc.ProxyGenerator; import java.io.FileOutputStream; import java.io.IOException; public class DynamicProxyMain { public static void main(String[] args) { //åŠ¨æ€ä»£ç†æ—¶ç”Ÿæˆclassæ–‡ä»¶ System.getProperties().put(\"sun.misc.ProxyGenerator.saveGeneratedFiles\",\"true\"); DynamicProxy dynamicProxy = new DynamicProxy(new HumenImpl()); Humen humenProxy = dynamicProxy.getProxy(); humenProxy.eat(\"rice\"); //ä¿å­˜$Proxy0åˆ°æ–‡ä»¶ saveProxyFile(); } private static void saveProxyFile() { FileOutputStream out = null; try { byte[] classFile = ProxyGenerator.generateProxyClass(\"$Proxy0\", HumenImpl.class.getInterfaces()); out = new FileOutputStream(\"/Users/since/git/vamei/out/class/\" + \"$Proxy0.class\"); out.write(classFile); } catch (Exception e) { e.printStackTrace(); } finally { try { if (out != null) { out.flush(); out.close(); } } catch (IOException e) { e.printStackTrace(); } } } } æ‰§è¡Œä¹‹åå¯ä»¥å‘ç°å·²ç»ç”Ÿæˆäº†$Proxy0.class\næ‰€ä»¥çŸ¥é“ç±»åï¼Œå°±å¯ä»¥ä»¥è¿™ç§æ–¹å¼è¾“å‡ºåˆ°æ–‡ä»¶é‡Œ\nhsdb å¦ä¸€ç§æ˜¯hsdb\næˆ‘è¿™è¾¹ä½¿ç”¨hsdbå¤±è´¥äº†ï¼Œå…·ä½“æ˜¯å‘½ä»¤è¡Œæ‰§è¡Œçš„, attach processå¤±è´¥äº†ï¼Œæœäº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ‰§è¡Œèµ·æ¥æŒºéº»çƒ¦çš„ï¼Œå°±æ²¡æ·±ç©¶ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œè¯•ä¸‹\næ‰“å¼€hsdbæœ‰2ç§æ–¹å¼\nä¸€ç§æ˜¯æ‰§è¡Œ$JAVA_HOME/lib/sa-jdi.jarï¼Œå‘½ä»¤è¡Œæ‰§è¡Œjava -classpath sa-jdi.jar \"sun.jvm.hotspot.HSDB\"\nå¦ä¸€ç§æ˜¯ä½¿ç”¨jhsdb hsdbå‘½ä»¤æ‰“å¼€ui, æœ‰çš„jdkç‰ˆæœ¬æ²¡æœ‰sa-jdi.jarï¼Œåªèƒ½ä½¿ç”¨$JAVA_HOME/bin/jhsdbå‘½ä»¤\nCGLIBä»£ç†çš„classæ–‡ä»¶ å¦ä¸€ç§å¸¸ç”¨çš„åŠ¨æ€ç”Ÿæˆä»£ç†ç±»çš„æ–¹å¼æ˜¯ä½¿ç”¨cglibåº“ï¼Œåº•å±‚æ˜¯åŸºäºASMçš„\ncglibä»£ç†è¾“å‡ºclassæ–‡ä»¶ï¼Œéœ€è¦æŒ‡å®šå‚æ•°\n// æŒ‡å®š CGLIB å°†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¿å­˜è‡³æŒ‡å®šçš„ç£ç›˜è·¯å¾„ä¸‹ System.setProperty(DebuggingClassWriter.DEBUG_LOCATION_PROPERTY, \"/Users/since/git/vamei/out/cglib\"); æˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œcglibä¾èµ–å¦‚ä¸‹\ncglib cglib 3.3.0 ä¸€ä¸ªmainå‡½æ•°ç”¨äºæ‰§è¡Œï¼Œç”Ÿæˆä»£ç†ç±»ï¼ŒEnhancerå¯¹è±¡çš„superClassè®¾ç½®ä¸ºCglibBaseBean, CglibBaseBeanä¸ºè¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼Œç„¶åä½¿ç”¨enhancer.create()åˆ›å»ºä»£ç†å¯¹è±¡\npublic class CglibProxy { public static void main(String[] args) { // æŒ‡å®š CGLIB å°†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¿å­˜è‡³æŒ‡å®šçš„ç£ç›˜è·¯å¾„ä¸‹ System.setProperty(DebuggingClassWriter.DEBUG_LOCATION_PROPERTY, \"/Users/since/git/vamei/out/cglib\"); Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(CglibBaseBean.class); enhancer.setCallback(new CglibCustomizedMethodInterceptor()); CglibBaseBean baseBean = (CglibBaseBean) enhancer.create(); baseBean.say(); } } éœ€è¦ä¸€ä¸ªå®ç°äº†MethodInterceptorçš„ç±»ï¼Œè¿™ä¸ªå’ŒInvocationHandleræ¯”è¾ƒç›¸ä¼¼ã€‚\nåœ¨MethodInterceptoré‡Œæ·»åŠ æ‹¦æˆªçš„é€»è¾‘\nimport net.sf.cglib.proxy.MethodInterceptor; import net.sf.cglib.proxy.MethodProxy; import java.lang.reflect.Method; /** * cglib CustomizedMethodInterceptor * * @author since * @date 2024-09-19 13:25 */ public class CglibCustomizedMethodInterceptor implements MethodInterceptor { @Override public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable { System.out.println(\"invoke \" + method.getName() + \" before ! \"); Object result = methodProxy.invokeSuper(o, objects); System.out.println(\"invoke \" + method.getName() + \" after ! \"); return result; } } ä»£ç†ç±»æŒæœ‰äº†CglibCustomizedMethodInterceptorï¼ŒçœŸæ­£æ‰§è¡Œçš„æ—¶å€™æ˜¯é€šè¿‡CglibCustomizedMethodInterceptorçš„interceptæ–¹æ³•æ‰§è¡Œåˆ°äº†è¢«ä»£ç†çš„ç›®æ ‡ç±»çš„ã€‚\nç„¶åçœ‹ä¸€ä¸‹classæ–‡ä»¶è¾“å‡ºç»“æœï¼Œç”Ÿæˆäº†3ä¸ªä»£ç†ç±»\nCglibBaseBean$$EnhancerByCGLIB$$bf21c123.classæ˜¯ç”Ÿæˆçš„ä»£ç†ç±»ï¼Œå…¶ä»–2ä¸ªæ˜¯ç´¢å¼•ç±»\nä»£ç†ç±»classå…·ä½“å†…å®¹å¦‚ä¸‹\n// // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // package com.fc.se.proxy.cglib; import java.lang.reflect.Method; import net.sf.cglib.core.ReflectUtils; import net.sf.cglib.core.Signature; import net.sf.cglib.proxy.Callback; import net.sf.cglib.proxy.Factory; import net.sf.cglib.proxy.MethodInterceptor; import net.sf.cglib.proxy.MethodProxy; public class CglibBaseBean$$EnhancerByCGLIB$$bf21c123 extends CglibBaseBean implements Factory { private boolean CGLIB$BOUND; public static Object CGLIB$FACTORY_DATA; private static final ThreadLocal CGLIB$THREAD_CALLBACKS; private static final Callback[] CGLIB$STATIC_CALLBACKS; private MethodInterceptor CGLIB$CALLBACK_0; private static Object CGLIB$CALLBACK_FILTER; private static final Method CGLIB$say$0$Method; private static final MethodProxy CGLIB$say$0$Proxy; private static final Object[] CGLIB$emptyArgs; private static final Method CGLIB$equals$1$Method; private static final MethodProxy CGLIB$equals$1$Proxy; private static final Method CGLIB$toString$2$Method; private static final MethodProxy CGLIB$toString$2$Proxy; private static final Method CGLIB$hashCode$3$Method; private static final MethodProxy CGLIB$hashCode$3$Proxy; private static final Method CGLIB$clone$4$Method; private static final MethodProxy CGLIB$clone$4$Proxy; static void CGLIB$STATICHOOK1() { CGLIB$THREAD_CALLBACKS = new ThreadLocal(); CGLIB$emptyArgs = new Object[0]; Class var0 = Class.forName(\"com.fc.se.proxy.cglib.CglibBaseBean$$EnhancerByCGLIB$$bf21c123\"); Class var1; Method[] var10000 = ReflectUtils.findMethods(new String[]{\"equals\", \"(Ljava/lang/Object;)Z\", \"toString\", \"()Ljava/lang/String;\", \"hashCode\", \"()I\", \"clone\", \"()Ljava/lang/Object;\"}, (var1 = Class.forName(\"java.lang.Object\")).getDeclaredMethods()); CGLIB$equals$1$Method = var10000[0]; CGLIB$equals$1$Proxy = MethodProxy.create(var1, var0, \"(Ljava/lang/Object;)Z\", \"equals\", \"CGLIB$equals$1\"); CGLIB$toString$2$Method = var10000[1]; CGLIB$toString$2$Proxy = MethodProxy.create(var1, var0, \"()Ljava/lang/String;\", \"toString\", \"CGLIB$toString$2\"); CGLIB$hashCode$3$Method = var10000[2]; CGLIB$hashCode$3$Proxy = MethodProxy.create(var1, var0, \"()I\", \"hashCode\", \"CGLIB$hashCode$3\"); CGLIB$clone$4$Method = var10000[3]; CGLIB$clone$4$Proxy = MethodProxy.create(var1, var0, \"()Ljava/lang/Object;\", \"clone\", \"CGLIB$clone$4\"); CGLIB$say$0$Method = ReflectUtils.findMethods(new String[]{\"say\", \"()V\"}, (var1 = Class.forName(\"com.fc.se.proxy.cglib.CglibBaseBean\")).getDeclaredMethods())[0]; CGLIB$say$0$Proxy = MethodProxy.create(var1, var0, \"()V\", \"say\", \"CGLIB$say$0\"); } final void CGLIB$say$0() { super.say(); } public final void say() { MethodInterceptor var10000 = this.CGLIB$CALLBACK_0; if (var10000 == null) { CGLIB$BIND_CALLBACKS(this); var10000 = this.CGLIB$CALLBACK_0; } if (var10000 != null) { var10000.intercept(this, CGLIB$say$0$Method, CGLIB$emptyArgs, CGLIB$say$0$Proxy); } else { super.say(); } } final boolean CGLIB$equals$1(Object var1) { return super.equals(var1); } public final boolean equals(Object var1) { MethodInterceptor var10000 = this.CGLIB$CALLBACK_0; if (var10000 == null) { CGLIB$BIND_CALLBACKS(this); var10000 = this.CGLIB$CALLBACK_0; } if (var10000 != null) { Object var2 = var10000.intercept(this, CGLIB$equals$1$Method, new Object[]{var1}, CGLIB$equals$1$Proxy); return var2 == null ? false : (Boolean)var2; } else { return super.equals(var1); } } final String CGLIB$toString$2() { return super.toString(); } public final String toString() { MethodInterceptor var10000 = this.CGLIB$CALLBACK_0; if (var10000 == null) { CGLIB$BIND_CALLBACKS(this); var10000 = this.CGLIB$CALLBACK_0; } return var10000 != null ? (String)var10000.intercept(this, CGLIB$toString$2$Method, CGLIB$emptyArgs, CGLIB$toString$2$Proxy) : super.toString(); } final int CGLIB$hashCode$3() { return super.hashCode(); } public final int hashCode() { MethodInterceptor var10000 = this.CGLIB$CALLBACK_0; if (var10000 == null) { CGLIB$BIND_CALLBACKS(this); var10000 = this.CGLIB$CALLBACK_0; } if (var10000 != null) { Object var1 = var10000.intercept(this, CGLIB$hashCode$3$Method, CGLIB$emptyArgs, CGLIB$hashCode$3$Proxy); return var1 == null ? 0 : ((Number)var1).intValue(); } else { return super.hashCode(); } } final Object CGLIB$clone$4() throws CloneNotSupportedException { return super.clone(); } protected final Object clone() throws CloneNotSupportedException { MethodInterceptor var10000 = this.CGLIB$CALLBACK_0; if (var10000 == null) { CGLIB$BIND_CALLBACKS(this); var10000 = this.CGLIB$CALLBACK_0; } return var10000 != null ? var10000.intercept(this, CGLIB$clone$4$Method, CGLIB$emptyArgs, CGLIB$clone$4$Proxy) : super.clone(); } public static MethodProxy CGLIB$findMethodProxy(Signature var0) { String var10000 = var0.toString(); switch (var10000.hashCode()) { case -909388886: if (var10000.equals(\"say()V\")) { return CGLIB$say$0$Proxy; } break; case -508378822: if (var10000.equals(\"clone()Ljava/lang/Object;\")) { return CGLIB$clone$4$Proxy; } break; case 1826985398: if (var10000.equals(\"equals(Ljava/lang/Object;)Z\")) { return CGLIB$equals$1$Proxy; } break; case 1913648695: if (var10000.equals(\"toString()Ljava/lang/String;\")) { return CGLIB$toString$2$Proxy; } break; case 1984935277: if (var10000.equals(\"hashCode()I\")) { return CGLIB$hashCode$3$Proxy; } } return null; } public CglibBaseBean$$EnhancerByCGLIB$$bf21c123() { CGLIB$BIND_CALLBACKS(this); } public static void CGLIB$SET_THREAD_CALLBACKS(Callback[] var0) { CGLIB$THREAD_CALLBACKS.set(var0); } public static void CGLIB$SET_STATIC_CALLBACKS(Callback[] var0) { CGLIB$STATIC_CALLBACKS = var0; } private static final void CGLIB$BIND_CALLBACKS(Object var0) { CglibBaseBean$$EnhancerByCGLIB$$bf21c123 var1 = (CglibBaseBean$$EnhancerByCGLIB$$bf21c123)var0; if (!var1.CGLIB$BOUND) { var1.CGLIB$BOUND = true; Object var10000 = CGLIB$THREAD_CALLBACKS.get(); if (var10000 == null) { var10000 = CGLIB$STATIC_CALLBACKS; if (var10000 == null) { return; } } var1.CGLIB$CALLBACK_0 = (MethodInterceptor)((Callback[])var10000)[0]; } } public Object newInstance(Callback[] var1) { CGLIB$SET_THREAD_CALLBACKS(var1); CglibBaseBean$$EnhancerByCGLIB$$bf21c123 var10000 = new CglibBaseBean$$EnhancerByCGLIB$$bf21c123(); CGLIB$SET_THREAD_CALLBACKS((Callback[])null); return var10000; } public Object newInstance(Callback var1) { CGLIB$SET_THREAD_CALLBACKS(new Callback[]{var1}); CglibBaseBean$$EnhancerByCGLIB$$bf21c123 var10000 = new CglibBaseBean$$EnhancerByCGLIB$$bf21c123(); CGLIB$SET_THREAD_CALLBACKS((Callback[])null); return var10000; } public Object newInstance(Class[] var1, Object[] var2, Callback[] var3) { CGLIB$SET_THREAD_CALLBACKS(var3); CglibBaseBean$$EnhancerByCGLIB$$bf21c123 var10000 = new CglibBaseBean$$EnhancerByCGLIB$$bf21c123; switch (var1.length) { case 0: var10000.\u003cinit\u003e(); CGLIB$SET_THREAD_CALLBACKS((Callback[])null); return var10000; default: throw new IllegalArgumentException(\"Constructor not found\"); } } public Callback getCallback(int var1) { CGLIB$BIND_CALLBACKS(this); MethodInterceptor var10000; switch (var1) { case 0: var10000 = this.CGLIB$CALLBACK_0; break; default: var10000 = null; } return var10000; } public void setCallback(int var1, Callback var2) { switch (var1) { case 0: this.CGLIB$CALLBACK_0 = (MethodInterceptor)var2; default: } } public Callback[] getCallbacks() { CGLIB$BIND_CALLBACKS(this); return new Callback[]{this.CGLIB$CALLBACK_0}; } public void setCallbacks(Callback[] var1) { this.CGLIB$CALLBACK_0 = (MethodInterceptor)var1[0]; } static { CGLIB$STATICHOOK1(); } } ä»ä¸Šé¢çš„classæ–‡ä»¶å¯ä»¥çœ‹å‡ºï¼Œç”Ÿæˆçš„ä»£ç†ç±»ç»§æ‰¿äº†CglibBaseBeanï¼Œæ‰€ä»¥cglibç›¸æ¯”äºjdkåŠ¨æ€ä»£ç†ï¼Œè¢«ä»£ç†ç±»å¯ä»¥ä¸ç”¨éå¾—æ˜¯æ¥å£\nä½¿ç”¨Agentè¾“å‡ºclassæ–‡ä»¶ å†ä¸€ç§æ–¹å¼å°±æ˜¯ä½¿ç”¨Instrument, è¿™æ˜¯jdk5æä¾›çš„èƒ½åŠ›ã€‚\nå…³äºinstrumentæœºåˆ¶çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸€ç¯‡æ–‡ç« https://cnkirito.moe/instrument/\nå¦‚ä½•æ­å»ºä¸€ä¸ªdemoè¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„æ–‡ç« ï¼Œæµ‹è¯•çš„ä»£ç å¯ä»¥åœ¨ gitä»“åº“æŸ¥çœ‹\ngit cloneä¹‹åï¼Œæ‰§è¡Œmvn clean packageç”Ÿæˆagent.jarï¼Œ åœ¨ç›®æ ‡è¿›ç¨‹æ·»åŠ jvmå‚æ•°-javaagent:/Users/since/git/agent/target/agent.jar=-d=/Users/since/test/;-f=com/alibaba/dubbo/registry\nå³å¯è¾“å‡ºåŠ¨æ€ä»£ç†ç±»çš„å†…å®¹\n-javaagent:/Users/since/git/agent/target/agent.jar è¿™ä¸ªæ˜¯agentçš„æ–‡ä»¶è·¯å¾„\n-d=/Users/since/test/æ˜¯ç»“æœçš„è¾“å‡ºè·¯å¾„\n-f=com/alibaba/dubbo/registryæ˜¯è¦æ‰“å°çš„ç±»çš„å‰ç¼€åŒ…è·¯å¾„\nä¸‹é¢æ¥ç®€å•è¯´ä¸€ä¸‹å¦‚ä½•ç¼–å†™agentä»£ç ï¼Œå®ç°class dump\nagenté¡¹ç›®ç»“æ„å¦‚ä¸‹\né¦–å…ˆæ˜¯è¦åœ¨META-INFä¸‹æ·»åŠ ä¸€ä¸ªMANIFEST.MFï¼Œé‡Œé¢æŒ‡å®šç‰ˆæœ¬å·ï¼Œä¸»ç±»ï¼Œæ˜¯å¦å¯ä»¥é‡å»ºç±»ç­‰å±æ€§\næŒ‡å®šçš„premain-classæ˜¯com.fc.agent.GreetingAgentï¼Œæ‰€ä»¥agentçš„å…¥å£å°±æ˜¯GreetingAgentäº†ã€‚\næ¥çœ‹ä¸€ä¸‹GreetingAgent\nç±»é‡Œæœ‰ä¸€ä¸ªpremainæ–¹æ³•ï¼Œå’Œmainæ–¹æ³•æ¯”è¾ƒåƒï¼Œoptionsæ˜¯ä¼ å…¥çš„å‚æ•°ï¼Œä»¥ä¸Šé¢ä¸ºä¾‹ï¼Œè¿è¡Œæ—¶optionsä¸º-d=/Users/since/test/;-f=com/alibaba/dubbo/registryã€‚\nInstrumentation ä¾¿æ˜¯ JAVA5 çš„ Instrument æœºåˆ¶çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£ä¸ºç±»æ·»åŠ  ClassFileTransformer çš„å®ç°ï¼Œä»è€Œå¯¹ç±»è¿›è¡Œè£…é…å¢å¼ºä¿®æ”¹\næ³¨æ„ premain å’Œå®ƒçš„ä¸¤ä¸ªå‚æ•°ä¸èƒ½éšæ„ä¿®æ”¹ï¼Œ è§„å®šæ˜¯è¿™æ ·ï¼Œä¸è¦ä¿®æ”¹ã€‚\næˆ‘ä»¬ä¸ºinsæ·»åŠ äº†ä¸€ä¸ªClazzDumpCustomTransformerï¼Œ å¯¹optionsè¿›è¡Œè§£æï¼Œè§£æå‡ºæ–‡ä»¶è¾“å‡ºè·¯å¾„ï¼Œä»¥åŠè¦è¾“å‡ºçš„åŒ…çš„è·¯å¾„ã€‚\nè¿™é‡Œæˆ‘æƒ³è§‚å¯Ÿdubboçš„adaptiveä»£ç†ï¼Œæ‰€ä»¥-fä¼ çš„æ˜¯dubboçš„åŒ…è·¯å¾„\nimport java.lang.instrument.Instrumentation; /** * * * @author since * @date 2024-08-21 13:43 */ public class GreetingAgent { public static void premain(String options, Instrumentation ins) { if (options != null) { System.out.printf(\"I've been called with options: \\\"%s\\\"\\n\", options); } else { System.out.println(\"I've been called with no options.\"); } ClazzDumpCustomTransformer transformer = getTransformer(options); //æ›´æ¢ä¸åŒçš„transformer ins.addTransformer(transformer); } public static ClazzDumpCustomTransformer getTransformer(String options) { String exportDir = null; String filterStr = null; boolean recursiveDir = false; if (options != null) { if (options.contains(\";\")) { String[] args = options.split(\";\"); for (String param1 : args) { String[] kv = param1.split(\"=\"); if (\"-d\".equalsIgnoreCase(kv[0])) { exportDir = kv[1]; } else if (\"-f\".equalsIgnoreCase(kv[0])) { filterStr = kv[1]; } else if (\"-r\".equalsIgnoreCase(kv[0])) { recursiveDir = true; } } } else { filterStr = options; } } System.out.println(\"getTransformer, exportDir: \" + exportDir + \", filterStr: \" + filterStr + \", recursiveDir: \" + recursiveDir); return new ClazzDumpCustomTransformer(exportDir, filterStr, recursiveDir); } } ClazzDumpCustomTransformerè´Ÿè´£dump classï¼Œå¯¹ç¬¦åˆæ¡ä»¶çš„classï¼Œè·å–æ–‡ä»¶å†…å®¹ï¼Œè¾“å‡ºåˆ°æŒ‡å®šç›®å½•ä¸‹\nimport java.io.File; import java.io.FileInputStream; import java.io.FileOutputStream; import java.lang.instrument.ClassFileTransformer; import java.lang.instrument.IllegalClassFormatException; import java.security.ProtectionDomain; import java.util.Arrays; /** * class dump * * @author since * @date 2024-09-10 13:36 */ public class ClazzDumpCustomTransformer implements ClassFileTransformer { /** * å¯¼å‡ºè¿‡æ»¤è¡¨è¾¾å¼ï¼Œæ­¤å¤„ä¸ºç±»åå‰ç¼€ï¼Œ ä»¥ -f å‚æ•°æŒ‡å®š */ private String filterStr; /** * å¯¼å‡ºæ–‡ä»¶ç›®å½•æ ¹ç›®å½•, ä»¥ -d å‚æ•°æŒ‡å®š */ private String exportBaseDir = \"/tmp/\"; /** * æ˜¯å¦åˆ›å»ºå¤šçº§ç›®å½•, ä»¥ -r å‚æ•°æŒ‡å®š */ private boolean packageRecursive; public ClazzDumpCustomTransformer(String exportBaseDir, String filterStr) { this(exportBaseDir, filterStr, false); } public ClazzDumpCustomTransformer(String exportBaseDir, String filterStr, boolean packageRecursive) { if (exportBaseDir != null) { this.exportBaseDir = exportBaseDir; } this.packageRecursive = packageRecursive; this.filterStr = filterStr; } @Override public byte[] transform(ClassLoader loader, String className, Class\u003c?\u003e classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException { if (needExportClass(className)) { System.out.println(\"needExportClass: \" + className); int lastSeparatorIndex = className.lastIndexOf(\"/\") + 1; String fileName = className.substring(lastSeparatorIndex) + \".class\"; String exportDir = exportBaseDir; if (packageRecursive) { exportDir += className.substring(0, lastSeparatorIndex); } exportClazzToFile(exportDir, fileName, classfileBuffer); //\"D:/server-tool/tmp/bytecode/exported/\" System.out.println(className + \" --\u003e EXPORTED\"); } return classfileBuffer; } /** * æ£€æµ‹æ˜¯å¦éœ€è¦è¿›è¡Œæ–‡ä»¶å¯¼å‡º * * @param className classå,å¦‚ com.xx.abc.AooMock * @return y/n */ private boolean needExportClass(String className) { if (filterStr != null) { return className.startsWith(filterStr); } return !className.startsWith(\"java\") \u0026\u0026 !className.startsWith(\"sun\"); } /** * æ‰§è¡Œæ–‡ä»¶å¯¼å‡ºå†™å…¥ * * @param dirPath å¯¼å‡ºç›®å½• * @param fileName å¯¼å‡ºæ–‡ä»¶å * @param data å­—èŠ‚æµ */ private void exportClazzToFile(String dirPath, String fileName, byte[] data) { try { File dir = new File(dirPath); if (!dir.isDirectory()) { dir.mkdirs(); } File file = new File(dirPath + fileName); if (!file.exists()) { System.out.println(dirPath + fileName + \" is not exist, creating...\"); file.createNewFile(); } else { // String os = System.getProperty(\"os.name\"); // ä¸»è¦é’ˆå¯¹windowsæ–‡ä»¶ä¸åŒºåˆ†å¤§å°å†™é—®é¢˜ // if(os.toLowerCase().startsWith(\"win\")){ // // it's win // } try { int maxLoop = 9999; int renameSuffixId = 2; String[] cc = fileName.split(\"\\\\.\"); do { long fileLen = file.length(); byte[] fileContent = new byte[(int) fileLen]; FileInputStream in = new FileInputStream(file); in.read(fileContent); in.close(); if (!Arrays.equals(fileContent, data)) { fileName = cc[0] + \"_\" + renameSuffixId + \".\" + cc[1]; file = new File(dirPath + fileName); if (!file.exists()) { System.out.println(\"new create file: \" + dirPath + fileName); file.createNewFile(); break; } } else { break; } renameSuffixId++; maxLoop--; } while (maxLoop \u003e 0); } catch (Exception e) { System.err.println(\"exception in read class file..., path: \" + dirPath + fileName); e.printStackTrace(); } } FileOutputStream fos = new FileOutputStream(file); fos.write(data); fos.close(); } catch (Exception e) { System.err.println(\"exception occur while export class.\"); e.printStackTrace(); } } } æ‰§è¡Œmvn clean packageæ‰“åŒ…ä¹‹åï¼Œæ·»åŠ åˆ°ç›®æ ‡è¿›ç¨‹ï¼Œæ·»åŠ å¯åŠ¨å‚æ•°ï¼ŒæŸ¥çœ‹æ‰§è¡Œç»“æœï¼Œåœ¨æ§åˆ¶å°è¾“å‡ºäº†è¦æ‰“å°çš„class\nè¿›å…¥è¾“å‡ºè·¯å¾„ï¼ŒæŸ¥çœ‹å‘ç°éƒ½ç”Ÿæˆäº†å¯¹åº”çš„class\nå°†classæ–‡ä»¶æ‹–è¿›ideaå¯ä»¥æŸ¥çœ‹å…·ä½“å†…å®¹\nä»urlé‡Œå–ç›¸åº”çš„åè®®ï¼Œæ³¨å†Œé»˜è®¤æ˜¯dubboåè®®\nä½¿ç”¨arthasè¾“å‡ºclassæ–‡ä»¶ æåˆ°agentï¼Œé‚£å°±ä¸å¾—ä¸è¯´åˆ°arthasäº†ï¼Œarthasåœ¨è¿è¡Œæ—¶æ’éšœéå¸¸çš„å¥½ç”¨ï¼Œç‚¹ä¸ªèµã€‚\nåŠ¨æ€ä»£ç† å½“ä½¿ç”¨ arthas-boot å¯åŠ¨ Arthas æ—¶ï¼Œå®ƒä¼šä½¿ç”¨ Java çš„ Attach API æ¥å°†è‡ªèº«åŠ¨æ€æ³¨å…¥åˆ°ç›®æ ‡ JVM è¿›ç¨‹ä¸­ã€‚é€šè¿‡é™„åŠ  agentmain æ–¹æ³•ï¼ŒArthas å¯ä»¥å¯¹ JVM è¿›ç¨‹è¿›è¡Œç›‘æ§å’Œä¿®æ”¹\né‚£ä¹ˆæˆ‘ä»¬å°±æ‹¿arthasæ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•æ‰“å°è¿è¡Œæ—¶çš„classæ–‡ä»¶ï¼Œä¸»è¦æ˜¯ä½¿ç”¨jadå‘½ä»¤\narthasçš„å®‰è£…ä½¿ç”¨ç›¸å…³å†…å®¹å‚è€ƒå®˜æ–¹æ–‡æ¡£: https://arthas.aliyun.com/doc/\nä¿®æ”¹ä¸€ä¸‹åŠ¨æ€ä»£ç†çš„æµ‹è¯•ç±»\npublic class DynamicProxyMain { public static void main(String[] args) throws InterruptedException { //åŠ¨æ€ä»£ç†æ—¶ç”Ÿæˆclassæ–‡ä»¶ System.getProperties().put(\"sun.misc.ProxyGenerator.saveGeneratedFiles\",\"true\"); DynamicProxy dynamicProxy = new DynamicProxy(new HumenImpl()); Humen humenProxy = dynamicProxy.getProxy(); humenProxy.eat(\"rice\"); Thread.sleep(100*24*60*60*1000L); //ä¿å­˜$Proxy0åˆ°æ–‡ä»¶ // saveProxyFile(); } è®©è¿›ç¨‹æŒ‚åœ¨è¿™ï¼Œç„¶åå¯åŠ¨arthasï¼Œé€‰æ‹©è¿™ä¸ªè¿›ç¨‹è¿›è¡Œattach\nä½¿ç”¨scå‘½ä»¤æœç´¢åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ç±»: sc *Proxy0*, å¾—åˆ°äº†ä»£ç†ç±»çš„å…¨è·¯å¾„ï¼Œç„¶åä½¿ç”¨jadå‘½ä»¤åç¼–è¯‘classï¼Œå¾—åˆ°åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„æ–‡ä»¶å†…å®¹\nå†æ¥çœ‹ä¸€ä¸‹dubboçš„ç¤ºä¾‹ï¼Œçœ‹çœ‹javassistç”Ÿæˆçš„ä»£ç†ç±»å¦‚ä½•\npublic class DubboSpi { public static void main(String[] args) throws InterruptedException { ExtensionLoader\u003cSimpleExt\u003e extensionLoader = ExtensionLoader.getExtensionLoader(SimpleExt.class); // SimpleExt defaultExtension = extensionLoader.getDefaultExtension(); // SimpleExt dog = extensionLoader.getExtension(\"dog\"); // SimpleExt dog2 = extensionLoader.getExtension(\"dog\", true); // SimpleExt cat = extensionLoader.getExtension(\"cat\"); // dog.yell(null, \"dogdog\"); // SimpleExt dog1 = extensionLoader.getExtension(\"dog\"); // dog1.yell(null, \"dog1\"); SimpleExt adaptiveExtension = extensionLoader.getAdaptiveExtension(); Thread.sleep(100*24*60*60*1000L); URLAddress urlAddress = new URLAddress(\"127.0.0.1\", 20880); URLParam parse = URLParam.parse(new HashMap\u003c\u003e()); adaptiveExtension.echo(new URL(urlAddress, parse), \"dogs\"); adaptiveExtension.bang(new URL(urlAddress, parse),0); } } javassist ä»ç„¶è®©è¿›ç¨‹æŒ‚åœ¨é‚£ï¼Œé‡æ–°å¯åŠ¨arthasè¿›è¡Œattach\nä½¿ç”¨jadåç¼–è¯‘classï¼Œæ­£å¸¸\ncglib è®©è¿›ç¨‹ç©ºè·‘ï¼Œä½¿ç”¨arthasè¿›è¡Œattach\nimport com.alibaba.excel.support.cglib.core.DebuggingClassWriter; import net.sf.cglib.proxy.Enhancer; /** * cglib proxy * * @author since * @date 2024-09-19 13:24 */ public class CglibProxy { public static void main(String[] args) throws InterruptedException { // æŒ‡å®š CGLIB å°†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¿å­˜è‡³æŒ‡å®šçš„ç£ç›˜è·¯å¾„ä¸‹ System.setProperty(DebuggingClassWriter.DEBUG_LOCATION_PROPERTY, \"/Users/since/git/vamei/out/cglib\"); Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(CglibBaseBean.class); enhancer.setCallback(new CglibCustomizedMethodInterceptor()); CglibBaseBean baseBean = (CglibBaseBean) enhancer.create(); baseBean.say(); Thread.sleep(100*24*60*60*1000L); } } ä½¿ç”¨scæœç´¢ç›¸å…³çš„ä»£ç†ç±»ï¼Œç„¶åä½¿ç”¨jadåç¼–è¯‘, ä¹Ÿæ­£å¸¸è¾“å‡ºäº†\næ€»ç»“ æœ¬æ–‡ä»‹ç»äº†ä¸€ä¸‹javaç”ŸæˆåŠ¨æ€ä»£ç†ç±»çš„æ–¹å¼ï¼ŒåƒjdkåŠ¨æ€ä»£ç†ï¼ŒcglibåŠ¨æ€ä»£ç†ï¼Œjavassiståœ¨é¡¹ç›®ä¸­éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚\nå¯¹äºæŸ¥çœ‹åŠ¨æ€ä»£ç†classçš„å†…å®¹ï¼Œä»‹ç»äº†ç›¸å…³çš„æ–¹æ³•è¿›è¡ŒæŸ¥çœ‹ï¼Œä½†æ˜¯ä¸å¤Ÿé€šç”¨ã€‚\né€šè¿‡å†™agentï¼Œäº†è§£äº†agentçš„ä¸€äº›çŸ¥è¯†ï¼Œå¦‚ä½•ä½¿ç”¨instrumentæœºåˆ¶åœ¨å¯åŠ¨æ—¶å’Œè¿è¡Œæ—¶å¢åŠ class\nä½†æ˜¯ç›¸æ¯”äºè‡ªå·±å†™agentï¼Œè¿˜æ˜¯arthasæ›´åŠ çš„æ–¹ä¾¿é€šç”¨ä¸€ç‚¹ï¼Œä¸ç”¨æ‰“agentåŒ…ï¼Œä¹Ÿä¸ç”¨æ·»åŠ å¯åŠ¨å‚æ•°å»é‡å¯è¿›ç¨‹ã€‚\narthasç›´æ¥attachåˆ°ç›®æ ‡è¿›ç¨‹ä¸Šï¼Œå¯ä»¥æ¨¡ç³ŠæŸ¥è¯¢ç±»ï¼Œç„¶åä½¿ç”¨jadè¿›è¡Œåç¼–è¯‘ï¼Œéå¸¸çš„æ–¹ä¾¿ã€‚\narthasä½œä¸ºä¸€ä¸ªç”Ÿäº§æ’éšœå·¥å…·ï¼Œè¿˜æœ‰å…¶ä»–æ›´å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œå€¼å¾—å»äº†è§£å­¦ä¹ \n","wordCount":"7279","inLanguage":"zh","datePublished":"2024-09-11T15:40:13+08:00","dateModified":"2024-09-11T15:40:13+08:00","author":{"@type":"Person","name":"since"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.thend03.com/posts/tech/view-jvm-dynamic-class-detail/"},"publisher":{"@type":"Organization","name":"ç«™åœ¨æµ·è¾¹çœ‹è¿œæ–¹","logo":{"@type":"ImageObject","url":"https://blog.thend03.com/img/logo.jpg"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.thend03.com/ accesskey=h title="thend03 (Alt + H)"><img src=https://blog.thend03.com/img/logo.jpg alt=logo aria-label=logo height=35>thend03</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://blog.thend03.com/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://blog.thend03.com/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://blog.thend03.com/archives/ title="â±ï¸ å½’æ¡£"><span>â±ï¸ å½’æ¡£</span></a></li><li><a href=https://blog.thend03.com/tags title="ğŸ§© æ ‡ç­¾"><span>ğŸ§© æ ‡ç­¾</span></a></li><li><a href=https://blog.thend03.com/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li><li><a href=https://blog.thend03.com/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://blog.thend03.com/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://blog.thend03.com/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://blog.thend03.com/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>å¦‚ä½•æŸ¥çœ‹jvmè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†classæ–‡ä»¶</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2024-09-11
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>7279å­—
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>15åˆ†é’Ÿ
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>since
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://blog.thend03.com/tags/java/ style=color:var(--secondary)!important>Java</a>
</span></span></span></span><span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;
</span></span><span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://blog.thend03.com/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:"https://twikoo-e1f2-2yfafx14j-thend03s-projects.vercel.app/",region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#java%e7%94%9f%e6%88%90%e4%bb%a3%e7%90%86%e7%b1%bb%e7%9a%84%e6%96%b9%e5%bc%8f aria-label=Javaç”Ÿæˆä»£ç†ç±»çš„æ–¹å¼>Javaç”Ÿæˆä»£ç†ç±»çš„æ–¹å¼</a><ul><li><a href=#jdk%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86 aria-label=JDKåŠ¨æ€ä»£ç†>JDKåŠ¨æ€ä»£ç†</a></li><li><a href=#cglib%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86 aria-label=CGLIBåŠ¨æ€ä»£ç†>CGLIBåŠ¨æ€ä»£ç†</a></li><li><a href=#javassist aria-label=Javassist>Javassist</a></li><li><a href=#asm aria-label=ASM>ASM</a></li></ul></li><li><a href=#dubbo%e7%9b%b8%e5%85%b3%e4%bb%a3%e7%90%86%e7%b1%bb%e7%9a%84class%e6%96%87%e4%bb%b6 aria-label=Dubboç›¸å…³ä»£ç†ç±»çš„classæ–‡ä»¶>Dubboç›¸å…³ä»£ç†ç±»çš„classæ–‡ä»¶</a></li><li><a href=#jdk%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86%e7%9a%84class%e6%96%87%e4%bb%b6 aria-label=JDKåŠ¨æ€ä»£ç†çš„classæ–‡ä»¶>JDKåŠ¨æ€ä»£ç†çš„classæ–‡ä»¶</a><ul><li><a href=#%e8%ae%be%e7%bd%ae%e5%8f%82%e6%95%b0 aria-label=è®¾ç½®å‚æ•°>è®¾ç½®å‚æ•°</a></li><li><a href=#%e8%be%93%e5%87%ba%e5%88%b0%e6%96%87%e4%bb%b6 aria-label=è¾“å‡ºåˆ°æ–‡ä»¶>è¾“å‡ºåˆ°æ–‡ä»¶</a></li><li><a href=#hsdb aria-label=hsdb>hsdb</a></li></ul></li><li><a href=#cglib%e4%bb%a3%e7%90%86%e7%9a%84class%e6%96%87%e4%bb%b6 aria-label=CGLIBä»£ç†çš„classæ–‡ä»¶>CGLIBä»£ç†çš„classæ–‡ä»¶</a></li><li><a href=#%e4%bd%bf%e7%94%a8agent%e8%be%93%e5%87%baclass%e6%96%87%e4%bb%b6 aria-label=ä½¿ç”¨Agentè¾“å‡ºclassæ–‡ä»¶>ä½¿ç”¨Agentè¾“å‡ºclassæ–‡ä»¶</a></li><li><a href=#%e4%bd%bf%e7%94%a8arthas%e8%be%93%e5%87%baclass%e6%96%87%e4%bb%b6 aria-label=ä½¿ç”¨arthasè¾“å‡ºclassæ–‡ä»¶>ä½¿ç”¨arthasè¾“å‡ºclassæ–‡ä»¶</a><ul><li><a href=#%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86 aria-label=åŠ¨æ€ä»£ç†>åŠ¨æ€ä»£ç†</a></li><li><a href=#javassist-1 aria-label=javassist>javassist</a></li><li><a href=#cglib aria-label=cglib>cglib</a></li></ul></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=æ€»ç»“>æ€»ç»“</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h1><p>æœ€è¿‘çœ‹dubboçš„æ—¶å€™ï¼Œçœ‹åˆ°äº†è®²spiçš„éƒ¨åˆ†ï¼Œå…¶ä¸­æåˆ°äº†@Adaptiveæ³¨è§£ç”Ÿæˆäº†ä»£ç†ç±»</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409111608009.png alt=image-20240911160843943></p><p>æˆ‘åé¢å»debugäº†ä¸€ä¸‹ï¼Œæ‰“äº†æ–­ç‚¹ï¼Œå‘ç°åœ¨è¿è¡Œæ—¶ï¼Œåªæ˜¯æ˜¾ç¤ºäº†classçš„åç§°ï¼Œç”±äº<strong>RegistryFactory$Adaptive</strong> æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ²¡æœ‰classæ–‡ä»¶ç»“æ„å¯ä»¥çœ‹ï¼Œè€Œæ–‡ç« é‡Œè´´äº†classæ–‡ä»¶ã€‚</p><p>æ‰€ä»¥æ¯”è¾ƒå¥½å¥‡ï¼Œå¦‚ä½•æ‹¿åˆ°classæ–‡ä»¶ã€‚</p><p>ç»è¿‡ä¸€ç•ªæœç´¢éªŒè¯ä¹‹åï¼Œæœ‰äº†å¦‚ä¸‹çš„æ–‡ç« </p><h1 id=javaç”Ÿæˆä»£ç†ç±»çš„æ–¹å¼>Javaç”Ÿæˆä»£ç†ç±»çš„æ–¹å¼<a hidden class=anchor aria-hidden=true href=#javaç”Ÿæˆä»£ç†ç±»çš„æ–¹å¼>#</a></h1><p>é¦–å…ˆå‘¢, javaç”Ÿæˆä»£ç†ç±»æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ã€‚</p><p>åœ¨äº†è§£äº†åŠ¨æ€ä»£ç†çš„ç”Ÿæˆæ–¹å¼ä¹‹åï¼Œå¯ä»¥åˆ†æƒ…å†µè®¨è®ºå¦‚ä½•æ‹¿åˆ°ä»£ç†ç±»çš„classæ–‡ä»¶</p><h2 id=jdkåŠ¨æ€ä»£ç†>JDKåŠ¨æ€ä»£ç†<a hidden class=anchor aria-hidden=true href=#jdkåŠ¨æ€ä»£ç†>#</a></h2><p>è¿™ä¸ªæ˜¯javaè‡ªèº«æ”¯æŒçš„ä»£ç†æ–¹å¼ï¼Œè‡ªå¸¦çš„ï¼Œæ— éœ€å¼•å…¥é¢å¤–ç»„ä»¶ï¼Œä½†æ˜¯åªèƒ½ä»£ç†æ¥å£ã€‚</p><p>å› ä¸ºç”Ÿæˆçš„ä»£ç†ç±»éœ€è¦ç»§æ‰¿Proxyç±»ï¼Œjavaæ˜¯å•ç»§æ‰¿çš„ï¼Œæ‰€ä»¥åªèƒ½ä»£ç†æ¥å£ã€‚</p><h2 id=cglibåŠ¨æ€ä»£ç†>CGLIBåŠ¨æ€ä»£ç†<a hidden class=anchor aria-hidden=true href=#cglibåŠ¨æ€ä»£ç†>#</a></h2><p>cglibå¯ä»¥ä¸ºclassåˆ›å»ºä»£ç†ç±»ï¼Œç±»ä¸å¿…æ˜¯æ¥å£ï¼Œé‡‡ç”¨çš„æ˜¯ç»§æ‰¿å§”æ‰˜ç±»çš„æ–¹å¼ï¼Œå› æ­¤ä¸èƒ½ä»£ç†finalç±»ï¼Œåªèƒ½ä»£ç†æ‰€æœ‰éfinalçš„public/protectedç±»å‹çš„æ–¹æ³•å®šä¹‰ã€‚</p><p>cglibæ˜¯é‡‡ç”¨çš„asmå­—èŠ‚ç æ‹¼æ¥æŠ€æœ¯ï¼Œç»§æ‰¿ä¸€ä¸ªç±»ï¼Œå­ç±»å¯¹æ–¹æ³•è¿›è¡Œæ‹¦æˆªï¼Œç»‡å…¥æ¨ªåˆ‡é€»è¾‘ã€‚</p><h2 id=javassist>Javassist<a hidden class=anchor aria-hidden=true href=#javassist>#</a></h2><p>ä½¿ç”¨javassistå¯ä»¥ç›´æ¥æ“çºµå­—èŠ‚ç ï¼Œç”Ÿæˆä»£ç†ç±»ã€‚</p><p>dubboçš„ä»£ç†ç±»å°±æ˜¯ä½¿ç”¨javassistæ‹¼æ¥å‡ºæ¥çš„</p><h2 id=asm>ASM<a hidden class=anchor aria-hidden=true href=#asm>#</a></h2><p>asmç›¸æ¯”javassistï¼Œæ›´åŠ çš„ç»†ç²’åº¦ï¼Œä¸”å®ç°æ›´åŠ çš„å¤æ‚ã€‚</p><h1 id=dubboç›¸å…³ä»£ç†ç±»çš„classæ–‡ä»¶>Dubboç›¸å…³ä»£ç†ç±»çš„classæ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#dubboç›¸å…³ä»£ç†ç±»çš„classæ–‡ä»¶>#</a></h1><p>å…·ä½“åˆ°dubboçš„è¯ï¼Œ@Adaptiveä¼šç”Ÿæˆç›¸å…³çš„ä»£ç†ç±»ï¼ŒDubboçš„ä»£ç†ç±»æ˜¯ç”¨javaasistç”Ÿæˆçš„ã€‚</p><p>å†å»¶ä¼¸åˆ°è°ƒç”¨è¿‡ç¨‹ï¼Œconsumerè°ƒproviderï¼Œç”Ÿæˆçš„ä»£ç†ç±»æ˜¯jdkåŠ¨æ€ä»£ç†</p><p>providerç«¯è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªwarpperä»£ç†ç±»ï¼Œç”Ÿæˆçš„ä»£ç†ç±»æ˜¯ä½¿ç”¨javassistç”Ÿæˆçš„ï¼Œç„¶åé€šè¿‡Warpper0.invokeMethod()æ ¹æ®å…·ä½“çš„è°ƒç”¨ä¿¡æ¯è°ƒç”¨åˆ°å…·ä½“çš„å®ç°ç±»ã€‚</p><p><strong>æœ¬æ¬¡ä½¿ç”¨çš„dubboç‰ˆæœ¬æ˜¯3.2.0</strong></p><p>å»å¹´å†™äº†ä¸€ç¯‡å…³äº
<a href=https://blog.thend03.com/posts/dubbo-spi/ target=_blank rel=noopener style=color:#e16723 ;>dubbo spi</a>çš„æ–‡ç« ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œä»‹ç»äº†spiçš„ç›¸å…³å®ç°æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨</p><p>å…·ä½“åˆ°Adaptiveä»£ç†ç±»ï¼Œä½¿ç”¨å¦‚ä¸‹çš„æµ‹è¯•ä»£ç (å®Œæ•´çš„è¿‡ç¨‹å¯ä»¥å‚è€ƒä¸Šé¢çš„æ–‡ç« åœ°å€)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DubboSpi</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ExtensionLoader</span><span class=o>&lt;</span><span class=n>SimpleExt</span><span class=o>&gt;</span><span class=w> </span><span class=n>extensionLoader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>SimpleExt</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        SimpleExt defaultExtension = extensionLoader.getDefaultExtension();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        SimpleExt dog = extensionLoader.getExtension(&#34;dog&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        SimpleExt dog2 = extensionLoader.getExtension(&#34;dog&#34;, true);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        SimpleExt cat = extensionLoader.getExtension(&#34;cat&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        dog.yell(null, &#34;dogdog&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        SimpleExt dog1 = extensionLoader.getExtension(&#34;dog&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        dog1.yell(null, &#34;dog1&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>SimpleExt</span><span class=w> </span><span class=n>adaptiveExtension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>extensionLoader</span><span class=p>.</span><span class=na>getAdaptiveExtension</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>URLAddress</span><span class=w> </span><span class=n>urlAddress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>URLAddress</span><span class=p>(</span><span class=s>&#34;127.0.0.1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20880</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>URLParam</span><span class=w> </span><span class=n>parse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>URLParam</span><span class=p>.</span><span class=na>parse</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>adaptiveExtension</span><span class=p>.</span><span class=na>echo</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>URL</span><span class=p>(</span><span class=n>urlAddress</span><span class=p>,</span><span class=w> </span><span class=n>parse</span><span class=p>),</span><span class=w> </span><span class=s>&#34;dogs&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>adaptiveExtension</span><span class=p>.</span><span class=na>bang</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>URL</span><span class=p>(</span><span class=n>urlAddress</span><span class=p>,</span><span class=w> </span><span class=n>parse</span><span class=p>),</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>å®šä½åˆ°å¦‚ä¸‹ç”Ÿæˆä»£ç†ç±»çš„æ–¹æ³•,ä»£ç åœ¨<code>org.apache.dubbo.common.extension.ExtensionLoader#createAdaptiveExtensionClass</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w> </span><span class=kd>private</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>createAdaptiveExtensionClass</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Adaptive Classes&#39; ClassLoader should be the same with Real SPI interface classes&#39; ClassLoader</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ClassLoader</span><span class=w> </span><span class=n>classLoader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>type</span><span class=p>.</span><span class=na>getClassLoader</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>NativeUtils</span><span class=p>.</span><span class=na>isNative</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>classLoader</span><span class=p>.</span><span class=na>loadClass</span><span class=p>(</span><span class=n>type</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;$Adaptive&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>ignore</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//è¿™é‡Œç”Ÿæˆclassæ–‡ä»¶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AdaptiveClassCodeGenerator</span><span class=p>(</span><span class=n>type</span><span class=p>,</span><span class=w> </span><span class=n>cachedDefaultName</span><span class=p>).</span><span class=na>generate</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>compiler</span><span class=p>.</span><span class=na>Compiler</span><span class=w> </span><span class=n>compiler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>extensionDirector</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>compiler</span><span class=p>.</span><span class=na>Compiler</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getAdaptiveExtension</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>compiler</span><span class=p>.</span><span class=na>compile</span><span class=p>(</span><span class=n>type</span><span class=p>,</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>classLoader</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>æˆ‘ä»¬debugçœ‹ä¸€ä¸‹ç”Ÿæˆçš„code, çœ‹ç±»åï¼Œæ˜¯SimpleExt$Adaptive, é€šè¿‡æ‰‹åŠ¨æ‹¼æ¥çš„æ–¹å¼ï¼Œç”Ÿæˆäº†adaptiveä»£ç†ç±»ã€‚</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181525928.png alt=image-20240918152509863></p><p>è°ƒç”¨AdaptiveCompilerï¼Œæœ€ç»ˆcompileerçš„ç±»å‹ä¸º<code>JavassistCompiler</code>ï¼Œå³é€šè¿‡javassistç”Ÿæˆçš„adaptiveä»£ç†ç±»</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181527968.png alt=image-20240918152734919></p><p>é‚£ä¹ˆå›å½’åˆ°æˆ‘ä¸€å¼€å§‹çš„é—®é¢˜ï¼Œå¦‚ä½•æŸ¥çœ‹åŠ¨æ€ç”Ÿæˆçš„classçš„å†…å®¹ï¼Œåœ¨<code>String code = new AdaptiveClassCodeGenerator(type, cachedDefaultName).generate();</code>è¿™ä¸€è¡Œé€šè¿‡debugå°±å¯ä»¥æ‹¿åˆ°å…·ä½“çš„classå†…å®¹äº†</p><p>ç”Ÿæˆçš„ä»£ç†ç±»å¦‚ä¸‹æ‰€ç¤º, å¯¹æ¥å£çš„æ–¹æ³•è¿›è¡Œäº†æ‹¦æˆª</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.fc.rpc.dubbo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.dubbo.rpc.model.ScopeModel</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.dubbo.rpc.model.ScopeModelUtil</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SimpleExt$Adaptive</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>fc</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>SimpleExt</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span><span class=w> </span><span class=nf>yell</span><span class=p>(</span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>URL</span><span class=w> </span><span class=n>arg0</span><span class=p>,</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span><span class=w> </span><span class=n>arg1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>arg0</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;url == null&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>URL</span><span class=w> </span><span class=n>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>arg0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>extName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&#34;key1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&#34;key2&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;dog&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>extName</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&#34;Failed to get extension (com.fc.rpc.dubbo.SimpleExt) name from url (&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>url</span><span class=p>.</span><span class=na>toString</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;) use keys([key1, key2])&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ScopeModel</span><span class=w> </span><span class=n>scopeModel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ScopeModelUtil</span><span class=p>.</span><span class=na>getOrDefault</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getScopeModel</span><span class=p>(),</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>fc</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>SimpleExt</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>com</span><span class=p>.</span><span class=na>fc</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>SimpleExt</span><span class=w> </span><span class=n>extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>com</span><span class=p>.</span><span class=na>fc</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>SimpleExt</span><span class=p>)</span><span class=w> </span><span class=n>scopeModel</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>com</span><span class=p>.</span><span class=na>fc</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>SimpleExt</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getExtension</span><span class=p>(</span><span class=n>extName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>extension</span><span class=p>.</span><span class=na>yell</span><span class=p>(</span><span class=n>arg0</span><span class=p>,</span><span class=w> </span><span class=n>arg1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span><span class=w> </span><span class=nf>echo</span><span class=p>(</span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>URL</span><span class=w> </span><span class=n>arg0</span><span class=p>,</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span><span class=w> </span><span class=n>arg1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>arg0</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;url == null&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>URL</span><span class=w> </span><span class=n>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>arg0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>extName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&#34;simple.ext&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;dog&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>extName</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&#34;Failed to get extension (com.fc.rpc.dubbo.SimpleExt) name from url (&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>url</span><span class=p>.</span><span class=na>toString</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;) use keys([simple.ext])&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ScopeModel</span><span class=w> </span><span class=n>scopeModel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ScopeModelUtil</span><span class=p>.</span><span class=na>getOrDefault</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getScopeModel</span><span class=p>(),</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>fc</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>SimpleExt</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>com</span><span class=p>.</span><span class=na>fc</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>SimpleExt</span><span class=w> </span><span class=n>extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>com</span><span class=p>.</span><span class=na>fc</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>SimpleExt</span><span class=p>)</span><span class=w> </span><span class=n>scopeModel</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>com</span><span class=p>.</span><span class=na>fc</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>SimpleExt</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getExtension</span><span class=p>(</span><span class=n>extName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>extension</span><span class=p>.</span><span class=na>echo</span><span class=p>(</span><span class=n>arg0</span><span class=p>,</span><span class=w> </span><span class=n>arg1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span><span class=w> </span><span class=nf>bang</span><span class=p>(</span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>URL</span><span class=w> </span><span class=n>arg0</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>arg1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UnsupportedOperationException</span><span class=p>(</span><span class=s>&#34;The method public abstract java.lang.String com.fc.rpc.dubbo.SimpleExt.bang(org.apache.dubbo.common.URL,int) of interface com.fc.rpc.dubbo.SimpleExt is not adaptive method!&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>å¦å¤–debugçº§åˆ«çš„è¯ï¼Œç”Ÿæˆçš„classä¼šè¾“å‡ºåˆ°æ—¥å¿—</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181550439.png alt=image-20240918155018371></p><h1 id=jdkåŠ¨æ€ä»£ç†çš„classæ–‡ä»¶>JDKåŠ¨æ€ä»£ç†çš„classæ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#jdkåŠ¨æ€ä»£ç†çš„classæ–‡ä»¶>#</a></h1><p>å›å½’åˆ°jdkçš„åŠ¨æ€ä»£ç†ï¼Œå¦‚ä½•æŸ¥çœ‹jdkåŠ¨æ€ä»£ç†ç”Ÿæˆçš„classæ–‡ä»¶</p><p>è¿™é‡Œä¸»è¦è®²ä¸€ä¸‹å¦‚ä½•æŸ¥çœ‹åŠ¨æ€ä»£ç†çš„classæ–‡ä»¶ï¼ŒåŠ¨æ€ä»£ç†çš„åŸç†å•¥çš„ä¸æ·±å…¥ã€‚</p><h2 id=è®¾ç½®å‚æ•°>è®¾ç½®å‚æ•°<a hidden class=anchor aria-hidden=true href=#è®¾ç½®å‚æ•°>#</a></h2><p>åœ¨è°ƒç”¨ä¹‹å‰ï¼Œæ·»åŠ <code>System.getProperties().put("sun.misc.ProxyGenerator.saveGeneratedFiles","true");</code></p><p>è¿™ä¸ªåªé€‚ç”¨äºjdkåŠ¨æ€ä»£ç†</p><p>å‡†å¤‡ä¸€ä¸‹æµ‹è¯•ç±»</p><p>è¿™æ˜¯è°ƒç”¨å…¥å£</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DynamicProxyMain</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//åŠ¨æ€ä»£ç†æ—¶ç”Ÿæˆclassæ–‡ä»¶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>getProperties</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;sun.misc.ProxyGenerator.saveGeneratedFiles&#34;</span><span class=p>,</span><span class=s>&#34;true&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DynamicProxy</span><span class=w> </span><span class=n>dynamicProxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DynamicProxy</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>HumenImpl</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Humen</span><span class=w> </span><span class=n>humenProxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dynamicProxy</span><span class=p>.</span><span class=na>getProxy</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>humenProxy</span><span class=p>.</span><span class=na>eat</span><span class=p>(</span><span class=s>&#34;rice&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>DynamicProxyå®ç°äº†InvocationHandlerï¼Œç”¨äºç”Ÿæˆä»£ç†ç±»</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.InvocationHandler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DynamicProxy</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>InvocationHandler</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>target</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>DynamicProxy</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>target</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>target</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>invoke</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>proxy</span><span class=p>,</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>method</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>before</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Object</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>method</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>target</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>after</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>before</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;åƒä¸œè¥¿ä¹‹å‰å…ˆçƒ­èº«&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>after</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;åƒå®Œé¥­ä¼‘æ¯ä¸€ä¸‹&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=nf>getProxy</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>T</span><span class=p>)</span><span class=w> </span><span class=n>Proxy</span><span class=p>.</span><span class=na>newProxyInstance</span><span class=p>(</span><span class=n>target</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getClassLoader</span><span class=p>(),</span><span class=n>target</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getInterfaces</span><span class=p>(),</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>æµ‹è¯•ç”¨çš„æ¥å£</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * äººç±»è¿·æƒ‘è¡Œä¸ºå¤§èµ
</span></span></span><span class=line><span class=cl><span class=cm> **/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>Humen</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * åƒä¸œè¥¿
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param food é£Ÿç‰©
</span></span></span><span class=line><span class=cl><span class=cm>    */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>eat</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>food</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>æµ‹è¯•æ¥å£çš„å®ç°ç±»</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * äººç±»è¿·æƒ‘è¡Œä¸ºå¤§èµå…·ä½“æ¡ˆä¾‹
</span></span></span><span class=line><span class=cl><span class=cm> **/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>HumenImpl</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Humen</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>eat</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>food</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;äººç±»å¼€å§‹è¡Œä¸ºè‰ºæœ¯è¡¨æ¼”ï¼šåƒé£Ÿç‰© &#34;</span><span class=o>+</span><span class=n>food</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>é‚£ä¹ˆä¸»è¦çœ‹ä¸€ä¸‹è¿™ä¸ªé…ç½®<code>System.getProperties().put("sun.misc.ProxyGenerator.saveGeneratedFiles","true");</code>è¿™ä¸ªé…ç½®æ˜¯ç”¨äºä¿å­˜ç”Ÿæˆçš„classçš„ã€‚</p><p>ç¼ºç‚¹æ˜¯è¿™ä¸ªå‚æ•°åªé€‚ç”¨äºjdkåŠ¨æ€ä»£ç†</p><p>åŠ ä¸Šè¿™ä¸ªå‚æ•°è¿è¡Œä¸€ä¸‹ï¼Œä¼šå‘ç°ä»£ç†ç±»ä¿å­˜åˆ°äº†é¡¹ç›®è·¯å¾„(classpath)ä¸‹</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181602018.png alt=image-20240918160242965></p><p>çœ‹ä¸€ä¸‹$Proxy0çš„è¯¦ç»†å†…å®¹, ä»£ç†ç±»ç»§æ‰¿äº†Proxy, æ‰€ä»¥jdkåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ¥å£ï¼Œå› ä¸ºJavaæ˜¯å•ç»§æ‰¿çš„</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Source code recreated from a .class file by IntelliJ IDEA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// (powered by FernFlower decompiler)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>package</span><span class=w> </span><span class=nn>com.sun.proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.fc.se.proxy.Humen</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.InvocationHandler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.UndeclaredThrowableException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>class</span> <span class=nc>$Proxy0</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Proxy</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Humen</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>m1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>m2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>m3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>m0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>$Proxy0</span><span class=p>(</span><span class=n>InvocationHandler</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>(</span><span class=n>var1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>equals</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>Boolean</span><span class=p>)</span><span class=kd>super</span><span class=p>.</span><span class=na>h</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>m1</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=p>{</span><span class=n>var1</span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>RuntimeException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Error</span><span class=w> </span><span class=n>var3</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>var3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>var4</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UndeclaredThrowableException</span><span class=p>(</span><span class=n>var4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>toString</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=p>)</span><span class=kd>super</span><span class=p>.</span><span class=na>h</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>m2</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=n>Object</span><span class=o>[]</span><span class=p>)</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>RuntimeException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Error</span><span class=w> </span><span class=n>var2</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>var2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>var3</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UndeclaredThrowableException</span><span class=p>(</span><span class=n>var3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>eat</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>super</span><span class=p>.</span><span class=na>h</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>m3</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=p>{</span><span class=n>var1</span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>RuntimeException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Error</span><span class=w> </span><span class=n>var3</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>var3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>var4</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UndeclaredThrowableException</span><span class=p>(</span><span class=n>var4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>hashCode</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>Integer</span><span class=p>)</span><span class=kd>super</span><span class=p>.</span><span class=na>h</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>m0</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=n>Object</span><span class=o>[]</span><span class=p>)</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>RuntimeException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Error</span><span class=w> </span><span class=n>var2</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>var2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>var3</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UndeclaredThrowableException</span><span class=p>(</span><span class=n>var3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>m1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;java.lang.Object&#34;</span><span class=p>).</span><span class=na>getMethod</span><span class=p>(</span><span class=s>&#34;equals&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;java.lang.Object&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>m2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;java.lang.Object&#34;</span><span class=p>).</span><span class=na>getMethod</span><span class=p>(</span><span class=s>&#34;toString&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>m3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;com.fc.se.proxy.Humen&#34;</span><span class=p>).</span><span class=na>getMethod</span><span class=p>(</span><span class=s>&#34;eat&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;java.lang.String&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>m0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;java.lang.Object&#34;</span><span class=p>).</span><span class=na>getMethod</span><span class=p>(</span><span class=s>&#34;hashCode&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>NoSuchMethodException</span><span class=w> </span><span class=n>var2</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>NoSuchMethodError</span><span class=p>(</span><span class=n>var2</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>ClassNotFoundException</span><span class=w> </span><span class=n>var3</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>NoClassDefFoundError</span><span class=p>(</span><span class=n>var3</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>æ„é€ å‡½æ•°ä¼ å…¥äº†InvocationHandlerï¼Œèµ‹å€¼ç»™äº†æˆå‘˜å˜é‡hï¼Œæ‰€ä»¥æ–¹æ³•çš„è°ƒç”¨éƒ½æ˜¯èµ°çš„InvocationHandlerã€‚</p><p>æœ¬æ¬¡ç¤ºä¾‹ä¸­ä¸ºDynamicProxy</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>public</span> <span class=o>$</span><span class=n>Proxy0</span><span class=p>(</span><span class=n>InvocationHandler</span> <span class=n>var1</span><span class=p>)</span> <span class=n>throws</span>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>super</span><span class=p>(</span><span class=n>var1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>åœ¨é™æ€ä»£ç å—ä¸­ç”Ÿæˆäº†å¯¹åº”çš„æ–¹æ³•ï¼Œç±»é€šç”¨çš„hashCode()ã€toString()ã€equals(), ä»¥åŠéœ€è¦ä»£ç†çš„æ–¹æ³•eat()ã€‚</p><p>$Proxy0è°ƒç”¨eatæ–¹æ³•ï¼Œç„¶åæ‰§è¡Œåˆ°äº†<code>com.fc.se.proxy.DynamicProxy#invoke</code>,</p><p><code>method.invoke(target, args)</code>è°ƒç”¨å…·ä½“çš„å®ç°ç±»æ‰§è¡Œæ–¹æ³•ã€‚</p><h2 id=è¾“å‡ºåˆ°æ–‡ä»¶>è¾“å‡ºåˆ°æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#è¾“å‡ºåˆ°æ–‡ä»¶>#</a></h2><p>ä¸Šä¸€æ­¥ä¸­æˆ‘ä»¬çŸ¥é“äº†ç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åæ˜¯$Proxy0, debugçš„æ—¶å€™ä¹Ÿèƒ½çœ‹åˆ°ç±»åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨æ–¹æ³•å°†è¿™ä¸ªç±»æ‰“å°åˆ°æ–‡ä»¶é‡Œã€‚</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181628208.png alt=image-20240918162848155></p><p>æ›´æ–°åçš„æµ‹è¯•ç±»å…¥å£å¦‚ä¸‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>sun.misc.ProxyGenerator</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.FileOutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.IOException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DynamicProxyMain</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//åŠ¨æ€ä»£ç†æ—¶ç”Ÿæˆclassæ–‡ä»¶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>getProperties</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;sun.misc.ProxyGenerator.saveGeneratedFiles&#34;</span><span class=p>,</span><span class=s>&#34;true&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DynamicProxy</span><span class=w> </span><span class=n>dynamicProxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DynamicProxy</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>HumenImpl</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Humen</span><span class=w> </span><span class=n>humenProxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dynamicProxy</span><span class=p>.</span><span class=na>getProxy</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>humenProxy</span><span class=p>.</span><span class=na>eat</span><span class=p>(</span><span class=s>&#34;rice&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//ä¿å­˜$Proxy0åˆ°æ–‡ä»¶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>saveProxyFile</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>saveProxyFile</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>FileOutputStream</span><span class=w> </span><span class=n>out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>classFile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ProxyGenerator</span><span class=p>.</span><span class=na>generateProxyClass</span><span class=p>(</span><span class=s>&#34;$Proxy0&#34;</span><span class=p>,</span><span class=w> </span><span class=n>HumenImpl</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getInterfaces</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FileOutputStream</span><span class=p>(</span><span class=s>&#34;/Users/since/git/vamei/out/class/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;$Proxy0.class&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>out</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>classFile</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>out</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>out</span><span class=p>.</span><span class=na>flush</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>out</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>æ‰§è¡Œä¹‹åå¯ä»¥å‘ç°å·²ç»ç”Ÿæˆäº†$Proxy0.class</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181638627.png alt=image-20240918163812572></p><p>æ‰€ä»¥çŸ¥é“ç±»åï¼Œå°±å¯ä»¥ä»¥è¿™ç§æ–¹å¼è¾“å‡ºåˆ°æ–‡ä»¶é‡Œ</p><h2 id=hsdb>hsdb<a hidden class=anchor aria-hidden=true href=#hsdb>#</a></h2><p>å¦ä¸€ç§æ˜¯hsdb</p><p>æˆ‘è¿™è¾¹ä½¿ç”¨hsdbå¤±è´¥äº†ï¼Œå…·ä½“æ˜¯å‘½ä»¤è¡Œæ‰§è¡Œçš„, attach processå¤±è´¥äº†ï¼Œæœäº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ‰§è¡Œèµ·æ¥æŒºéº»çƒ¦çš„ï¼Œå°±æ²¡æ·±ç©¶ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œè¯•ä¸‹</p><p>æ‰“å¼€hsdbæœ‰2ç§æ–¹å¼</p><p>ä¸€ç§æ˜¯æ‰§è¡Œ$JAVA_HOME/lib/sa-jdi.jarï¼Œå‘½ä»¤è¡Œæ‰§è¡Œ<code>java -classpath sa-jdi.jar "sun.jvm.hotspot.HSDB"</code></p><p>å¦ä¸€ç§æ˜¯ä½¿ç”¨jhsdb hsdbå‘½ä»¤æ‰“å¼€ui, æœ‰çš„jdkç‰ˆæœ¬æ²¡æœ‰sa-jdi.jarï¼Œåªèƒ½ä½¿ç”¨$JAVA_HOME/bin/jhsdbå‘½ä»¤</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181716411.png alt=image-20240918171627367></p><h1 id=cglibä»£ç†çš„classæ–‡ä»¶>CGLIBä»£ç†çš„classæ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#cglibä»£ç†çš„classæ–‡ä»¶>#</a></h1><p>å¦ä¸€ç§å¸¸ç”¨çš„åŠ¨æ€ç”Ÿæˆä»£ç†ç±»çš„æ–¹å¼æ˜¯ä½¿ç”¨cglibåº“ï¼Œåº•å±‚æ˜¯åŸºäºASMçš„</p><p>cglibä»£ç†è¾“å‡ºclassæ–‡ä»¶ï¼Œéœ€è¦æŒ‡å®šå‚æ•°</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// æŒ‡å®š CGLIB å°†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¿å­˜è‡³æŒ‡å®šçš„ç£ç›˜è·¯å¾„ä¸‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=n>DebuggingClassWriter</span><span class=p>.</span><span class=na>DEBUG_LOCATION_PROPERTY</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/Users/since/git/vamei/out/cglib&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>æˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œcglibä¾èµ–å¦‚ä¸‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;groupId&gt;</span>cglib<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;artifactId&gt;</span>cglib<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;version&gt;</span>3.3.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>ä¸€ä¸ªmainå‡½æ•°ç”¨äºæ‰§è¡Œï¼Œç”Ÿæˆä»£ç†ç±»ï¼ŒEnhancerå¯¹è±¡çš„superClassè®¾ç½®ä¸ºCglibBaseBean, CglibBaseBeanä¸ºè¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼Œç„¶åä½¿ç”¨<code>enhancer.create()</code>åˆ›å»ºä»£ç†å¯¹è±¡</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CglibProxy</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// æŒ‡å®š CGLIB å°†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¿å­˜è‡³æŒ‡å®šçš„ç£ç›˜è·¯å¾„ä¸‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=n>DebuggingClassWriter</span><span class=p>.</span><span class=na>DEBUG_LOCATION_PROPERTY</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/Users/since/git/vamei/out/cglib&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Enhancer</span><span class=w> </span><span class=n>enhancer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Enhancer</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>enhancer</span><span class=p>.</span><span class=na>setSuperclass</span><span class=p>(</span><span class=n>CglibBaseBean</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>enhancer</span><span class=p>.</span><span class=na>setCallback</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>CglibCustomizedMethodInterceptor</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CglibBaseBean</span><span class=w> </span><span class=n>baseBean</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>CglibBaseBean</span><span class=p>)</span><span class=w> </span><span class=n>enhancer</span><span class=p>.</span><span class=na>create</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>baseBean</span><span class=p>.</span><span class=na>say</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>éœ€è¦ä¸€ä¸ªå®ç°äº†MethodInterceptorçš„ç±»ï¼Œè¿™ä¸ªå’Œ<code>InvocationHandler</code>æ¯”è¾ƒç›¸ä¼¼ã€‚</p><p>åœ¨MethodInterceptoré‡Œæ·»åŠ æ‹¦æˆªçš„é€»è¾‘</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>net.sf.cglib.proxy.MethodInterceptor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>net.sf.cglib.proxy.MethodProxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * cglib CustomizedMethodInterceptor
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @author since
</span></span></span><span class=line><span class=cl><span class=cm> * @date 2024-09-19 13:25
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CglibCustomizedMethodInterceptor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>MethodInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>intercept</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>o</span><span class=p>,</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>method</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>objects</span><span class=p>,</span><span class=w> </span><span class=n>MethodProxy</span><span class=w> </span><span class=n>methodProxy</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;invoke &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; before ! &#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Object</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>methodProxy</span><span class=p>.</span><span class=na>invokeSuper</span><span class=p>(</span><span class=n>o</span><span class=p>,</span><span class=w> </span><span class=n>objects</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;invoke &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; after ! &#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>ä»£ç†ç±»æŒæœ‰äº†CglibCustomizedMethodInterceptorï¼ŒçœŸæ­£æ‰§è¡Œçš„æ—¶å€™æ˜¯é€šè¿‡CglibCustomizedMethodInterceptorçš„interceptæ–¹æ³•æ‰§è¡Œåˆ°äº†è¢«ä»£ç†çš„ç›®æ ‡ç±»çš„ã€‚</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409191414295.png alt=image-20240919141408249></p><p>ç„¶åçœ‹ä¸€ä¸‹classæ–‡ä»¶è¾“å‡ºç»“æœï¼Œç”Ÿæˆäº†3ä¸ªä»£ç†ç±»</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409191422204.png alt=image-20240919142222166></p><p>CglibBaseBean$$EnhancerByCGLIB$$bf21c123.classæ˜¯ç”Ÿæˆçš„ä»£ç†ç±»ï¼Œå…¶ä»–2ä¸ªæ˜¯ç´¢å¼•ç±»</p><p>ä»£ç†ç±»classå…·ä½“å†…å®¹å¦‚ä¸‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Source code recreated from a .class file by IntelliJ IDEA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// (powered by FernFlower decompiler)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>package</span><span class=w> </span><span class=nn>com.fc.se.proxy.cglib</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>net.sf.cglib.core.ReflectUtils</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>net.sf.cglib.core.Signature</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>net.sf.cglib.proxy.Callback</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>net.sf.cglib.proxy.Factory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>net.sf.cglib.proxy.MethodInterceptor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>net.sf.cglib.proxy.MethodProxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CglibBaseBean$$EnhancerByCGLIB$$bf21c123</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>CglibBaseBean</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Factory</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>CGLIB$BOUND</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>CGLIB$FACTORY_DATA</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ThreadLocal</span><span class=w> </span><span class=n>CGLIB$THREAD_CALLBACKS</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Callback</span><span class=o>[]</span><span class=w> </span><span class=n>CGLIB$STATIC_CALLBACKS</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>MethodInterceptor</span><span class=w> </span><span class=n>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>CGLIB$CALLBACK_FILTER</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>CGLIB$say$0$Method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MethodProxy</span><span class=w> </span><span class=n>CGLIB$say$0$Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>CGLIB$emptyArgs</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>CGLIB$equals$1$Method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MethodProxy</span><span class=w> </span><span class=n>CGLIB$equals$1$Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>CGLIB$toString$2$Method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MethodProxy</span><span class=w> </span><span class=n>CGLIB$toString$2$Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>CGLIB$hashCode$3$Method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MethodProxy</span><span class=w> </span><span class=n>CGLIB$hashCode$3$Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=n>CGLIB$clone$4$Method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MethodProxy</span><span class=w> </span><span class=n>CGLIB$clone$4$Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>CGLIB$STATICHOOK1</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$THREAD_CALLBACKS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ThreadLocal</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$emptyArgs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Class</span><span class=w> </span><span class=n>var0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;com.fc.se.proxy.cglib.CglibBaseBean$$EnhancerByCGLIB$$bf21c123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Class</span><span class=w> </span><span class=n>var1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Method</span><span class=o>[]</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ReflectUtils</span><span class=p>.</span><span class=na>findMethods</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=p>{</span><span class=s>&#34;equals&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;(Ljava/lang/Object;)Z&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;toString&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;()Ljava/lang/String;&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;hashCode&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;()I&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;clone&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;()Ljava/lang/Object;&#34;</span><span class=p>},</span><span class=w> </span><span class=p>(</span><span class=n>var1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;java.lang.Object&#34;</span><span class=p>)).</span><span class=na>getDeclaredMethods</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$equals$1$Method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>var10000</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$equals$1$Proxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MethodProxy</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>var0</span><span class=p>,</span><span class=w> </span><span class=s>&#34;(Ljava/lang/Object;)Z&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;equals&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;CGLIB$equals$1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$toString$2$Method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>var10000</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$toString$2$Proxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MethodProxy</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>var0</span><span class=p>,</span><span class=w> </span><span class=s>&#34;()Ljava/lang/String;&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;toString&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;CGLIB$toString$2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$hashCode$3$Method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>var10000</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$hashCode$3$Proxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MethodProxy</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>var0</span><span class=p>,</span><span class=w> </span><span class=s>&#34;()I&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;hashCode&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;CGLIB$hashCode$3&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$clone$4$Method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>var10000</span><span class=o>[</span><span class=n>3</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$clone$4$Proxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MethodProxy</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>var0</span><span class=p>,</span><span class=w> </span><span class=s>&#34;()Ljava/lang/Object;&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;clone&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;CGLIB$clone$4&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$say$0$Method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ReflectUtils</span><span class=p>.</span><span class=na>findMethods</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=p>{</span><span class=s>&#34;say&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;()V&#34;</span><span class=p>},</span><span class=w> </span><span class=p>(</span><span class=n>var1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;com.fc.se.proxy.cglib.CglibBaseBean&#34;</span><span class=p>)).</span><span class=na>getDeclaredMethods</span><span class=p>())</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$say$0$Proxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MethodProxy</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>var0</span><span class=p>,</span><span class=w> </span><span class=s>&#34;()V&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;say&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;CGLIB$say$0&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>CGLIB$say$0</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>say</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>say</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MethodInterceptor</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CGLIB$BIND_CALLBACKS</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>var10000</span><span class=p>.</span><span class=na>intercept</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$say$0$Method</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$emptyArgs</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$say$0$Proxy</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>super</span><span class=p>.</span><span class=na>say</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>CGLIB$equals$1</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>var1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>equals</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MethodInterceptor</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CGLIB$BIND_CALLBACKS</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Object</span><span class=w> </span><span class=n>var2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>var10000</span><span class=p>.</span><span class=na>intercept</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$equals$1$Method</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=p>{</span><span class=n>var1</span><span class=p>},</span><span class=w> </span><span class=n>CGLIB$equals$1$Proxy</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>var2</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>Boolean</span><span class=p>)</span><span class=n>var2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>var1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>CGLIB$toString$2</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>toString</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MethodInterceptor</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CGLIB$BIND_CALLBACKS</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=p>)</span><span class=n>var10000</span><span class=p>.</span><span class=na>intercept</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$toString$2$Method</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$emptyArgs</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$toString$2$Proxy</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>CGLIB$hashCode$3</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>hashCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>hashCode</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MethodInterceptor</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CGLIB$BIND_CALLBACKS</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>var10000</span><span class=p>.</span><span class=na>intercept</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$hashCode$3$Method</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$emptyArgs</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$hashCode$3$Proxy</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>var1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>((</span><span class=n>Number</span><span class=p>)</span><span class=n>var1</span><span class=p>).</span><span class=na>intValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>hashCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>CGLIB$clone$4</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CloneNotSupportedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>clone</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>clone</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CloneNotSupportedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MethodInterceptor</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CGLIB$BIND_CALLBACKS</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>var10000</span><span class=p>.</span><span class=na>intercept</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$clone$4$Method</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$emptyArgs</span><span class=p>,</span><span class=w> </span><span class=n>CGLIB$clone$4$Proxy</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>clone</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>MethodProxy</span><span class=w> </span><span class=nf>CGLIB$findMethodProxy</span><span class=p>(</span><span class=n>Signature</span><span class=w> </span><span class=n>var0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>var0</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=p>.</span><span class=na>hashCode</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=o>-</span><span class=n>909388886</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;say()V&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>CGLIB$say$0$Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=o>-</span><span class=n>508378822</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;clone()Ljava/lang/Object;&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>CGLIB$clone$4$Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>1826985398</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;equals(Ljava/lang/Object;)Z&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>CGLIB$equals$1$Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>1913648695</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;toString()Ljava/lang/String;&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>CGLIB$toString$2$Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>1984935277</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;hashCode()I&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>CGLIB$hashCode$3$Proxy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>CglibBaseBean$$EnhancerByCGLIB$$bf21c123</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$BIND_CALLBACKS</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>CGLIB$SET_THREAD_CALLBACKS</span><span class=p>(</span><span class=n>Callback</span><span class=o>[]</span><span class=w> </span><span class=n>var0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$THREAD_CALLBACKS</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>var0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>CGLIB$SET_STATIC_CALLBACKS</span><span class=p>(</span><span class=n>Callback</span><span class=o>[]</span><span class=w> </span><span class=n>var0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$STATIC_CALLBACKS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>var0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>CGLIB$BIND_CALLBACKS</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CglibBaseBean$$EnhancerByCGLIB$$bf21c123</span><span class=w> </span><span class=n>var1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>CglibBaseBean$$EnhancerByCGLIB$$bf21c123</span><span class=p>)</span><span class=n>var0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>var1</span><span class=p>.</span><span class=na>CGLIB$BOUND</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>var1</span><span class=p>.</span><span class=na>CGLIB$BOUND</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Object</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CGLIB$THREAD_CALLBACKS</span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CGLIB$STATIC_CALLBACKS</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>var10000</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>var1</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>MethodInterceptor</span><span class=p>)((</span><span class=n>Callback</span><span class=o>[]</span><span class=p>)</span><span class=n>var10000</span><span class=p>)</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>newInstance</span><span class=p>(</span><span class=n>Callback</span><span class=o>[]</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$SET_THREAD_CALLBACKS</span><span class=p>(</span><span class=n>var1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CglibBaseBean$$EnhancerByCGLIB$$bf21c123</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CglibBaseBean$$EnhancerByCGLIB$$bf21c123</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$SET_THREAD_CALLBACKS</span><span class=p>((</span><span class=n>Callback</span><span class=o>[]</span><span class=p>)</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>var10000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>newInstance</span><span class=p>(</span><span class=n>Callback</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$SET_THREAD_CALLBACKS</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Callback</span><span class=o>[]</span><span class=p>{</span><span class=n>var1</span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CglibBaseBean$$EnhancerByCGLIB$$bf21c123</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CglibBaseBean$$EnhancerByCGLIB$$bf21c123</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$SET_THREAD_CALLBACKS</span><span class=p>((</span><span class=n>Callback</span><span class=o>[]</span><span class=p>)</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>var10000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>newInstance</span><span class=p>(</span><span class=n>Class</span><span class=o>[]</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>var2</span><span class=p>,</span><span class=w> </span><span class=n>Callback</span><span class=o>[]</span><span class=w> </span><span class=n>var3</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$SET_THREAD_CALLBACKS</span><span class=p>(</span><span class=n>var3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CglibBaseBean$$EnhancerByCGLIB$$bf21c123</span><span class=w> </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CglibBaseBean$$EnhancerByCGLIB$$bf21c123</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>var1</span><span class=p>.</span><span class=na>length</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>0</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>var10000</span><span class=p>.</span><span class=o>&lt;</span><span class=n>init</span><span class=o>&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>CGLIB$SET_THREAD_CALLBACKS</span><span class=p>((</span><span class=n>Callback</span><span class=o>[]</span><span class=p>)</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>var10000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;Constructor not found&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Callback</span><span class=w> </span><span class=nf>getCallback</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$BIND_CALLBACKS</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MethodInterceptor</span><span class=w> </span><span class=n>var10000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>0</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>var10000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>var10000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setCallback</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Callback</span><span class=w> </span><span class=n>var2</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>0</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>MethodInterceptor</span><span class=p>)</span><span class=n>var2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Callback</span><span class=o>[]</span><span class=w> </span><span class=nf>getCallbacks</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$BIND_CALLBACKS</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Callback</span><span class=o>[]</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setCallbacks</span><span class=p>(</span><span class=n>Callback</span><span class=o>[]</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>CGLIB$CALLBACK_0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>MethodInterceptor</span><span class=p>)</span><span class=n>var1</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CGLIB$STATICHOOK1</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>ä»ä¸Šé¢çš„classæ–‡ä»¶å¯ä»¥çœ‹å‡ºï¼Œç”Ÿæˆçš„ä»£ç†ç±»ç»§æ‰¿äº†CglibBaseBeanï¼Œæ‰€ä»¥cglibç›¸æ¯”äºjdkåŠ¨æ€ä»£ç†ï¼Œè¢«ä»£ç†ç±»å¯ä»¥ä¸ç”¨éå¾—æ˜¯æ¥å£</p><h1 id=ä½¿ç”¨agentè¾“å‡ºclassæ–‡ä»¶>ä½¿ç”¨Agentè¾“å‡ºclassæ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨agentè¾“å‡ºclassæ–‡ä»¶>#</a></h1><p>å†ä¸€ç§æ–¹å¼å°±æ˜¯ä½¿ç”¨Instrument, è¿™æ˜¯jdk5æä¾›çš„èƒ½åŠ›ã€‚</p><p>å…³äºinstrumentæœºåˆ¶çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸€ç¯‡æ–‡ç« https://cnkirito.moe/instrument/</p><p>å¦‚ä½•æ­å»ºä¸€ä¸ªdemoè¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„æ–‡ç« ï¼Œæµ‹è¯•çš„ä»£ç å¯ä»¥åœ¨
<a href=https://github.com/thend03/agent target=_blank rel=noopener style=color:#e16723 ;>gitä»“åº“</a>æŸ¥çœ‹</p><p>git cloneä¹‹åï¼Œæ‰§è¡Œmvn clean packageç”Ÿæˆagent.jarï¼Œ åœ¨ç›®æ ‡è¿›ç¨‹æ·»åŠ jvmå‚æ•°<code>-javaagent:/Users/since/git/agent/target/agent.jar=-d=/Users/since/test/;-f=com/alibaba/dubbo/registry</code></p><p>å³å¯è¾“å‡ºåŠ¨æ€ä»£ç†ç±»çš„å†…å®¹</p><ul><li><p><code>-javaagent:/Users/since/git/agent/target/agent.jar </code>è¿™ä¸ªæ˜¯agentçš„æ–‡ä»¶è·¯å¾„</p></li><li><p><code>-d=/Users/since/test/</code>æ˜¯ç»“æœçš„è¾“å‡ºè·¯å¾„</p></li><li><p><code>-f=com/alibaba/dubbo/registry</code>æ˜¯è¦æ‰“å°çš„ç±»çš„å‰ç¼€åŒ…è·¯å¾„</p></li></ul><p>ä¸‹é¢æ¥ç®€å•è¯´ä¸€ä¸‹å¦‚ä½•ç¼–å†™agentä»£ç ï¼Œå®ç°class dump</p><p>agenté¡¹ç›®ç»“æ„å¦‚ä¸‹</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181737237.png alt=image-20240918173752186></p><p>é¦–å…ˆæ˜¯è¦åœ¨META-INFä¸‹æ·»åŠ ä¸€ä¸ª<code>MANIFEST.MF</code>ï¼Œé‡Œé¢æŒ‡å®šç‰ˆæœ¬å·ï¼Œä¸»ç±»ï¼Œæ˜¯å¦å¯ä»¥é‡å»ºç±»ç­‰å±æ€§</p><p>æŒ‡å®šçš„premain-classæ˜¯<code>com.fc.agent.GreetingAgent</code>ï¼Œæ‰€ä»¥agentçš„å…¥å£å°±æ˜¯GreetingAgentäº†ã€‚</p><p>æ¥çœ‹ä¸€ä¸‹<code>GreetingAgent</code></p><p>ç±»é‡Œæœ‰ä¸€ä¸ªpremainæ–¹æ³•ï¼Œå’Œmainæ–¹æ³•æ¯”è¾ƒåƒï¼Œoptionsæ˜¯ä¼ å…¥çš„å‚æ•°ï¼Œä»¥ä¸Šé¢ä¸ºä¾‹ï¼Œè¿è¡Œæ—¶optionsä¸º<code>-d=/Users/since/test/;-f=com/alibaba/dubbo/registry</code>ã€‚</p><p>Instrumentation ä¾¿æ˜¯ JAVA5 çš„ Instrument æœºåˆ¶çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£ä¸ºç±»æ·»åŠ  ClassFileTransformer çš„å®ç°ï¼Œä»è€Œå¯¹ç±»è¿›è¡Œè£…é…å¢å¼ºä¿®æ”¹</p><p>æ³¨æ„ premain å’Œå®ƒçš„ä¸¤ä¸ªå‚æ•°ä¸èƒ½éšæ„ä¿®æ”¹ï¼Œ è§„å®šæ˜¯è¿™æ ·ï¼Œä¸è¦ä¿®æ”¹ã€‚</p><p>æˆ‘ä»¬ä¸ºinsæ·»åŠ äº†ä¸€ä¸ªClazzDumpCustomTransformerï¼Œ å¯¹optionsè¿›è¡Œè§£æï¼Œè§£æå‡ºæ–‡ä»¶è¾“å‡ºè·¯å¾„ï¼Œä»¥åŠè¦è¾“å‡ºçš„åŒ…çš„è·¯å¾„ã€‚</p><p>è¿™é‡Œæˆ‘æƒ³è§‚å¯Ÿdubboçš„adaptiveä»£ç†ï¼Œæ‰€ä»¥-fä¼ çš„æ˜¯dubboçš„åŒ…è·¯å¾„</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.instrument.Instrumentation</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @author since
</span></span></span><span class=line><span class=cl><span class=cm> * @date 2024-08-21 13:43
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>GreetingAgent</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>premain</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>options</span><span class=p>,</span><span class=w> </span><span class=n>Instrumentation</span><span class=w> </span><span class=n>ins</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>options</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>printf</span><span class=p>(</span><span class=s>&#34;I&#39;ve been called with options: \&#34;%s\&#34;\n&#34;</span><span class=p>,</span><span class=w> </span><span class=n>options</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;I&#39;ve been called with no options.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ClazzDumpCustomTransformer</span><span class=w> </span><span class=n>transformer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getTransformer</span><span class=p>(</span><span class=n>options</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//æ›´æ¢ä¸åŒçš„transformer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ins</span><span class=p>.</span><span class=na>addTransformer</span><span class=p>(</span><span class=n>transformer</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>ClazzDumpCustomTransformer</span><span class=w> </span><span class=nf>getTransformer</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>options</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>exportDir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>filterStr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>boolean</span><span class=w> </span><span class=n>recursiveDir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>options</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>options</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=s>&#34;;&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>options</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&#34;;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>param1</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>kv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>param1</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&#34;=&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=s>&#34;-d&#34;</span><span class=p>.</span><span class=na>equalsIgnoreCase</span><span class=p>(</span><span class=n>kv</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>exportDir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kv</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=s>&#34;-f&#34;</span><span class=p>.</span><span class=na>equalsIgnoreCase</span><span class=p>(</span><span class=n>kv</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>filterStr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kv</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=s>&#34;-r&#34;</span><span class=p>.</span><span class=na>equalsIgnoreCase</span><span class=p>(</span><span class=n>kv</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>recursiveDir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>filterStr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>options</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;getTransformer, exportDir: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>exportDir</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;, filterStr: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>filterStr</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;, recursiveDir: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>recursiveDir</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ClazzDumpCustomTransformer</span><span class=p>(</span><span class=n>exportDir</span><span class=p>,</span><span class=w> </span><span class=n>filterStr</span><span class=p>,</span><span class=w> </span><span class=n>recursiveDir</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>ClazzDumpCustomTransformerè´Ÿè´£dump classï¼Œå¯¹ç¬¦åˆæ¡ä»¶çš„classï¼Œè·å–æ–‡ä»¶å†…å®¹ï¼Œè¾“å‡ºåˆ°æŒ‡å®šç›®å½•ä¸‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>java.io.File</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.FileInputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.FileOutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.instrument.ClassFileTransformer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.instrument.IllegalClassFormatException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.security.ProtectionDomain</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Arrays</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * class dump
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @author since
</span></span></span><span class=line><span class=cl><span class=cm> * @date 2024-09-10 13:36
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ClazzDumpCustomTransformer</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ClassFileTransformer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * å¯¼å‡ºè¿‡æ»¤è¡¨è¾¾å¼ï¼Œæ­¤å¤„ä¸ºç±»åå‰ç¼€ï¼Œ ä»¥ -f å‚æ•°æŒ‡å®š
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>filterStr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * å¯¼å‡ºæ–‡ä»¶ç›®å½•æ ¹ç›®å½•, ä»¥ -d å‚æ•°æŒ‡å®š
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>exportBaseDir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;/tmp/&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * æ˜¯å¦åˆ›å»ºå¤šçº§ç›®å½•, ä»¥ -r å‚æ•°æŒ‡å®š
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>packageRecursive</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ClazzDumpCustomTransformer</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>exportBaseDir</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>filterStr</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>(</span><span class=n>exportBaseDir</span><span class=p>,</span><span class=w> </span><span class=n>filterStr</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ClazzDumpCustomTransformer</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>exportBaseDir</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>filterStr</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>packageRecursive</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>exportBaseDir</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>exportBaseDir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>exportBaseDir</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>packageRecursive</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>packageRecursive</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>filterStr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>filterStr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span><span class=n>ClassLoader</span><span class=w> </span><span class=n>loader</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>className</span><span class=p>,</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>classBeingRedefined</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>ProtectionDomain</span><span class=w> </span><span class=n>protectionDomain</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>classfileBuffer</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IllegalClassFormatException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>needExportClass</span><span class=p>(</span><span class=n>className</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;needExportClass: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>className</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>int</span><span class=w> </span><span class=n>lastSeparatorIndex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>className</span><span class=p>.</span><span class=na>lastIndexOf</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>fileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>className</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span><span class=n>lastSeparatorIndex</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;.class&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>exportDir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>exportBaseDir</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>packageRecursive</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>exportDir</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>className</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>lastSeparatorIndex</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>exportClazzToFile</span><span class=p>(</span><span class=n>exportDir</span><span class=p>,</span><span class=w> </span><span class=n>fileName</span><span class=p>,</span><span class=w> </span><span class=n>classfileBuffer</span><span class=p>);</span><span class=w>         </span><span class=c1>//&#34;D:/server-tool/tmp/bytecode/exported/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>className</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; --&gt; EXPORTED&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>classfileBuffer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * æ£€æµ‹æ˜¯å¦éœ€è¦è¿›è¡Œæ–‡ä»¶å¯¼å‡º
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param className classå,å¦‚ com.xx.abc.AooMock
</span></span></span><span class=line><span class=cl><span class=cm>     * @return y/n
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>needExportClass</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>className</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>filterStr</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>className</span><span class=p>.</span><span class=na>startsWith</span><span class=p>(</span><span class=n>filterStr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=o>!</span><span class=n>className</span><span class=p>.</span><span class=na>startsWith</span><span class=p>(</span><span class=s>&#34;java&#34;</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=n>className</span><span class=p>.</span><span class=na>startsWith</span><span class=p>(</span><span class=s>&#34;sun&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * æ‰§è¡Œæ–‡ä»¶å¯¼å‡ºå†™å…¥
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param dirPath å¯¼å‡ºç›®å½•
</span></span></span><span class=line><span class=cl><span class=cm>     * @param fileName å¯¼å‡ºæ–‡ä»¶å
</span></span></span><span class=line><span class=cl><span class=cm>     * @param data å­—èŠ‚æµ
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>exportClazzToFile</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>dirPath</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>fileName</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>File</span><span class=w> </span><span class=n>dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>File</span><span class=p>(</span><span class=n>dirPath</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>dir</span><span class=p>.</span><span class=na>isDirectory</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>dir</span><span class=p>.</span><span class=na>mkdirs</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>File</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>File</span><span class=p>(</span><span class=n>dirPath</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>fileName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>file</span><span class=p>.</span><span class=na>exists</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>dirPath</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>fileName</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; is not exist, creating...&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>file</span><span class=p>.</span><span class=na>createNewFile</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//                String os = System.getProperty(&#34;os.name&#34;);        // ä¸»è¦é’ˆå¯¹windowsæ–‡ä»¶ä¸åŒºåˆ†å¤§å°å†™é—®é¢˜</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//                if(os.toLowerCase().startsWith(&#34;win&#34;)){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//                    // it&#39;s win</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//                }</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kt>int</span><span class=w> </span><span class=n>maxLoop</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>9999</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kt>int</span><span class=w> </span><span class=n>renameSuffixId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>cc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fileName</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&#34;\\.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>do</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=kt>long</span><span class=w> </span><span class=n>fileLen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>file</span><span class=p>.</span><span class=na>length</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>fileContent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>byte</span><span class=o>[</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=n>fileLen</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>FileInputStream</span><span class=w> </span><span class=n>in</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FileInputStream</span><span class=p>(</span><span class=n>file</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>in</span><span class=p>.</span><span class=na>read</span><span class=p>(</span><span class=n>fileContent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>in</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>Arrays</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>fileContent</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>fileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cc</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;_&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>renameSuffixId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;.&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>cc</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>File</span><span class=p>(</span><span class=n>dirPath</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>fileName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>file</span><span class=p>.</span><span class=na>exists</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;new create file: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>dirPath</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>fileName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>file</span><span class=p>.</span><span class=na>createNewFile</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>renameSuffixId</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>maxLoop</span><span class=o>--</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>maxLoop</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;exception in read class file..., path: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>dirPath</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>fileName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>FileOutputStream</span><span class=w> </span><span class=n>fos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FileOutputStream</span><span class=p>(</span><span class=n>file</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>fos</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>fos</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;exception occur while export class.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>æ‰§è¡Œmvn clean packageæ‰“åŒ…ä¹‹åï¼Œæ·»åŠ åˆ°ç›®æ ‡è¿›ç¨‹ï¼Œæ·»åŠ å¯åŠ¨å‚æ•°ï¼ŒæŸ¥çœ‹æ‰§è¡Œç»“æœï¼Œåœ¨æ§åˆ¶å°è¾“å‡ºäº†è¦æ‰“å°çš„class</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181748247.png alt=image-20240918174830197></p><p>è¿›å…¥è¾“å‡ºè·¯å¾„ï¼ŒæŸ¥çœ‹å‘ç°éƒ½ç”Ÿæˆäº†å¯¹åº”çš„class</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181750507.png alt=image-20240918175035451></p><p>å°†classæ–‡ä»¶æ‹–è¿›ideaå¯ä»¥æŸ¥çœ‹å…·ä½“å†…å®¹</p><p>ä»urlé‡Œå–ç›¸åº”çš„åè®®ï¼Œæ³¨å†Œé»˜è®¤æ˜¯dubboåè®®</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409181754182.png alt=image-20240918175435124></p><h1 id=ä½¿ç”¨arthasè¾“å‡ºclassæ–‡ä»¶>ä½¿ç”¨arthasè¾“å‡ºclassæ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨arthasè¾“å‡ºclassæ–‡ä»¶>#</a></h1><p>æåˆ°agentï¼Œé‚£å°±ä¸å¾—ä¸è¯´åˆ°arthasäº†ï¼Œarthasåœ¨è¿è¡Œæ—¶æ’éšœéå¸¸çš„å¥½ç”¨ï¼Œç‚¹ä¸ªèµã€‚</p><h2 id=åŠ¨æ€ä»£ç†>åŠ¨æ€ä»£ç†<a hidden class=anchor aria-hidden=true href=#åŠ¨æ€ä»£ç†>#</a></h2><p>å½“ä½¿ç”¨ <code>arthas-boot</code> å¯åŠ¨ Arthas æ—¶ï¼Œå®ƒä¼šä½¿ç”¨ Java çš„ <strong>Attach API</strong> æ¥å°†è‡ªèº«åŠ¨æ€æ³¨å…¥åˆ°ç›®æ ‡ JVM è¿›ç¨‹ä¸­ã€‚é€šè¿‡é™„åŠ  <code>agentmain</code> æ–¹æ³•ï¼ŒArthas å¯ä»¥å¯¹ JVM è¿›ç¨‹è¿›è¡Œç›‘æ§å’Œä¿®æ”¹</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±æ‹¿arthasæ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•æ‰“å°è¿è¡Œæ—¶çš„classæ–‡ä»¶ï¼Œä¸»è¦æ˜¯ä½¿ç”¨jadå‘½ä»¤</p><p>arthasçš„å®‰è£…ä½¿ç”¨ç›¸å…³å†…å®¹å‚è€ƒå®˜æ–¹æ–‡æ¡£:
<a href=https://arthas.aliyun.com/doc/ target=_blank rel=noopener style=color:#e16723 ;>https://arthas.aliyun.com/doc/</a></p><p>ä¿®æ”¹ä¸€ä¸‹åŠ¨æ€ä»£ç†çš„æµ‹è¯•ç±»</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DynamicProxyMain</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//åŠ¨æ€ä»£ç†æ—¶ç”Ÿæˆclassæ–‡ä»¶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>getProperties</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;sun.misc.ProxyGenerator.saveGeneratedFiles&#34;</span><span class=p>,</span><span class=s>&#34;true&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DynamicProxy</span><span class=w> </span><span class=n>dynamicProxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DynamicProxy</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>HumenImpl</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Humen</span><span class=w> </span><span class=n>humenProxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dynamicProxy</span><span class=p>.</span><span class=na>getProxy</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>humenProxy</span><span class=p>.</span><span class=na>eat</span><span class=p>(</span><span class=s>&#34;rice&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>100</span><span class=o>*</span><span class=n>24</span><span class=o>*</span><span class=n>60</span><span class=o>*</span><span class=n>60</span><span class=o>*</span><span class=n>1000L</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//ä¿å­˜$Proxy0åˆ°æ–‡ä»¶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        saveProxyFile();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>è®©è¿›ç¨‹æŒ‚åœ¨è¿™ï¼Œç„¶åå¯åŠ¨arthasï¼Œé€‰æ‹©è¿™ä¸ªè¿›ç¨‹è¿›è¡Œattach</p><p>ä½¿ç”¨scå‘½ä»¤æœç´¢åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ç±»: <code>sc *Proxy0*</code>, å¾—åˆ°äº†ä»£ç†ç±»çš„å…¨è·¯å¾„ï¼Œç„¶åä½¿ç”¨jadå‘½ä»¤åç¼–è¯‘classï¼Œå¾—åˆ°åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„æ–‡ä»¶å†…å®¹</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409191128855.png alt=image-20240919112806799></p><p>å†æ¥çœ‹ä¸€ä¸‹dubboçš„ç¤ºä¾‹ï¼Œçœ‹çœ‹javassistç”Ÿæˆçš„ä»£ç†ç±»å¦‚ä½•</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DubboSpi</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ExtensionLoader</span><span class=o>&lt;</span><span class=n>SimpleExt</span><span class=o>&gt;</span><span class=w> </span><span class=n>extensionLoader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>SimpleExt</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        SimpleExt defaultExtension = extensionLoader.getDefaultExtension();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        SimpleExt dog = extensionLoader.getExtension(&#34;dog&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        SimpleExt dog2 = extensionLoader.getExtension(&#34;dog&#34;, true);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        SimpleExt cat = extensionLoader.getExtension(&#34;cat&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        dog.yell(null, &#34;dogdog&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        SimpleExt dog1 = extensionLoader.getExtension(&#34;dog&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        dog1.yell(null, &#34;dog1&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>SimpleExt</span><span class=w> </span><span class=n>adaptiveExtension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>extensionLoader</span><span class=p>.</span><span class=na>getAdaptiveExtension</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>100</span><span class=o>*</span><span class=n>24</span><span class=o>*</span><span class=n>60</span><span class=o>*</span><span class=n>60</span><span class=o>*</span><span class=n>1000L</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>URLAddress</span><span class=w> </span><span class=n>urlAddress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>URLAddress</span><span class=p>(</span><span class=s>&#34;127.0.0.1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20880</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>URLParam</span><span class=w> </span><span class=n>parse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>URLParam</span><span class=p>.</span><span class=na>parse</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>adaptiveExtension</span><span class=p>.</span><span class=na>echo</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>URL</span><span class=p>(</span><span class=n>urlAddress</span><span class=p>,</span><span class=w> </span><span class=n>parse</span><span class=p>),</span><span class=w> </span><span class=s>&#34;dogs&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>adaptiveExtension</span><span class=p>.</span><span class=na>bang</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>URL</span><span class=p>(</span><span class=n>urlAddress</span><span class=p>,</span><span class=w> </span><span class=n>parse</span><span class=p>),</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=javassist-1>javassist<a hidden class=anchor aria-hidden=true href=#javassist-1>#</a></h2><p>ä»ç„¶è®©è¿›ç¨‹æŒ‚åœ¨é‚£ï¼Œé‡æ–°å¯åŠ¨arthasè¿›è¡Œattach</p><p>ä½¿ç”¨jadåç¼–è¯‘classï¼Œæ­£å¸¸</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409191307947.png alt=image-20240919130747879></p><h2 id=cglib>cglib<a hidden class=anchor aria-hidden=true href=#cglib>#</a></h2><p>è®©è¿›ç¨‹ç©ºè·‘ï¼Œä½¿ç”¨arthasè¿›è¡Œattach</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.excel.support.cglib.core.DebuggingClassWriter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>net.sf.cglib.proxy.Enhancer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * cglib proxy
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @author since
</span></span></span><span class=line><span class=cl><span class=cm> * @date 2024-09-19 13:24
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CglibProxy</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// æŒ‡å®š CGLIB å°†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¿å­˜è‡³æŒ‡å®šçš„ç£ç›˜è·¯å¾„ä¸‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=n>DebuggingClassWriter</span><span class=p>.</span><span class=na>DEBUG_LOCATION_PROPERTY</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/Users/since/git/vamei/out/cglib&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Enhancer</span><span class=w> </span><span class=n>enhancer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Enhancer</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>enhancer</span><span class=p>.</span><span class=na>setSuperclass</span><span class=p>(</span><span class=n>CglibBaseBean</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>enhancer</span><span class=p>.</span><span class=na>setCallback</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>CglibCustomizedMethodInterceptor</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CglibBaseBean</span><span class=w> </span><span class=n>baseBean</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>CglibBaseBean</span><span class=p>)</span><span class=w> </span><span class=n>enhancer</span><span class=p>.</span><span class=na>create</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>baseBean</span><span class=p>.</span><span class=na>say</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>100</span><span class=o>*</span><span class=n>24</span><span class=o>*</span><span class=n>60</span><span class=o>*</span><span class=n>60</span><span class=o>*</span><span class=n>1000L</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>ä½¿ç”¨scæœç´¢ç›¸å…³çš„ä»£ç†ç±»ï¼Œç„¶åä½¿ç”¨jadåç¼–è¯‘, ä¹Ÿæ­£å¸¸è¾“å‡ºäº†</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202409191742338.png alt=image-20240919174244260></p><h1 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h1><p>æœ¬æ–‡ä»‹ç»äº†ä¸€ä¸‹javaç”ŸæˆåŠ¨æ€ä»£ç†ç±»çš„æ–¹å¼ï¼ŒåƒjdkåŠ¨æ€ä»£ç†ï¼ŒcglibåŠ¨æ€ä»£ç†ï¼Œjavassiståœ¨é¡¹ç›®ä¸­éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚</p><p>å¯¹äºæŸ¥çœ‹åŠ¨æ€ä»£ç†classçš„å†…å®¹ï¼Œä»‹ç»äº†ç›¸å…³çš„æ–¹æ³•è¿›è¡ŒæŸ¥çœ‹ï¼Œä½†æ˜¯ä¸å¤Ÿé€šç”¨ã€‚</p><p>é€šè¿‡å†™agentï¼Œäº†è§£äº†agentçš„ä¸€äº›çŸ¥è¯†ï¼Œå¦‚ä½•ä½¿ç”¨instrumentæœºåˆ¶åœ¨å¯åŠ¨æ—¶å’Œè¿è¡Œæ—¶å¢åŠ class</p><p>ä½†æ˜¯ç›¸æ¯”äºè‡ªå·±å†™agentï¼Œè¿˜æ˜¯arthasæ›´åŠ çš„æ–¹ä¾¿é€šç”¨ä¸€ç‚¹ï¼Œä¸ç”¨æ‰“agentåŒ…ï¼Œä¹Ÿä¸ç”¨æ·»åŠ å¯åŠ¨å‚æ•°å»é‡å¯è¿›ç¨‹ã€‚</p><p>arthasç›´æ¥attachåˆ°ç›®æ ‡è¿›ç¨‹ä¸Šï¼Œå¯ä»¥æ¨¡ç³ŠæŸ¥è¯¢ç±»ï¼Œç„¶åä½¿ç”¨jadè¿›è¡Œåç¼–è¯‘ï¼Œéå¸¸çš„æ–¹ä¾¿ã€‚</p><p>arthasä½œä¸ºä¸€ä¸ªç”Ÿäº§æ’éšœå·¥å…·ï¼Œè¿˜æœ‰å…¶ä»–æ›´å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œå€¼å¾—å»äº†è§£å­¦ä¹ </p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://blog.thend03.com/img/wechat-pay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://blog.thend03.com/img/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.thend03.com/posts/blog/%E5%88%9B%E4%B8%9A%E6%9C%AA%E5%8D%8A%E5%85%88%E4%BA%8F850/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>åˆ›ä¸šæœªåŠå…ˆäº850</span>
</a><a class=next href=https://blog.thend03.com/posts/life/2024-q3-summary/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>2024ä¸‰å­£åº¦æ€»ç»“</span></a></nav></footer></div><script>function createGiscusScript(e){const t=document.createElement("script");Object.entries(e).forEach(([e,n])=>t.setAttribute(e,n)),document.querySelector("article").appendChild(t);const n=document.querySelector('label[for="switch_default"]');n&&n.addEventListener("click",function(){const e=document.body.classList.contains("dark")?"transparent_dark":"light";t.setAttribute("data-theme",e),sendMessage({setConfig:{theme:e}})})}function sendMessage(e){const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")}document.addEventListener("DOMContentLoaded",function(){const e={src:"https://giscus.app/client.js","data-repo":"thend03/blog-comments","data-repo-id":"R_kgDOJx0ckg","data-category":"Announcements","data-category-id":"DIC_kwDOJx0cks4CmM8j","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-lang":"zh-CN","data-loading":"lazy",crossorigin:"anonymous",async:""};e["data-theme"]=document.body.classList.contains("dark")?"transparent_dark":"light",createGiscusScript(e);const t=new MutationObserver(()=>{const e=document.body.classList.contains("dark")?"transparent_dark":"light";sendMessage({setConfig:{theme:e}})});t.observe(document.body,{attributes:!0,attributeFilter:["class"]})})</script></article></main><footer class=footer><span>Copyright
&copy;
2020-2025
<a href=https://blog.thend03.com/ style=color:#939393>ç«™åœ¨æµ·è¾¹çœ‹è¿œæ–¹</a>
All Rights Reserved
</span><a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src style="float:left;margin:0 5px 0 0">
</a></span><span id=busuanzi_container><span class="fa fa-user"></span> <span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye"></span> <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString(),s=window.getSelection().toString();t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>