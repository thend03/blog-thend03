<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜ | ç«™åœ¨æµ·è¾¹çœ‹è¿œæ–¹</title>
<meta name=keywords content="java,juc,exception"><meta name=description content="å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜"><meta name=author content="since"><link rel=canonical href=https://blog.thend03.com/posts/how-to-fix-java.util.concurrentmodificationexception/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://blog.thend03.com/img/logo.jpg><link rel=icon type=image/png sizes=16x16 href=https://blog.thend03.com/img/logo.jpg><link rel=icon type=image/png sizes=32x32 href=https://blog.thend03.com/img/logo.jpg><link rel=apple-touch-icon href=https://blog.thend03.com/img/logo.jpg><link rel=mask-icon href=https://blog.thend03.com/img/logo.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://blog.thend03.com/posts/how-to-fix-java.util.concurrentmodificationexception/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜"><meta property="og:description" content="å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.thend03.com/posts/how-to-fix-java.util.concurrentmodificationexception/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-26T17:07:58+08:00"><meta property="article:modified_time" content="2024-07-26T17:07:58+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜"><meta name=twitter:description content="å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://blog.thend03.com/posts/"},{"@type":"ListItem","position":2,"name":"å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜","item":"https://blog.thend03.com/posts/how-to-fix-java.util.concurrentmodificationexception/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜","name":"å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜","description":"å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜","keywords":["java","juc","exception"],"articleBody":"é—®é¢˜ æœ€è¿‘åœ¨debugçš„æ—¶å€™ï¼Œè«åå¥‡å¦™çš„ä¼šé‡åˆ°java.util.ConcurrentModificationExceptioné—®é¢˜ã€‚\næ ¹æ®æˆ‘çš„å†å²ç»éªŒï¼Œå‘ç”Ÿè¿™ç§é—®é¢˜è‚¯å®šæ˜¯forå¾ªç¯é‡Œè°ƒäº†removeæˆ–è€…addã€‚\nä½†æ˜¯çœ‹äº†ä¸€åœˆä»£ç ï¼Œæ²¡å‘ç°æ­¤ç±»æ“ä½œï¼Œæœ‰ç‚¹è’™åœˆï¼Œè¿™æ˜¯ä¸ºå•¥ã€‚ã€‚ã€‚\næ ¹å› åˆ†æ å¹³å¸¸é‡åˆ°çš„java.util.ConcurrentModificationExceptionå¤§å¤šæ˜¯ä¸‹é¢çš„ç¬¬ä¸€ç§ï¼Œè¿­ä»£å™¨éå†å’Œé›†åˆç±»çš„add/removeæ–¹æ³•åŒæ—¶è°ƒç”¨äº†ã€‚\nåƒå¢å¼ºforå¾ªç¯åº•å±‚ä¹Ÿå±äºè¿­ä»£å™¨éå†ï¼Œæ‰€ä»¥è¿™ç§é”™è¯¯æ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚\næˆ‘è¿™æ¬¡é‡åˆ°çš„å°±çœŸçš„æ˜¯å¤šçº¿ç¨‹åœºæ™¯ä¸‹çš„å¹¶å‘ä¿®æ”¹é”™è¯¯ã€‚\nå¹¶å‘ä¿®æ”¹é”™è¯¯åŸå› åˆ†æ java.util.ArrayList.Itræ˜¯ArrayListçš„å†…éƒ¨ç±»ï¼ŒexpectedModCountæ˜¯å±äºItrçš„æˆå‘˜å˜é‡ã€‚\nmodCountæ˜¯java.util.AbstractListçš„æˆå‘˜å˜é‡ã€‚\né¦–å…ˆçœ‹ä¸€ä¸‹Itrç±»çš„å®šä¹‰\n/** * An optimized version of AbstractList.Itr */ private class Itr implements Iterator\u003cE\u003e { int cursor; // index of next element to return int lastRet = -1; // index of last element returned; -1 if no such int expectedModCount = modCount; Itr() {} public boolean hasNext() { return cursor != size; } //çœç•¥å…¶ä»–ä»£ç  } åœ¨ç”Ÿæˆè¿­ä»£å™¨Itrçš„æ—¶å€™ï¼ŒexpectedModCountç›¸å½“äºæ˜¯æ‹¿çš„å½“å‰ArrayListçš„modCountçš„å€¼ã€‚\nåç»­list.add()æˆ–è€…list.remove()åªä¼šä¿®æ”¹modCountï¼ŒexpectedModCountæ˜¯ä¸ä¼šå—list.add()æˆ–è€…list.remove()å½±å“çš„ã€‚\nå†è¿›è¡Œè¿­ä»£å™¨éå†çš„æ—¶å€™å°±ä¼šæŠ›å‡ºjava.util.ConcurrentModificationExceptionã€‚\nè¿­ä»£å™¨å’Œé›†åˆç±»æ–¹æ³•åŒæ—¶ä½¿ç”¨ javaçš„é›†åˆç±»æœ‰å¦‚ä¸‹2ä¸ªå­—æ®µ, ç¿»è¯‘è¿‡æ¥å°±æ˜¯expectedModCount!=modCountçš„æ—¶å€™ï¼Œä¼šæŠ›å‡ºå¹¶å‘å¼‚å¸¸ã€‚\næœŸæœ›æ˜¯ä¿®æ”¹çš„æ•°é‡å’ŒæœŸæœ›å€¼ç›¸åŒçš„ï¼Œä¸åŒçš„æ—¶å€™è‚¯å®šæ˜¯æœ‰é—®é¢˜äº†ã€‚\n/** * The modCount value that the iterator believes that the backing * List should have. If this expectation is violated, the iterator * has detected concurrent modification. */ int expectedModCount = modCount; åƒå¦‚ä¸‹è¿™ç§å†™æ³•ï¼Œè‚¯å®šä¼šæŠ›å‡ºjava.util.ConcurrentModificationExceptionå¼‚å¸¸çš„ã€‚\nå› ä¸ºforå¾ªç¯åº•å±‚æ˜¯ä½¿ç”¨çš„è¿­ä»£å™¨,è¿™ç§æƒ…å†µå°±ä¼šå¯¼è‡´å¹¶å‘ä¿®æ”¹é”™è¯¯ã€‚\npublic static void main(String[] args) { List\u003cString\u003e list = new ArrayList\u003c\u003e(); list.add(\"a\"); list.add(\"b\"); list.add(\"c\"); list.add(\"d\"); list.add(\"e\"); for (String a : list) { System.out.println(a); list.remove(0); } } è¿™æ®µä»£ç ç¼–è¯‘ä¸ºclassï¼Œç»“æœå¦‚ä¸‹, å¯ä»¥çœ‹åˆ°forå¾ªç¯å˜æˆäº†iteratorè¿­ä»£éå†ã€‚\néå†æ˜¯ä½¿ç”¨çš„iteratorï¼Œä½†æ˜¯removeæ–¹æ³•æ˜¯é›†åˆç±»çš„è‡ªå·±çš„æ–¹æ³•ã€‚\npublic static void main(String[] args) { List\u003cString\u003e list = new ArrayList(); list.add(\"a\"); list.add(\"b\"); list.add(\"c\"); list.add(\"d\"); list.add(\"e\"); Iterator var2 = list.iterator(); while(var2.hasNext()) { String a = (String)var2.next(); System.out.println(a); list.remove(0); } } java.util.ArrayList.Itr#nextè¿­ä»£å™¨çš„nextä¼šå…ˆæ ¡éªŒmodCount != expectedModCount, 2ä¸ªå€¼ä¸ç›¸ç­‰å°±æŠ›å‡ºå¼‚å¸¸\n@SuppressWarnings(\"unchecked\") public E next() { checkForComodification(); int i = cursor; if (i \u003e= size) throw new NoSuchElementException(); Object[] elementData = ArrayList.this.elementData; if (i \u003e= elementData.length) throw new ConcurrentModificationException(); cursor = i + 1; return (E) elementData[lastRet = i]; } final void checkForComodification() { if (modCount != expectedModCount) throw new ConcurrentModificationException(); } æ­£å¸¸ä½¿ç”¨è¿­ä»£å™¨çš„è¯modCount == expectedModCountï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸ä¼šæŠ›å¼‚å¸¸çš„ã€‚\nä½†æ˜¯list.remove(0)ï¼Œä¼šä¿®æ”¹modCountï¼Œè€Œä¸ä¿®expectedModCount,å¯¼è‡´ä¸‹ä¸€æ¬¡è¿­ä»£æŠ¥é”™\npublic E remove(int index) { rangeCheck(index); modCount++; E oldValue = elementData(index); int numMoved = size - index - 1; if (numMoved \u003e 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work return oldValue; } æ€»ç»“ä¸€ä¸‹å°±æ˜¯:\nè¿­ä»£å™¨éå†ä¸èƒ½å’Œé›†åˆç±»è‡ªèº«çš„add/removeæ–¹æ³•ä¸€èµ·è°ƒç”¨ï¼Œè¿™æ ·ä¼šå¯¼è‡´modCountå’ŒexpectedModCountä¸ç›¸ç­‰ï¼Œä»è€ŒæŠ›å‡ºjava.util.ConcurrentModificationExceptionã€‚\nadd/removeéƒ½æ˜¯é›†åˆç±»è‡ªèº«çš„æ–¹æ³•ï¼Œéƒ½åªä¿®æ”¹modCountè€Œä¸ä¿®æ”¹expectedModCount\nå¹¶å‘ä¿®æ”¹å¯¼è‡´çš„å¼‚å¸¸ ä¹‹å‰é‡åˆ°çš„éƒ½æ˜¯ä¸Šé¢ä¸€ç§å¯¼è‡´çš„å¼‚å¸¸ï¼Œè¿™æ¬¡çœŸçš„å°±é‡åˆ°å¤šçº¿ç¨‹åœºæ™¯ä¸‹çš„java.util.ConcurrentModificationExceptionäº†ã€‚\nçœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç \npublic static void main(String[] args) { List\u003cString\u003e list = new ArrayList\u003c\u003e(); list.add(\"a\"); list.add(\"b\"); list.add(\"c\"); list.add(\"d\"); list.add(\"e\"); Thread thread = new Thread(() -\u003e list.forEach(a -\u003e { System.out.println(a); })); thread.start(); Thread thread1 = new Thread(() -\u003e list.sort((o1, o2) -\u003e o2.length() - o1.length())); thread1.start(); } è¿™æ®µä»£ç ç›´æ¥æ‰§è¡Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå¯ä»¥æ­£å¸¸ç»“æŸï¼Œä½†æ˜¯ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼ŒåŠ ç‚¹å»¶è¿Ÿï¼Œå°±ä¼šæœ‰é—®é¢˜äº†\npublic static void main(String[] args) { List\u003cString\u003e list = new ArrayList\u003c\u003e(); list.add(\"a\"); list.add(\"b\"); list.add(\"c\"); list.add(\"d\"); list.add(\"e\"); Thread thread = new Thread(() -\u003e list.forEach(a -\u003e { try { Thread.sleep(50); } catch (InterruptedException e) { throw new RuntimeException(e); } System.out.println(a); })); thread.start(); Thread thread1 = new Thread(() -\u003e list.sort((o1, o2) -\u003e o2.length() - o1.length())); thread1.start(); } //è¿è¡Œå¼‚å¸¸ Exception in thread \"Thread-0\" java.util.ConcurrentModificationException at java.util.ArrayList.forEach(ArrayList.java:1262) at com.fc.se.list.ListTest.lambda$main$1(ListTest.java:23) at java.lang.Thread.run(Thread.java:750) çœ‹å¼‚å¸¸å †æ ˆæ˜¯java.util.ArrayList#forEachæ–¹æ³•, ä¼šæ ¡éªŒmodCount != expectedModCountï¼Œä¸ç¬¦åˆé¢„æœŸå°±æŠ¥é”™\n@Override public void forEach(Consumer\u003c? super E\u003e action) { Objects.requireNonNull(action); final int expectedModCount = modCount; @SuppressWarnings(\"unchecked\") final E[] elementData = (E[]) this.elementData; final int size = this.size; for (int i=0; modCount == expectedModCount \u0026\u0026 i \u003c size; i++) { action.accept(elementData[i]); } if (modCount != expectedModCount) { throw new ConcurrentModificationException(); } } ç°åœ¨è¿™ä¸ªåœºæ™¯å˜æˆäº†åœ¨2ä¸ªçº¿ç¨‹é‡Œå¯¹åŒä¸€ä¸ªlistè¿›è¡Œéå†å’Œsortæ“ä½œ.\nçœ‹ä¸‹sortæ“ä½œ\n@Override @SuppressWarnings(\"unchecked\") public void sort(Comparator\u003c? super E\u003e c) { final int expectedModCount = modCount; Arrays.sort((E[]) elementData, 0, size, c); if (modCount != expectedModCount) { throw new ConcurrentModificationException(); } modCount++; } è¿™2ä¸ªä»£ç æ”¾ä¸€èµ·æ¯”è¾ƒä¸€ä¸‹å°±å¯ä»¥çœ‹å‡ºç«¯å€ªäº†ï¼Œsort()ä¼šä¿®æ”¹modeCount, ä½†æ˜¯ä¸ä¼šä¿®æ”¹expectedModCountã€‚\nå†æ¬¡è¿›è¡Œlist.foreach()æ—¶ï¼Œç”±äºmodCount != expectedModCountï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationExceptionã€‚\nå¦‚æœä¸åŠ Thread.sleep(50);ï¼Œthreadä¼šè¿…é€Ÿæ‰§è¡Œå®Œæˆï¼Œç›¸å½“äº2ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œæ‰€ä»¥ä¸ä¼šæœ‰å¹¶å‘ä¿®æ”¹é—®é¢˜ã€‚\nåŠ äº†Thread.sleep(50);ï¼Œ2ä¸ªçº¿ç¨‹ä¼šå¹¶å‘æ‰§è¡Œï¼Œå°±ä¼šæŠ›å¼‚å¸¸äº†ã€‚\nè§£å†³æ–¹å¼ ç¬¬ä¸€ç§ï¼Œé¿å…åœ¨è¿­ä»£å™¨é‡Œæ‰§è¡Œadd/removeæ“ä½œï¼Œå¦‚æœéœ€è¦åœ¨éå†çš„è¿‡ç¨‹ä¸­ä¿®æ”¹é›†åˆï¼Œè®°å¾—ä½¿ç”¨è¿­ä»£å™¨è¿›è¡Œæ“ä½œ\nç¬¬äºŒç§ä¹Ÿå¯ä»¥å½’ç±»ä¸ºè¿­ä»£å™¨å’Œé›†åˆçš„æ“ä½œï¼Œè¿™ç§é¦–å…ˆä¹Ÿéœ€è¦é¿å…è¿­ä»£å™¨å’Œéå†ä¸€èµ·æ“ä½œ, å¦å¤–å¤šçº¿ç¨‹éœ€è¦ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼ŒæŒ‰å®é™…æƒ…å†µåŠ é”ã€‚\nFail-Fast ä¸Šé¢çš„æ —å­å°±æ˜¯fail-fastçš„ä¸€ç§åœºæ™¯ï¼Œä¸ç¬¦åˆé¢„æœŸï¼Œç›´æ¥æŠ¥é”™ã€‚\nä»€ä¹ˆæ˜¯fail-fast é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹ç»´åŸºç™¾ç§‘ä¸­å…³äºfail-fastçš„è§£é‡Šï¼š\nIn systems design, a fail-fast system is one which immediately reports at its interface any condition that is likely to indicate a failure. Fail-fast systems are usually designed to stop normal operation rather than attempt to continue a possibly flawed process. Such designs often check the systemâ€™s state at several points in an operation, so any failures can be detected early. The responsibility of a fail-fast module is detecting errors, then letting the next-highest level of the system handle them.\nå¤§æ¦‚æ„æ€æ˜¯ï¼šåœ¨ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œå¿«é€Ÿå¤±æ•ˆç³»ç»Ÿä¸€ç§å¯ä»¥ç«‹å³æŠ¥å‘Šä»»ä½•å¯èƒ½è¡¨æ˜æ•…éšœçš„æƒ…å†µçš„ç³»ç»Ÿã€‚\nå¿«é€Ÿå¤±æ•ˆç³»ç»Ÿé€šå¸¸è®¾è®¡ç”¨äºåœæ­¢æ­£å¸¸æ“ä½œï¼Œè€Œä¸æ˜¯è¯•å›¾ç»§ç»­å¯èƒ½å­˜åœ¨ç¼ºé™·çš„è¿‡ç¨‹ã€‚\nè¿™ç§è®¾è®¡é€šå¸¸ä¼šåœ¨æ“ä½œä¸­çš„å¤šä¸ªç‚¹æ£€æŸ¥ç³»ç»Ÿçš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥åŠæ—©æ£€æµ‹åˆ°ä»»ä½•æ•…éšœã€‚\nå¿«é€Ÿå¤±è´¥æ¨¡å—çš„èŒè´£æ˜¯æ£€æµ‹é”™è¯¯ï¼Œç„¶åè®©ç³»ç»Ÿçš„ä¸‹ä¸€ä¸ªæœ€é«˜çº§åˆ«å¤„ç†é”™è¯¯ã€‚\nå…¶å®ï¼Œè¿™æ˜¯ä¸€ç§ç†å¿µï¼Œè¯´ç™½äº†å°±æ˜¯åœ¨åšç³»ç»Ÿè®¾è®¡çš„æ—¶å€™å…ˆè€ƒè™‘å¼‚å¸¸æƒ…å†µï¼Œä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œç›´æ¥åœæ­¢å¹¶ä¸ŠæŠ¥ã€‚\nFail-Safe ä¸ä¹‹ç›¸å¯¹çš„è¿˜æœ‰fail-safeï¼Œè¿™æ˜¯ä¸€ç§å¹¶å‘å®‰å…¨æœºåˆ¶ã€‚\nä¸ºäº†é¿å…è§¦å‘fail-fastæœºåˆ¶ï¼Œå¯¼è‡´å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Javaä¸­æä¾›çš„ä¸€äº›é‡‡ç”¨äº†fail-safeæœºåˆ¶çš„é›†åˆç±»ã€‚\nè¿™æ ·çš„é›†åˆå®¹å™¨åœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†ã€‚\njava.util.concurrentåŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯fail-safeçš„ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ã€‚åŒæ—¶ä¹Ÿå¯ä»¥åœ¨foreachä¸­è¿›è¡Œadd/remove ã€‚\nå‚è€ƒæ–‡ç«  ä¸€ä¸å°å¿ƒå°±è¸©å‘çš„fail-fastæ˜¯ä¸ªä»€ä¹ˆé¬¼?\n","wordCount":"2853","inLanguage":"zh","datePublished":"2024-07-26T17:07:58+08:00","dateModified":"2024-07-26T17:07:58+08:00","author":{"@type":"Person","name":"since"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.thend03.com/posts/how-to-fix-java.util.concurrentmodificationexception/"},"publisher":{"@type":"Organization","name":"ç«™åœ¨æµ·è¾¹çœ‹è¿œæ–¹","logo":{"@type":"ImageObject","url":"https://blog.thend03.com/img/logo.jpg"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.thend03.com/ accesskey=h title="fayy&amp;fc (Alt + H)"><img src=https://blog.thend03.com/img/logo.jpg alt=logo aria-label=logo height=35>fayy&amp;fc</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://blog.thend03.com/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://blog.thend03.com/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://blog.thend03.com/archives/ title="â±ï¸ å½’æ¡£"><span>â±ï¸ å½’æ¡£</span></a></li><li><a href=https://blog.thend03.com/tags title="ğŸ§© æ ‡ç­¾"><span>ğŸ§© æ ‡ç­¾</span></a></li><li><a href=https://blog.thend03.com/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li><li><a href=https://blog.thend03.com/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://blog.thend03.com/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://blog.thend03.com/posts/>ğŸ“šæ–‡ç« </a></div><h1 class=post-title>å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜</h1><div class=post-description>å¦‚ä½•è§£å†³java.util.ConcurrentModificationExceptioné—®é¢˜</div><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2024-07-26
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>2853å­—
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>6åˆ†é’Ÿ
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>since
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://blog.thend03.com/tags/java/ style=color:var(--secondary)!important>Java</a>
&nbsp;<a href=https://blog.thend03.com/tags/juc/ style=color:var(--secondary)!important>Juc</a>
&nbsp;<a href=https://blog.thend03.com/tags/exception/ style=color:var(--secondary)!important>Exception</a>
</span></span></span></span><span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;
</span></span><span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://blog.thend03.com/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:"https://twikoo-e1f2-2yfafx14j-thend03s-projects.vercel.app/",region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e9%97%ae%e9%a2%98 aria-label=é—®é¢˜>é—®é¢˜</a></li><li><a href=#%e6%a0%b9%e5%9b%a0%e5%88%86%e6%9e%90 aria-label=æ ¹å› åˆ†æ>æ ¹å› åˆ†æ</a><ul><li><a href=#%e5%b9%b6%e5%8f%91%e4%bf%ae%e6%94%b9%e9%94%99%e8%af%af%e5%8e%9f%e5%9b%a0%e5%88%86%e6%9e%90 aria-label=å¹¶å‘ä¿®æ”¹é”™è¯¯åŸå› åˆ†æ>å¹¶å‘ä¿®æ”¹é”™è¯¯åŸå› åˆ†æ</a></li><li><a href=#%e8%bf%ad%e4%bb%a3%e5%99%a8%e5%92%8c%e9%9b%86%e5%90%88%e7%b1%bb%e6%96%b9%e6%b3%95%e5%90%8c%e6%97%b6%e4%bd%bf%e7%94%a8 aria-label=è¿­ä»£å™¨å’Œé›†åˆç±»æ–¹æ³•åŒæ—¶ä½¿ç”¨>è¿­ä»£å™¨å’Œé›†åˆç±»æ–¹æ³•åŒæ—¶ä½¿ç”¨</a></li><li><a href=#%e5%b9%b6%e5%8f%91%e4%bf%ae%e6%94%b9%e5%af%bc%e8%87%b4%e7%9a%84%e5%bc%82%e5%b8%b8 aria-label=å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„å¼‚å¸¸>å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„å¼‚å¸¸</a></li></ul></li><li><a href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e5%bc%8f aria-label=è§£å†³æ–¹å¼>è§£å†³æ–¹å¼</a></li><li><a href=#fail-fast aria-label=Fail-Fast>Fail-Fast</a><ul><li><a href=#%e4%bb%80%e4%b9%88%e6%98%affail-fast aria-label=ä»€ä¹ˆæ˜¯fail-fast>ä»€ä¹ˆæ˜¯fail-fast</a></li></ul></li><li><a href=#fail-safe aria-label=Fail-Safe>Fail-Safe</a></li><li><a href=#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0 aria-label=å‚è€ƒæ–‡ç« >å‚è€ƒæ–‡ç« </a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=é—®é¢˜>é—®é¢˜<a hidden class=anchor aria-hidden=true href=#é—®é¢˜>#</a></h2><p>æœ€è¿‘åœ¨debugçš„æ—¶å€™ï¼Œè«åå¥‡å¦™çš„ä¼šé‡åˆ°<code>java.util.ConcurrentModificationException</code>é—®é¢˜ã€‚</p><p>æ ¹æ®æˆ‘çš„å†å²ç»éªŒï¼Œå‘ç”Ÿè¿™ç§é—®é¢˜è‚¯å®šæ˜¯forå¾ªç¯é‡Œè°ƒäº†removeæˆ–è€…addã€‚</p><p>ä½†æ˜¯çœ‹äº†ä¸€åœˆä»£ç ï¼Œæ²¡å‘ç°æ­¤ç±»æ“ä½œï¼Œæœ‰ç‚¹è’™åœˆï¼Œè¿™æ˜¯ä¸ºå•¥ã€‚ã€‚ã€‚</p><h2 id=æ ¹å› åˆ†æ>æ ¹å› åˆ†æ<a hidden class=anchor aria-hidden=true href=#æ ¹å› åˆ†æ>#</a></h2><p>å¹³å¸¸é‡åˆ°çš„<code>java.util.ConcurrentModificationException</code>å¤§å¤šæ˜¯ä¸‹é¢çš„ç¬¬ä¸€ç§ï¼Œè¿­ä»£å™¨éå†å’Œé›†åˆç±»çš„add/removeæ–¹æ³•åŒæ—¶è°ƒç”¨äº†ã€‚</p><p>åƒå¢å¼ºforå¾ªç¯åº•å±‚ä¹Ÿå±äºè¿­ä»£å™¨éå†ï¼Œæ‰€ä»¥è¿™ç§é”™è¯¯æ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚</p><p>æˆ‘è¿™æ¬¡é‡åˆ°çš„å°±çœŸçš„æ˜¯å¤šçº¿ç¨‹åœºæ™¯ä¸‹çš„å¹¶å‘ä¿®æ”¹é”™è¯¯ã€‚</p><h3 id=å¹¶å‘ä¿®æ”¹é”™è¯¯åŸå› åˆ†æ>å¹¶å‘ä¿®æ”¹é”™è¯¯åŸå› åˆ†æ<a hidden class=anchor aria-hidden=true href=#å¹¶å‘ä¿®æ”¹é”™è¯¯åŸå› åˆ†æ>#</a></h3><p><code>java.util.ArrayList.Itr</code>æ˜¯ArrayListçš„å†…éƒ¨ç±»ï¼ŒexpectedModCountæ˜¯å±äºItrçš„æˆå‘˜å˜é‡ã€‚</p><p>modCountæ˜¯<code>java.util.AbstractList</code>çš„æˆå‘˜å˜é‡ã€‚</p><p>é¦–å…ˆçœ‹ä¸€ä¸‹Itrç±»çš„å®šä¹‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * An optimized version of AbstractList.Itr
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Itr</span> <span style=color:#66d9ef>implements</span> Iterator<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> cursor;       <span style=color:#75715e>// index of next element to return</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> lastRet <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>1; <span style=color:#75715e>// index of last element returned; -1 if no such</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> expectedModCount <span style=color:#f92672>=</span> modCount;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Itr() {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>hasNext</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> cursor <span style=color:#f92672>!=</span> size;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>       <span style=color:#75715e>//çœç•¥å…¶ä»–ä»£ç </span>
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>åœ¨ç”Ÿæˆè¿­ä»£å™¨Itrçš„æ—¶å€™ï¼ŒexpectedModCountç›¸å½“äºæ˜¯æ‹¿çš„å½“å‰ArrayListçš„modCountçš„å€¼ã€‚</p><p>åç»­list.add()æˆ–è€…list.remove()åªä¼šä¿®æ”¹modCountï¼ŒexpectedModCountæ˜¯ä¸ä¼šå—list.add()æˆ–è€…list.remove()å½±å“çš„ã€‚</p><p>å†è¿›è¡Œè¿­ä»£å™¨éå†çš„æ—¶å€™å°±ä¼šæŠ›å‡º<code>java.util.ConcurrentModificationException</code>ã€‚</p><h3 id=è¿­ä»£å™¨å’Œé›†åˆç±»æ–¹æ³•åŒæ—¶ä½¿ç”¨>è¿­ä»£å™¨å’Œé›†åˆç±»æ–¹æ³•åŒæ—¶ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#è¿­ä»£å™¨å’Œé›†åˆç±»æ–¹æ³•åŒæ—¶ä½¿ç”¨>#</a></h3><p>javaçš„é›†åˆç±»æœ‰å¦‚ä¸‹2ä¸ªå­—æ®µ, ç¿»è¯‘è¿‡æ¥å°±æ˜¯expectedModCount!=modCountçš„æ—¶å€™ï¼Œä¼šæŠ›å‡ºå¹¶å‘å¼‚å¸¸ã€‚</p><p>æœŸæœ›æ˜¯ä¿®æ”¹çš„æ•°é‡å’ŒæœŸæœ›å€¼ç›¸åŒçš„ï¼Œä¸åŒçš„æ—¶å€™è‚¯å®šæ˜¯æœ‰é—®é¢˜äº†ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>        <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * The modCount value that the iterator believes that the backing
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * List should have.  If this expectation is violated, the iterator
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * has detected concurrent modification.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> expectedModCount <span style=color:#f92672>=</span> modCount;
</span></span></code></pre></div><p>åƒå¦‚ä¸‹è¿™ç§å†™æ³•ï¼Œè‚¯å®šä¼šæŠ›å‡º<code>java.util.ConcurrentModificationException</code>å¼‚å¸¸çš„ã€‚</p><p>å› ä¸ºforå¾ªç¯åº•å±‚æ˜¯ä½¿ç”¨çš„è¿­ä»£å™¨,è¿™ç§æƒ…å†µå°±ä¼šå¯¼è‡´å¹¶å‘ä¿®æ”¹é”™è¯¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;b&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;c&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;d&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;e&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (String a : list) {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(a);
</span></span><span style=display:flex><span>            list.<span style=color:#a6e22e>remove</span>(0);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>è¿™æ®µä»£ç ç¼–è¯‘ä¸ºclassï¼Œç»“æœå¦‚ä¸‹, å¯ä»¥çœ‹åˆ°forå¾ªç¯å˜æˆäº†iteratorè¿­ä»£éå†ã€‚</p><p>éå†æ˜¯ä½¿ç”¨çš„iteratorï¼Œä½†æ˜¯removeæ–¹æ³•æ˜¯é›†åˆç±»çš„è‡ªå·±çš„æ–¹æ³•ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList();
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;b&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;c&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;d&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;e&#34;</span>);
</span></span><span style=display:flex><span>        Iterator var2 <span style=color:#f92672>=</span> list.<span style=color:#a6e22e>iterator</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span>(var2.<span style=color:#a6e22e>hasNext</span>()) {
</span></span><span style=display:flex><span>            String a <span style=color:#f92672>=</span> (String)var2.<span style=color:#a6e22e>next</span>();
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(a);
</span></span><span style=display:flex><span>            list.<span style=color:#a6e22e>remove</span>(0);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p><code>java.util.ArrayList.Itr#next</code>è¿­ä»£å™¨çš„nextä¼šå…ˆæ ¡éªŒmodCount != expectedModCount, 2ä¸ªå€¼ä¸ç›¸ç­‰å°±æŠ›å‡ºå¼‚å¸¸</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unchecked&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> E <span style=color:#a6e22e>next</span>() {
</span></span><span style=display:flex><span>  checkForComodification();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> cursor;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (i <span style=color:#f92672>&gt;=</span> size)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NoSuchElementException();
</span></span><span style=display:flex><span>  Object<span style=color:#f92672>[]</span> elementData <span style=color:#f92672>=</span> ArrayList.<span style=color:#a6e22e>this</span>.<span style=color:#a6e22e>elementData</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (i <span style=color:#f92672>&gt;=</span> elementData.<span style=color:#a6e22e>length</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ConcurrentModificationException();
</span></span><span style=display:flex><span>  cursor <span style=color:#f92672>=</span> i <span style=color:#f92672>+</span> 1;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (E) elementData<span style=color:#f92672>[</span>lastRet <span style=color:#f92672>=</span> i<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>checkForComodification</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (modCount <span style=color:#f92672>!=</span> expectedModCount)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ConcurrentModificationException();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ­£å¸¸ä½¿ç”¨è¿­ä»£å™¨çš„è¯modCount == expectedModCountï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸ä¼šæŠ›å¼‚å¸¸çš„ã€‚</p><p>ä½†æ˜¯list.remove(0)ï¼Œä¼šä¿®æ”¹modCountï¼Œè€Œä¸ä¿®expectedModCount,å¯¼è‡´ä¸‹ä¸€æ¬¡è¿­ä»£æŠ¥é”™</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> E <span style=color:#a6e22e>remove</span>(<span style=color:#66d9ef>int</span> index) {
</span></span><span style=display:flex><span>        rangeCheck(index);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        modCount<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        E oldValue <span style=color:#f92672>=</span> elementData(index);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> numMoved <span style=color:#f92672>=</span> size <span style=color:#f92672>-</span> index <span style=color:#f92672>-</span> 1;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (numMoved <span style=color:#f92672>&gt;</span> 0)
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>arraycopy</span>(elementData, index<span style=color:#f92672>+</span>1, elementData, index,
</span></span><span style=display:flex><span>                             numMoved);
</span></span><span style=display:flex><span>        elementData<span style=color:#f92672>[--</span>size<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>; <span style=color:#75715e>// clear to let GC do its work</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> oldValue;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯:</p><blockquote><p>è¿­ä»£å™¨éå†ä¸èƒ½å’Œé›†åˆç±»è‡ªèº«çš„add/removeæ–¹æ³•ä¸€èµ·è°ƒç”¨ï¼Œè¿™æ ·ä¼šå¯¼è‡´modCountå’ŒexpectedModCountä¸ç›¸ç­‰ï¼Œä»è€ŒæŠ›å‡º<code>java.util.ConcurrentModificationException</code>ã€‚</p><p>add/removeéƒ½æ˜¯é›†åˆç±»è‡ªèº«çš„æ–¹æ³•ï¼Œéƒ½åªä¿®æ”¹modCountè€Œä¸ä¿®æ”¹expectedModCount</p></blockquote><h3 id=å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„å¼‚å¸¸>å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„å¼‚å¸¸<a hidden class=anchor aria-hidden=true href=#å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„å¼‚å¸¸>#</a></h3><p>ä¹‹å‰é‡åˆ°çš„éƒ½æ˜¯ä¸Šé¢ä¸€ç§å¯¼è‡´çš„å¼‚å¸¸ï¼Œè¿™æ¬¡çœŸçš„å°±é‡åˆ°å¤šçº¿ç¨‹åœºæ™¯ä¸‹çš„<code>java.util.ConcurrentModificationException</code>äº†ã€‚</p><p>çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç </p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;b&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;c&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;d&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;e&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread thread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> list.<span style=color:#a6e22e>forEach</span>(a <span style=color:#f92672>-&gt;</span> { System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(a); }));
</span></span><span style=display:flex><span>        thread.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread thread1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> list.<span style=color:#a6e22e>sort</span>((o1, o2) <span style=color:#f92672>-&gt;</span> o2.<span style=color:#a6e22e>length</span>() <span style=color:#f92672>-</span> o1.<span style=color:#a6e22e>length</span>()));
</span></span><span style=display:flex><span>        thread1.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>è¿™æ®µä»£ç ç›´æ¥æ‰§è¡Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå¯ä»¥æ­£å¸¸ç»“æŸï¼Œä½†æ˜¯ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼ŒåŠ ç‚¹å»¶è¿Ÿï¼Œå°±ä¼šæœ‰é—®é¢˜äº†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;b&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;c&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;d&#34;</span>);
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;e&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread thread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> list.<span style=color:#a6e22e>forEach</span>(a <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                Thread.<span style=color:#a6e22e>sleep</span>(50);
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(e);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(a);
</span></span><span style=display:flex><span>        }));
</span></span><span style=display:flex><span>        thread.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread thread1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> list.<span style=color:#a6e22e>sort</span>((o1, o2) <span style=color:#f92672>-&gt;</span> o2.<span style=color:#a6e22e>length</span>() <span style=color:#f92672>-</span> o1.<span style=color:#a6e22e>length</span>()));
</span></span><span style=display:flex><span>        thread1.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//è¿è¡Œå¼‚å¸¸</span>
</span></span><span style=display:flex><span>Exception in thread <span style=color:#e6db74>&#34;Thread-0&#34;</span> java.<span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>ConcurrentModificationException</span>
</span></span><span style=display:flex><span>	at java.<span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>ArrayList</span>.<span style=color:#a6e22e>forEach</span>(ArrayList.<span style=color:#a6e22e>java</span>:1262)
</span></span><span style=display:flex><span>	at com.<span style=color:#a6e22e>fc</span>.<span style=color:#a6e22e>se</span>.<span style=color:#a6e22e>list</span>.<span style=color:#a6e22e>ListTest</span>.<span style=color:#a6e22e>lambda$main$1</span>(ListTest.<span style=color:#a6e22e>java</span>:23)
</span></span><span style=display:flex><span>	at java.<span style=color:#a6e22e>lang</span>.<span style=color:#a6e22e>Thread</span>.<span style=color:#a6e22e>run</span>(Thread.<span style=color:#a6e22e>java</span>:750)
</span></span></code></pre></div><p>çœ‹å¼‚å¸¸å †æ ˆæ˜¯<code>java.util.ArrayList#forEach</code>æ–¹æ³•, ä¼šæ ¡éªŒmodCount != expectedModCountï¼Œä¸ç¬¦åˆé¢„æœŸå°±æŠ¥é”™</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>forEach</span>(Consumer<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>super</span> E<span style=color:#f92672>&gt;</span> action) {
</span></span><span style=display:flex><span>        Objects.<span style=color:#a6e22e>requireNonNull</span>(action);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> expectedModCount <span style=color:#f92672>=</span> modCount;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unchecked&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> E<span style=color:#f92672>[]</span> elementData <span style=color:#f92672>=</span> (E<span style=color:#f92672>[]</span>) <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>elementData</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> size <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>size</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i<span style=color:#f92672>=</span>0; modCount <span style=color:#f92672>==</span> expectedModCount <span style=color:#f92672>&amp;&amp;</span> i <span style=color:#f92672>&lt;</span> size; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            action.<span style=color:#a6e22e>accept</span>(elementData<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (modCount <span style=color:#f92672>!=</span> expectedModCount) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ConcurrentModificationException();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>ç°åœ¨è¿™ä¸ªåœºæ™¯å˜æˆäº†åœ¨2ä¸ªçº¿ç¨‹é‡Œå¯¹åŒä¸€ä¸ªlistè¿›è¡Œéå†å’Œsortæ“ä½œ.</p><p>çœ‹ä¸‹sortæ“ä½œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unchecked&#34;</span>)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>sort</span>(Comparator<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>super</span> E<span style=color:#f92672>&gt;</span> c) {
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> expectedModCount <span style=color:#f92672>=</span> modCount;
</span></span><span style=display:flex><span>     Arrays.<span style=color:#a6e22e>sort</span>((E<span style=color:#f92672>[]</span>) elementData, 0, size, c);
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>if</span> (modCount <span style=color:#f92672>!=</span> expectedModCount) {
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ConcurrentModificationException();
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>     modCount<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span> }
</span></span></code></pre></div><p>è¿™2ä¸ªä»£ç æ”¾ä¸€èµ·æ¯”è¾ƒä¸€ä¸‹å°±å¯ä»¥çœ‹å‡ºç«¯å€ªäº†ï¼Œsort()ä¼šä¿®æ”¹modeCount, ä½†æ˜¯ä¸ä¼šä¿®æ”¹expectedModCountã€‚</p><p>å†æ¬¡è¿›è¡Œlist.foreach()æ—¶ï¼Œç”±äº<code>modCount != expectedModCount</code>ï¼Œå°±ä¼šæŠ›å‡º<code>ConcurrentModificationException</code>ã€‚</p><p>å¦‚æœä¸åŠ <code>Thread.sleep(50);</code>ï¼Œthreadä¼šè¿…é€Ÿæ‰§è¡Œå®Œæˆï¼Œç›¸å½“äº2ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œæ‰€ä»¥ä¸ä¼šæœ‰å¹¶å‘ä¿®æ”¹é—®é¢˜ã€‚</p><p>åŠ äº†<code>Thread.sleep(50);</code>ï¼Œ2ä¸ªçº¿ç¨‹ä¼šå¹¶å‘æ‰§è¡Œï¼Œå°±ä¼šæŠ›å¼‚å¸¸äº†ã€‚</p><h2 id=è§£å†³æ–¹å¼>è§£å†³æ–¹å¼<a hidden class=anchor aria-hidden=true href=#è§£å†³æ–¹å¼>#</a></h2><p>ç¬¬ä¸€ç§ï¼Œé¿å…åœ¨è¿­ä»£å™¨é‡Œæ‰§è¡Œadd/removeæ“ä½œï¼Œå¦‚æœéœ€è¦åœ¨éå†çš„è¿‡ç¨‹ä¸­ä¿®æ”¹é›†åˆï¼Œè®°å¾—ä½¿ç”¨è¿­ä»£å™¨è¿›è¡Œæ“ä½œ</p><p>ç¬¬äºŒç§ä¹Ÿå¯ä»¥å½’ç±»ä¸ºè¿­ä»£å™¨å’Œé›†åˆçš„æ“ä½œï¼Œè¿™ç§é¦–å…ˆä¹Ÿéœ€è¦é¿å…è¿­ä»£å™¨å’Œéå†ä¸€èµ·æ“ä½œ, å¦å¤–å¤šçº¿ç¨‹éœ€è¦ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼ŒæŒ‰å®é™…æƒ…å†µåŠ é”ã€‚</p><h2 id=fail-fast>Fail-Fast<a hidden class=anchor aria-hidden=true href=#fail-fast>#</a></h2><p>ä¸Šé¢çš„æ —å­å°±æ˜¯fail-fastçš„ä¸€ç§åœºæ™¯ï¼Œä¸ç¬¦åˆé¢„æœŸï¼Œç›´æ¥æŠ¥é”™ã€‚</p><h3 id=ä»€ä¹ˆæ˜¯fail-fast>ä»€ä¹ˆæ˜¯fail-fast<a hidden class=anchor aria-hidden=true href=#ä»€ä¹ˆæ˜¯fail-fast>#</a></h3><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹ç»´åŸºç™¾ç§‘ä¸­å…³äºfail-fastçš„è§£é‡Šï¼š</p><blockquote><p>In systems design, a fail-fast system is one which immediately reports at its interface any condition that is likely to indicate a failure. Fail-fast systems are usually designed to stop normal operation rather than attempt to continue a possibly flawed process. Such designs often check the system&rsquo;s state at several points in an operation, so any failures can be detected early. The responsibility of a fail-fast module is detecting errors, then letting the next-highest level of the system handle them.</p></blockquote><p>å¤§æ¦‚æ„æ€æ˜¯ï¼šåœ¨ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œå¿«é€Ÿå¤±æ•ˆç³»ç»Ÿä¸€ç§å¯ä»¥ç«‹å³æŠ¥å‘Šä»»ä½•å¯èƒ½è¡¨æ˜æ•…éšœçš„æƒ…å†µçš„ç³»ç»Ÿã€‚</p><p>å¿«é€Ÿå¤±æ•ˆç³»ç»Ÿé€šå¸¸è®¾è®¡ç”¨äºåœæ­¢æ­£å¸¸æ“ä½œï¼Œè€Œä¸æ˜¯è¯•å›¾ç»§ç»­å¯èƒ½å­˜åœ¨ç¼ºé™·çš„è¿‡ç¨‹ã€‚</p><p>è¿™ç§è®¾è®¡é€šå¸¸ä¼šåœ¨æ“ä½œä¸­çš„å¤šä¸ªç‚¹æ£€æŸ¥ç³»ç»Ÿçš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥åŠæ—©æ£€æµ‹åˆ°ä»»ä½•æ•…éšœã€‚</p><p>å¿«é€Ÿå¤±è´¥æ¨¡å—çš„èŒè´£æ˜¯æ£€æµ‹é”™è¯¯ï¼Œç„¶åè®©ç³»ç»Ÿçš„ä¸‹ä¸€ä¸ªæœ€é«˜çº§åˆ«å¤„ç†é”™è¯¯ã€‚</p><p>å…¶å®ï¼Œè¿™æ˜¯ä¸€ç§ç†å¿µï¼Œè¯´ç™½äº†å°±æ˜¯åœ¨åšç³»ç»Ÿè®¾è®¡çš„æ—¶å€™å…ˆè€ƒè™‘å¼‚å¸¸æƒ…å†µï¼Œä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œç›´æ¥åœæ­¢å¹¶ä¸ŠæŠ¥ã€‚</p><h2 id=fail-safe>Fail-Safe<a hidden class=anchor aria-hidden=true href=#fail-safe>#</a></h2><p>ä¸ä¹‹ç›¸å¯¹çš„è¿˜æœ‰fail-safeï¼Œè¿™æ˜¯ä¸€ç§å¹¶å‘å®‰å…¨æœºåˆ¶ã€‚</p><p>ä¸ºäº†é¿å…è§¦å‘fail-fastæœºåˆ¶ï¼Œå¯¼è‡´å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Javaä¸­æä¾›çš„ä¸€äº›é‡‡ç”¨äº†fail-safeæœºåˆ¶çš„é›†åˆç±»ã€‚</p><p>è¿™æ ·çš„é›†åˆå®¹å™¨åœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†ã€‚</p><p>java.util.concurrentåŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯fail-safeçš„ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ã€‚åŒæ—¶ä¹Ÿå¯ä»¥åœ¨foreachä¸­è¿›è¡Œadd/remove ã€‚</p><h2 id=å‚è€ƒæ–‡ç« >å‚è€ƒæ–‡ç« <a hidden class=anchor aria-hidden=true href=#å‚è€ƒæ–‡ç« >#</a></h2><p><a href=https://www.hollischuang.com/archives/3542>ä¸€ä¸å°å¿ƒå°±è¸©å‘çš„fail-fastæ˜¯ä¸ªä»€ä¹ˆé¬¼?</a></p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://blog.thend03.com/img/wechat-pay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://blog.thend03.com/img/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.thend03.com/posts/automatic-for-xiaobot-nav/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>å®ç°å°æŠ¥ç«¥åˆ†é”€ç«™çš„è‡ªåŠ¨åŒ–</span>
</a><a class=next href=https://blog.thend03.com/posts/how-to-make-a-xiaobot-nav/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>å¦‚ä½•åšä¸€ä¸ªå°æŠ¥ç«¥åˆ†é”€å¯¼èˆª</span></a></nav></footer></div><style>.comments_details summary::marker{font-size:20px;content:'ğŸ‘‰å±•å¼€è¯„è®º';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'ğŸ‘‡å…³é—­è¯„è®º';color:var(--content)}</style><div><details class=comments_details open><summary style="cursor:pointer;margin:50px 0 20px;width:130px"><span style=font-size:20px;color:var(--content)>...</span></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>twikoo.init({envId:"https://twikoo-e1f2-2yfafx14j-thend03s-projects.vercel.app/",el:"#tcomment",lang:"zh-CN",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><span>Copyright
&copy;
2020-2025
<a href=https://blog.thend03.com/ style=color:#939393>ç«™åœ¨æµ·è¾¹çœ‹è¿œæ–¹</a>
All Rights Reserved
</span><a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src style="float:left;margin:0 5px 0 0">
</a></span><span id=busuanzi_container><span class="fa fa-user"></span> <span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye"></span> <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString(),s=window.getSelection().toString();t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>