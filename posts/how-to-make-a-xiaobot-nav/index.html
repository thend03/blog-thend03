<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>如何做一个小报童分销导航 | Fayy&amp;Fc's Blog</title>
<meta name=keywords content="xiaobot,spider,nav"><meta name=description content="从0到1做1个小报童分销导航"><meta name=author content="since"><link rel=canonical href=https://blog.thend03.com/posts/how-to-make-a-xiaobot-nav/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://blog.thend03.com/img/logo.jpg><link rel=icon type=image/png sizes=16x16 href=https://blog.thend03.com/img/logo.jpg><link rel=icon type=image/png sizes=32x32 href=https://blog.thend03.com/img/logo.jpg><link rel=apple-touch-icon href=https://blog.thend03.com/img/logo.jpg><link rel=mask-icon href=https://blog.thend03.com/img/logo.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://blog.thend03.com/posts/how-to-make-a-xiaobot-nav/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="如何做一个小报童分销导航"><meta property="og:description" content="从0到1做1个小报童分销导航"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.thend03.com/posts/how-to-make-a-xiaobot-nav/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-21T13:08:59+08:00"><meta property="article:modified_time" content="2024-07-21T13:08:59+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="如何做一个小报童分销导航"><meta name=twitter:description content="从0到1做1个小报童分销导航"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"📚文章","item":"https://blog.thend03.com/posts/"},{"@type":"ListItem","position":2,"name":"如何做一个小报童分销导航","item":"https://blog.thend03.com/posts/how-to-make-a-xiaobot-nav/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"如何做一个小报童分销导航","name":"如何做一个小报童分销导航","description":"从0到1做1个小报童分销导航","keywords":["xiaobot","spider","nav"],"articleBody":"小报童精选导航站成果展示: https://re.gloaming.top/\n0x0 导航站的详细实操，讲了专栏来源的选择，如何整理获取专栏列表详情，前端样式怎么做，如何部署并生成最终的导航站等。\n由于前端能力实在有限，所以本篇文章的重点是在如何获取精选的专栏列表上。\n导航站使用一个开源项目改造而来。\n小报童简介 小报童是个去中心化的课程平台。\n创作者可以在小报童体面而用心的创作，专注创作，不搞套路。\n而且专栏的价格大部分都比较便宜。\n小报童官方不做社群，不做广告变现，不做算法推荐。\n因为小报童是去中心化的，所以官网没有所有的专栏列表，只能通过专栏作者自发性的传播，或者小报童官方的推荐才能找到专栏地址。\n所以有人就做了小报童的导航站，用来推荐专栏。\n而且小报童这个不需要买专栏，就可以获得分销链接。所以理论上小报童的所有专栏都可以免费获得分销链接。\n另外大声的吐槽一下，这样的专栏都是谁在买。\n别人通过你的链接买了之后，你就可以获得分销收入。\n但是吧，分销站这个东西，可能确实得有点私域流量才行，在pyq发分销的二维码，或者公众号发文章，或者自己的社群里发一下进行推荐。\n单纯靠seo的话，目前排名比较靠前的seo做的都挺好的，新站感觉得做持久化运营搜索引擎排名才能上的去。\n单搜小报童，官网占了整整一屏，下面的就是一些分销站了。\n回到分销站，该如何从01到1做一个分销站出来。\n我努力搜索，都没有搜索出一个可用的分销导航模板出来，有点点难。\n数据源 做导航站首先要拿到数据，由于小报童的特殊性(去中心化)，所以没法从官网得到所有专栏的数据。\n那么可以选择从以下的几种渠道拿到数据\n小报童精选公众号，里面会有一些精选专栏的推荐。 pyq各种散落的专栏推荐 别人整理好的专栏列表 爬当前已有的小报童导航站的数据 小报童精选 小报童精选是小报童官方的公众号。\n虽然是去中心化，但是一点入口都看不到，专栏的推广确实是会受阻。\n所以有了小报童精选这个事。\n精选文章每期会推荐一些有价值的专栏。所以精选是个获取专栏列表的路子。但是精选只能拿到一部分的专栏。\npyq pyq加的一些人，会去推荐专栏，他们买了之后，会发他们自己的专属分销海报。\n有时候我也会去通过他们的链接买一点，但是这种就是随缘，数量也不会太多。\n别人整理好的专栏列表 我在网上冲浪的时候，发现了别人有一份整理好的专栏列表，但是这个可能会有时效性的问题，作者更新不及时，就拿不到增量的专栏列表。\n下面这个就是一个民间的版本，上次更新还是在2年前。\nhttps://github.com/qianguyihao/xiaobot-list?tab=readme-ov-file\n爬当前已有的导航站的数据 这条路我感觉是最好的，多选几个导航站，把他们的专栏列表都爬一遍，然后去个重，就得到了最新最全的专栏列表了。\n数据源的选择 上面介绍了几种数据来源，我这边选择的是爬小报童精选的推荐列表。其实更好的是去爬已有导航站的数据。\n不过就精选专栏而言，官方的其实更好，毕竟官方已经做过一轮筛选了，能上推荐的肯定有其优点。\n数据整理分类 选择好之后，我们就需要对推荐列表进行分类，订阅号里有目前所有的专栏推荐列表。截止到现在一共有26期。\n那么对推荐列表进行整理就有2种方法。\n人工整理 爬虫分类 26期的话，点开26条公众号文章，收集下所有的推荐专栏的二维码，倒也还好。\n但是作为一个资深crud boy，能写代码就写代码。不能写代码，就让chatgpt帮我们写代码。\n语言选择的是Java(资深java crud仔)。\n选择的框架有如下几个\nJsoup, 用于解析html Fastjson2，用于字符串转json处理 Hutool，http\u0026二维码识别 selenium, 用于浏览器模拟，一些异步加载的页面需要用到这个 commons-io，文件操作 下面就是实操了\n如何拿到专栏推荐列表 首先是进入小报童精选 公众号的聊天页面，左下角有个往期回顾，这里就是推荐专栏的合集页面。\n然后点击右上角，选择复制链接，或者选择使用默认浏览器打开，就可以拿到订阅列表的url\n下面就是页面分析了，通过滑动页面猜测这个列表是分页加载的。\n可以在控制台看网络请求，也可以看的出来。\nuri中有一个关键的key，appmsgalbum， 这个看着像是列表的请求。经过测验，这个确实是分页参数。\n浏览器地址栏的链接访问只能访问到第一页的页面。下面就要靠分页查询拿数据了。\n下面的分页请求返回的是json数据，第一页是html数据。\n分页参数有2个比较关键的key，begin_msgid和begin_itemidx，这个一个是分页参数，一个是消息id，传入页数和id，查询下面的消息\n这样的话就可以拿到所有的推荐文章的详细链接了。每一篇文章有一个专题推荐，包含数个专栏的推荐\n经过页面元素审查以及debug，得到了如下获取订阅列表每篇文章地址的方法\n常量类如下\npublic class Constants { public static final String XIAOBOT_WECHAT_SUBSCRIBE_LIST_URL = \"https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum\u0026__biz=Mzg4MTc0MDcyOA==\u0026scene=1\u0026album_id=2262723582487429130\u0026count=100\u0026uin=\u0026key=\u0026devicetype=iMac+MacBookPro18%2C1+OSX+OSX+14.5+build(23F79)\u0026version=13080811\u0026lang=zh_CN\u0026nettype=WIFI\u0026ascene=0\u0026fontScale=100\"; public static final String LOCAL_CHROME_DRIVER_PATH = \"/Users/since/Downloads/chromedriver-mac-arm64/chromedriver\"; public static final String LIST_NEXT_URL_FORMAT = \"https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum\u0026__biz=Mzg4MTc0MDcyOA==\u0026album_id=2262723582487429130\u0026count=100\u0026begin_msgid=%s\u0026begin_itemidx=%s\u0026uin=\u0026key=\u0026pass_ticket=\u0026wxtoken=\u0026devicetype=iMac\u0026nbsp;MacBookPro18,1\u0026nbsp;OSX\u0026nbsp;OSX\u0026nbsp;14.5\u0026nbsp;build(23F79)\u0026clientversion=13080811\u0026__biz=Mzg4MTc0MDcyOA==\u0026appmsg_token=\u0026x5=0\u0026f=json\"; } 获取订阅列表方法\nimport cn.hutool.http.HttpUtil; import com.alibaba.fastjson2.JSON; import com.alibaba.fastjson2.JSONArray; import com.alibaba.fastjson2.JSONObject; import com.thend03.xiaobot.spider.constants.Constants; import com.thend03.xiaobot.spider.model.ArticleDetail; import com.thend03.xiaobot.spider.model.WechatModel; import org.apache.commons.collections4.CollectionUtils; import org.apache.commons.lang3.StringUtils; import org.jsoup.Jsoup; import org.jsoup.nodes.Attributes; import org.jsoup.nodes.Document; import org.jsoup.nodes.Element; import org.jsoup.select.Elements; import java.net.MalformedURLException; import java.nio.charset.StandardCharsets; import java.util.ArrayList; import java.util.List; import java.util.Objects; import java.util.stream.Collectors; /** * 小报童专栏精选订阅号列表解析服务 * * @author since * @date 2024-07-17 08:12 */ public class WechatSubscribeListService { public static List\u003cArticleDetail\u003e parseArticleList() { String content = HttpUtil.downloadString(Constants.XIAOBOT_WECHAT_SUBSCRIBE_LIST_URL, StandardCharsets.UTF_8); Document parse = Jsoup.parse(content); Elements albumListItem = parse.getElementsByClass(\"album__list-item\"); System.out.println(1); List\u003cWechatModel\u003e list = new ArrayList\u003c\u003e(); boolean hasNext = true; for (Element element : albumListItem) { Attributes attributes = element.attributes(); System.out.println(2); if (attributes.isEmpty()) { continue; } String s = attributes.get(\"data-msgid\"); String s1 = attributes.get(\"data-itemidx\"); String s2 = attributes.get(\"data-link\"); String s3 = attributes.get(\"data-title\"); String s4 = attributes.get(\"data-pos_num\"); WechatModel wechatModel = new WechatModel(); wechatModel.setDataMsgId(parseLong(s)); wechatModel.setDataItemIndex(parseInt(s1)); wechatModel.setDataLink(s2); wechatModel.setDataTitle(s3); wechatModel.setDataPosNum(parseInt(s4)); list.add(wechatModel); if (wechatModel.getDataPosNum() == 1) { hasNext = false; } } while (hasNext) { List\u003cWechatModel\u003e list1 = nextParse(list.get(list.size() - 1)); if (CollectionUtils.isNotEmpty(list1)) { list.addAll(list1); } if (list1.get(list1.size() - 1).getDataPosNum() == 1) { hasNext = false; } } List\u003cString\u003e urlList = new ArrayList\u003c\u003e(); list.stream().filter(Objects::nonNull).forEach(s -\u003e { List\u003cString\u003e urlList1 = WechatDetailService.getUrlList(s.getDataLink()); if (CollectionUtils.isNotEmpty(urlList1)) { urlList.addAll(urlList1); } }); List\u003cString\u003e collect = urlList.stream().filter(StringUtils::isNotBlank).filter(s -\u003e s.contains(\"http\") \u0026\u0026 s.contains(\"xiaobot.net/p\")).map(s -\u003e { String[] split = s.split(\"\\\\?\"); return split[0]; }).distinct().collect(Collectors.toList()); List\u003cArticleDetail\u003e collect1 = collect.stream().filter(Objects::nonNull).map(url -\u003e { String host = null; String uniqueId = null; try { host = WechatDetailService.getHost(url); } catch (MalformedURLException e) { } try { uniqueId = WechatDetailService.getArticleUniqueId(url); } catch (MalformedURLException e) { throw new RuntimeException(e); } return WechatDetailService.getArticleDetail(host, uniqueId); }).collect(Collectors.toList()); return collect1; } public static long parseLong(String dataMsgId) { try { return Long.parseLong(dataMsgId); } catch (Exception e) { e.printStackTrace(); } return -1; } public static int parseInt(String itemIndex) { try { return Integer.parseInt(itemIndex); } catch (Exception e) { e.printStackTrace(); } return -1; } public static List\u003cWechatModel\u003e nextParse(WechatModel wechatModel) { List\u003cWechatModel\u003e list = new ArrayList\u003c\u003e(); String format = String.format(Constants.LIST_NEXT_URL_FORMAT, wechatModel.getDataMsgId(), wechatModel.getDataItemIndex()); String content = HttpUtil.downloadString(format, StandardCharsets.UTF_8); JSONObject jsonObject = JSON.parseObject(content); JSONObject getalbumResp = jsonObject.getJSONObject(\"getalbum_resp\"); JSONArray articleList = getalbumResp.getJSONArray(\"article_list\"); for (int i = 0; i \u003c articleList.size(); i++) { Object o = articleList.get(i); if (o instanceof JSONObject) { JSONObject json = (JSONObject) o; long msgid = json.getLongValue(\"msgid\"); int itemidx = json.getIntValue(\"itemidx\"); int posNum = json.getIntValue(\"pos_num\"); String title = json.getString(\"title\"); String link = json.getString(\"url\"); WechatModel nextWechatModel = new WechatModel(); nextWechatModel.setDataMsgId(msgid); nextWechatModel.setDataItemIndex(itemidx); nextWechatModel.setDataLink(link); nextWechatModel.setDataTitle(title); nextWechatModel.setDataPosNum(posNum); list.add(nextWechatModel); } } return list; } } 如何拿到专栏地址 在上一步 我们拿到了26篇精选推荐的文章地址列表，这一步我们需要解析每一篇文章详情，拿到这一批推荐的专栏合集。\n每一篇文章里都会推荐1~N篇文章，数量不等。\n我拿几篇文章分析了一下，每篇文章的专栏没有特定的标签，但是由于是公众号文章，所以专栏都是以图片二维码的形式提供的。\n即能拿到所有的专栏二维码图片即可。\n以序号26的这篇文章为例\n推荐的专栏以文字介绍+二维码的图片格式提供出来。\n这篇文章一共推荐了4个专栏，理论上我们拿到这4个专栏的图片二维码就可以了。\n那么打开浏览器的控制台，进行元素审查，在img标签里的data-src字段可以拿到图片地址\n现在的获取图片地址的方法过于生硬了，需要从script里解析变量重重硬解析才能拿到图片地址\nList\u003cString\u003e result = new ArrayList\u003c\u003e(); String content = HttpUtil.downloadString(wechatUrl, StandardCharsets.UTF_8); Document parse = Jsoup.parse(content); Elements scripts = parse.getElementsByTag(\"script\"); for (Element script : scripts) { List\u003cNode\u003e nodes = script.childNodes(); for (Node node : nodes) { if (node instanceof DataNode) { DataNode dataNode = (DataNode) node; String wholeData = dataNode.getWholeData(); if (wholeData.contains(\"cdn_url\")) { String[] split = wholeData.split(\"var\"); for (int i = 0; i \u003c split.length; i++) { String s = split[i]; if (s.contains(\"picturePageInfoList\") \u0026\u0026 s.contains(\"http\")) { String[] split1 = s.split(\"picturePageInfoList\"); String cdnUrl = split1[1]; String s1 = cdnUrl.replaceAll(\"\\\\[\", \"\") .replaceAll(\"]\", \"\") .replaceAll(\"\\\\{\", \"\") .replaceAll(\"}\", \"\") .replaceAll(\"'\", \"\") .replaceAll(\"\\\"\", \"\"); String[] split2 = s1.split(\",\"); for (int j = 0; j \u003c split2.length; j++) { if (split2[j].contains(\"cdn_url\")) { String[] split3 = split2[j].split(\"cdn_url:\"); result.add(split3[1]); } } } } } } } } 其实换个方法，一句话就可以提取所有图片地址了, 使用select方法，标签+属性即可。\n那么拿到图片地址之后，使用hutool进行二维码识别，报错了就忽略异常，有二维码的能成功解析，那么正常解析的就是二维码地址了。\npublic static String hutoolOcr(String imageUrl) throws IOException, URISyntaxException { String finalUrl = \"\"; File file = HttpUtil.downloadFileFromUrl(imageUrl, \"static/\" + COUNT.getAndIncrement() + \".png\"); try { finalUrl = QrCodeUtil.decode(file); } catch (Exception e) { e.printStackTrace(); } return finalUrl; } 这样就拿到每期精选的所有的推荐专栏列表了\n如何获取专栏的详情 那么拿到专栏地址之后，就是去处理专栏了，我们上一步拿到的只是专栏的地址，专栏标题、作者、专栏头像、专栏介绍、专栏的已购数、文章数，都需要从专栏里获取。\n打开控制台，这几个接口把所有的数据都返回了，且返回的是json数据，所以看着很美好。\n但是这几个接口都是要签名的，整个页面是异步加载的，无法使用jsoup进行解析。而且也不知道签名规则，所以这条路行不通。\n后来经过一番搜索，可以使用selenium模拟浏览器，等待页面异步加载完成，这样就可以使用jsoup解析页面了。\n使用selenium需要在下载chrome驱动到本地，chrome驱动需要和自己的chrome浏览器版本相等或相近，版本不要差太多。\n114之前的版本在https://chromedriver.storage.googleapis.com/index.html下载\n127之后的版本在https://googlechromelabs.github.io/chrome-for-testing/下载\n115-126的暂时没找到，随着时间推移，这个最新的版本也可能会发生变化\n记得是下载chromedriver\n拿到driver之后，就可以使用代码模拟浏览器的页面异步加载过程，得到完整的页面了，然后就可以使用jsoup解析页面元素\npublic static String getArticleFullPage(String url) { // 设置 ChromeDriver 路径 System.setProperty(\"webdriver.chrome.driver\", Constants.LOCAL_CHROME_DRIVER_PATH); // 设置 Chrome 选项 ChromeOptions options = new ChromeOptions(); options.addArguments(\"--headless\"); // 无头模式 // 启动 Chrome 浏览器 WebDriver driver = new ChromeDriver(options); // 访问目标网页 driver.get(url); String pageContent = null; // 等待网页加载完成（根据需要调整等待时间） try { Thread.sleep(2000); // 获取网页内容 pageContent = driver.getPageSource(); // 打印网页内容 System.out.println(pageContent); } catch (InterruptedException e) { e.printStackTrace(); } finally { driver.quit(); } return pageContent; } 整体解析文章详情的方法如下\npublic static ArticleDetail getArticleDetail(String host, String uniqueId) { String url = \"https://\" + host + \"/p/\" + uniqueId; String articleFullPage = getArticleFullPage(url); Document document = Jsoup.parse(articleFullPage); Elements title = document.getElementsByTag(\"title\"); Elements intro = document.getElementsByClass(\"intro\"); Elements description = document.getElementsByClass(\"description\"); Elements posts = document.getElementsByClass(\"posts\"); Elements elementsByClass = document.getElementsByClass(\"paper\"); Elements num = document.getElementsByClass(\"num\"); Elements avatar = document.getElementsByClass(\"avatar\"); String articleTitle = getArticleTitle(title); String articleDescription = getArticleDescription(description); String articleIntro = getArticleIntro(intro); Map\u003cString, Integer\u003e articleNum = getArticleNum(num); String articleAvatar = getArticleAvatar(avatar); ArticleDetail articleDetail = new ArticleDetail(); articleDetail.setAvatarBase64(articleAvatar); // articleDetail.setGmtCreate(createdAt); articleDetail.setIntroduction(articleIntro); // articleDetail.setFreePostCount(freePostCount); articleDetail.setPostCount(articleNum.get(\"post\")); articleDetail.setTitle(articleTitle); articleDetail.setSubscriberCount(articleNum.get(\"reader\")); articleDetail.setUrl(url); System.out.println(1); return articleDetail; } public static String getHost(String articleUrl) throws MalformedURLException { java.net.URL url = new URL(articleUrl); return url.getHost(); } public static String getArticleUniqueId(String articleUrl) throws MalformedURLException { java.net.URL url = new URL(articleUrl); String path = url.getPath(); return path.replaceAll(\"/p/\", \"\"); } public static String getArticleFullPage(String url) { // 设置 ChromeDriver 路径 System.setProperty(\"webdriver.chrome.driver\", Constants.LOCAL_CHROME_DRIVER_PATH); // 设置 Chrome 选项 ChromeOptions options = new ChromeOptions(); options.addArguments(\"--headless\"); // 无头模式 // 启动 Chrome 浏览器 WebDriver driver = new ChromeDriver(options); // 访问目标网页 driver.get(url); String pageContent = null; // 等待网页加载完成（根据需要调整等待时间） try { Thread.sleep(2000); // 获取网页内容 pageContent = driver.getPageSource(); // 打印网页内容 System.out.println(pageContent); } catch (InterruptedException e) { e.printStackTrace(); } finally { driver.quit(); } return pageContent; } /** * 专栏的标题 * @param title title element * @return title */ public static String getArticleTitle(Elements title) { if (Objects.isNull(title)) { return null; } if (title.isEmpty()) { return null; } List\u003cString\u003e result = new ArrayList\u003c\u003e(); for (Element element : title) { List\u003cNode\u003e nodes = element.childNodes(); if (CollectionUtils.isEmpty(nodes)) { continue; } List\u003cString\u003e collect = nodes.stream().filter(Objects::nonNull).map(node -\u003e { if (node instanceof TextNode) { return ((TextNode) node).text(); } return null; }).collect(Collectors.toList()); result.addAll(collect); } return StringUtils.join(result, \",\"); } public static String getArticleDescription(Elements description) { if (Objects.isNull(description)) { return null; } if (description.isEmpty()) { return null; } List\u003cString\u003e result = new ArrayList\u003c\u003e(); Iterator\u003cElement\u003e iterator = description.iterator(); while (iterator.hasNext()) { Element next = iterator.next(); List\u003cString\u003e list = parseNode(next); result.add(StringUtils.join(list, \"\")); } String join = StringUtils.join(result, \"\"); return join.replaceAll(\"\n\", \"\\r\\n\\n\"); } public static String getArticleIntro(Elements intro) { if (Objects.isNull(intro)) { return null; } if (intro.isEmpty()) { return null; } List\u003cString\u003e result = new ArrayList\u003c\u003e(); for (Element next : intro) { List\u003cString\u003e list = parseNode(next); result.add(StringUtils.join(list, \"\")); } String join = StringUtils.join(result, \"\"); return join.replaceAll(\"\n\", \"\\r\\n\"); } public static Map\u003cString, Integer\u003e getArticleNum(Elements num) { if (Objects.isNull(num)) { return Collections.emptyMap(); } if (num.isEmpty()) { return Collections.emptyMap(); } Element reader = num.get(0); Element post = num.get(1); TextNode node = (TextNode) reader.childNodes().get(0); String text = node.text(); TextNode postNode = (TextNode) post.childNodes().get(0); String text1 = postNode.text(); Map\u003cString, Integer\u003e map = new HashMap\u003c\u003e(4); map.put(\"reader\", Integer.parseInt(text)); map.put(\"post\", Integer.parseInt(text1)); return map; } public static String getArticleAvatar(Elements avatar) { if (Objects.isNull(avatar)) { return null; } if (avatar.isEmpty()) { return null; } Element element = avatar.get(0); String avatarUrl = element.attributes().get(\"src\"); byte[] bytes = HttpUtil.downloadBytes(avatarUrl); return \"data:image/jpeg;base64,\" + Base64.getEncoder().encodeToString(bytes); } /** * 解析node详情，需要递归，text node/element * @param element element * @return list */ public static List\u003cString\u003e parseNode(Element element) { if (Objects.isNull(element)) { return null; } List\u003cNode\u003e nodes = element.childNodes(); if (CollectionUtils.isEmpty(nodes)) { return null; } List\u003cString\u003e result = new ArrayList\u003c\u003e(); for (Node node : nodes) { List\u003cNode\u003e textNodeList = node.childNodes(); if (CollectionUtils.isEmpty(textNodeList)) { if (node instanceof TextNode) { result.add(((TextNode) node).text()); } else { result.add(node.toString()); } continue; } List\u003cString\u003e subList = new ArrayList\u003c\u003e(); for (Node text : textNodeList) { if (Objects.isNull(text)) { continue; } if (text instanceof TextNode) { subList.add(((TextNode) text).text()); } else if (text instanceof Element) { List\u003cString\u003e list = parseNode((Element) text); if (CollectionUtils.isNotEmpty(list)) { subList.add(StringUtils.join(list, \"\")); } } else { subList.add(text.toString()); } } result.add(StringUtils.join(subList, \"\")); } return result; } 前端页面展示 由于我是前端废，找了个开源的导航项目当模板，找我的前端朋友改了一下。\n开源项目地址如下: https://github.com/jic999/moon-web-start\n经过修改的前端项目地址如下: https://github.com/gloaming123/moon-web-start\n后端代码项目地址如下: https://github.com/thend03/xiaobot-spider\n这个导航项目自动github pages部署，可以直接在仓库的actions点击运行，可以在job的运行日志里得到页面访问地址。\n为了优化加载速度，我这边生成的详情，将专栏的头像转成了base64，前端再将base64转成本地图片，优化了加载速度。\n总结 那么经过一系列的勾兑，就拿到了专栏的详情。\n总得来说，后端就是使用了http+jsoup解析了页面，没有什么难的。对api熟悉的话速度会更快一点。\n没有涉及大规模的爬虫，算是一次简单的尝试吧。\n对我来说难的果然还是前端呀，需要我的前端合伙人持续发力，实现前端页面了。\n前端地址，那个专属分销码需要自己替换，由于我不懂前端，没法给出详细的使用说明，我自己的分销码是我的前端朋友帮我专门写到一个分支里了。\n另外爬精选列表，只能拿到部分上推荐的专栏，其他不在推荐里的，要么去其他的导航站爬，要么靠其他散落的地方传播了。\n小报童的专栏价格都不大贵，适合当知识付费的小册来购买，有的可以来点启发我觉得就能值回票价了。\n","wordCount":"4734","inLanguage":"zh","datePublished":"2024-07-21T13:08:59+08:00","dateModified":"2024-07-21T13:08:59+08:00","author":{"@type":"Person","name":"since"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.thend03.com/posts/how-to-make-a-xiaobot-nav/"},"publisher":{"@type":"Organization","name":"Fayy\u0026Fc's Blog","logo":{"@type":"ImageObject","url":"https://blog.thend03.com/img/logo.jpg"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.thend03.com/ accesskey=h title="fayy&amp;fc (Alt + H)"><img src=https://blog.thend03.com/img/logo.jpg alt=logo aria-label=logo height=35>fayy&amp;fc</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://blog.thend03.com/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li><li><a href=https://blog.thend03.com/ title="🏠 主页"><span>🏠 主页</span></a></li><li><a href=https://blog.thend03.com/archives/ title="⏱️ 归档"><span>⏱️ 归档</span></a></li><li><a href=https://blog.thend03.com/tags title="🧩 标签"><span>🧩 标签</span></a></li><li><a href=https://blog.thend03.com/about title="🙋🏻‍♂️ 关于"><span>🙋🏻‍♂️ 关于</span></a></li><li><a href=https://blog.thend03.com/links title="🤝 友链"><span>🤝 友链</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://blog.thend03.com/>🏠 主页</a>&nbsp;»&nbsp;<a href=https://blog.thend03.com/posts/>📚文章</a></div><h1 class=post-title>如何做一个小报童分销导航</h1><div class=post-description>从0到1做1个小报童分销导航</div><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2024-07-21
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>4734字
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>10分钟
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>since
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://blog.thend03.com/tags/xiaobot/ style=color:var(--secondary)!important>Xiaobot</a>
&nbsp;<a href=https://blog.thend03.com/tags/spider/ style=color:var(--secondary)!important>Spider</a>
&nbsp;<a href=https://blog.thend03.com/tags/nav/ style=color:var(--secondary)!important>Nav</a>
</span></span></span></span><span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;
</span></span><span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://blog.thend03.com/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:null,region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#0x0 aria-label=0x0>0x0</a></li><li><a href=#%e5%b0%8f%e6%8a%a5%e7%ab%a5%e7%ae%80%e4%bb%8b aria-label=小报童简介>小报童简介</a></li><li><a href=#%e6%95%b0%e6%8d%ae%e6%ba%90 aria-label=数据源>数据源</a><ul><li><a href=#%e5%b0%8f%e6%8a%a5%e7%ab%a5%e7%b2%be%e9%80%89 aria-label=小报童精选>小报童精选</a></li><li><a href=#pyq aria-label=pyq>pyq</a></li><li><a href=#%e5%88%ab%e4%ba%ba%e6%95%b4%e7%90%86%e5%a5%bd%e7%9a%84%e4%b8%93%e6%a0%8f%e5%88%97%e8%a1%a8 aria-label=别人整理好的专栏列表>别人整理好的专栏列表</a></li><li><a href=#%e7%88%ac%e5%bd%93%e5%89%8d%e5%b7%b2%e6%9c%89%e7%9a%84%e5%af%bc%e8%88%aa%e7%ab%99%e7%9a%84%e6%95%b0%e6%8d%ae aria-label=爬当前已有的导航站的数据>爬当前已有的导航站的数据</a></li></ul></li><li><a href=#%e6%95%b0%e6%8d%ae%e6%ba%90%e7%9a%84%e9%80%89%e6%8b%a9 aria-label=数据源的选择>数据源的选择</a></li><li><a href=#%e6%95%b0%e6%8d%ae%e6%95%b4%e7%90%86%e5%88%86%e7%b1%bb aria-label=数据整理分类>数据整理分类</a><ul><li><a href=#%e5%a6%82%e4%bd%95%e6%8b%bf%e5%88%b0%e4%b8%93%e6%a0%8f%e6%8e%a8%e8%8d%90%e5%88%97%e8%a1%a8 aria-label=如何拿到专栏推荐列表>如何拿到专栏推荐列表</a></li><li><a href=#%e5%a6%82%e4%bd%95%e6%8b%bf%e5%88%b0%e4%b8%93%e6%a0%8f%e5%9c%b0%e5%9d%80 aria-label=如何拿到专栏地址>如何拿到专栏地址</a></li><li><a href=#%e5%a6%82%e4%bd%95%e8%8e%b7%e5%8f%96%e4%b8%93%e6%a0%8f%e7%9a%84%e8%af%a6%e6%83%85 aria-label=如何获取专栏的详情>如何获取专栏的详情</a></li></ul></li><li><a href=#%e5%89%8d%e7%ab%af%e9%a1%b5%e9%9d%a2%e5%b1%95%e7%a4%ba aria-label=前端页面展示>前端页面展示</a></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=总结>总结</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>小报童精选导航站成果展示: <a href=https://re.gloaming.top/>https://re.gloaming.top/</a></p><h1 id=0x0>0x0<a hidden class=anchor aria-hidden=true href=#0x0>#</a></h1><p>导航站的详细实操，讲了专栏来源的选择，如何整理获取专栏列表详情，前端样式怎么做，如何部署并生成最终的导航站等。</p><p>由于前端能力实在有限，所以本篇文章的重点是在如何获取精选的专栏列表上。</p><p>导航站使用一个开源项目改造而来。</p><h1 id=小报童简介>小报童简介<a hidden class=anchor aria-hidden=true href=#小报童简介>#</a></h1><p><a href=https://xiaobot.net/home.html>小报童</a>是个去中心化的课程平台。</p><blockquote><p>创作者可以在小报童体面而用心的创作，专注创作，不搞套路。</p><p>而且专栏的价格大部分都比较便宜。</p><p>小报童官方不做社群，不做广告变现，不做算法推荐。</p></blockquote><p>因为小报童是去中心化的，所以官网没有所有的专栏列表，只能通过专栏作者自发性的传播，或者小报童官方的推荐才能找到专栏地址。</p><p>所以有人就做了小报童的导航站，用来推荐专栏。</p><p>而且小报童这个不需要买专栏，就可以获得分销链接。所以理论上小报童的所有专栏都可以免费获得分销链接。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407211337712.png alt=image-20240721133751669></p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407211338766.png alt=image-20240721133805735></p><p>另外大声的吐槽一下，这样的专栏都是谁在买。</p><p>别人通过你的链接买了之后，你就可以获得分销收入。</p><p>但是吧，分销站这个东西，可能确实得有点私域流量才行，在pyq发分销的二维码，或者公众号发文章，或者自己的社群里发一下进行推荐。</p><p>单纯靠seo的话，目前排名比较靠前的seo做的都挺好的，新站感觉得做持久化运营搜索引擎排名才能上的去。</p><p>单搜小报童，官网占了整整一屏，下面的就是一些分销站了。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407211330954.png alt=image-20240721133054830></p><p>回到分销站，该如何从01到1做一个分销站出来。</p><p>我努力搜索，都没有搜索出一个可用的分销导航模板出来，有点点难。</p><h1 id=数据源>数据源<a hidden class=anchor aria-hidden=true href=#数据源>#</a></h1><p>做导航站首先要拿到数据，由于小报童的特殊性(去中心化)，所以没法从官网得到所有专栏的数据。</p><p>那么可以选择从以下的几种渠道拿到数据</p><ul><li>小报童精选公众号，里面会有一些精选专栏的推荐。</li><li>pyq各种散落的专栏推荐</li><li>别人整理好的专栏列表</li><li>爬当前已有的小报童导航站的数据</li></ul><h2 id=小报童精选>小报童精选<a hidden class=anchor aria-hidden=true href=#小报童精选>#</a></h2><p>小报童精选是小报童官方的公众号。</p><p>虽然是去中心化，但是一点入口都看不到，专栏的推广确实是会受阻。</p><p>所以有了小报童精选这个事。</p><p>精选文章每期会推荐一些有价值的专栏。所以精选是个获取专栏列表的路子。但是精选只能拿到一部分的专栏。</p><h2 id=pyq>pyq<a hidden class=anchor aria-hidden=true href=#pyq>#</a></h2><p>pyq加的一些人，会去推荐专栏，他们买了之后，会发他们自己的专属分销海报。</p><p>有时候我也会去通过他们的链接买一点，但是这种就是随缘，数量也不会太多。</p><h2 id=别人整理好的专栏列表>别人整理好的专栏列表<a hidden class=anchor aria-hidden=true href=#别人整理好的专栏列表>#</a></h2><p>我在网上冲浪的时候，发现了别人有一份整理好的专栏列表，但是这个可能会有时效性的问题，作者更新不及时，就拿不到增量的专栏列表。</p><p>下面这个就是一个民间的版本，上次更新还是在2年前。</p><p><a href="https://github.com/qianguyihao/xiaobot-list?tab=readme-ov-file">https://github.com/qianguyihao/xiaobot-list?tab=readme-ov-file</a></p><h2 id=爬当前已有的导航站的数据>爬当前已有的导航站的数据<a hidden class=anchor aria-hidden=true href=#爬当前已有的导航站的数据>#</a></h2><p>这条路我感觉是最好的，多选几个导航站，把他们的专栏列表都爬一遍，然后去个重，就得到了最新最全的专栏列表了。</p><h1 id=数据源的选择>数据源的选择<a hidden class=anchor aria-hidden=true href=#数据源的选择>#</a></h1><p>上面介绍了几种数据来源，我这边选择的是爬小报童精选的推荐列表。其实更好的是去爬已有导航站的数据。</p><p>不过就精选专栏而言，官方的其实更好，毕竟官方已经做过一轮筛选了，能上推荐的肯定有其优点。</p><h1 id=数据整理分类>数据整理分类<a hidden class=anchor aria-hidden=true href=#数据整理分类>#</a></h1><p>选择好之后，我们就需要对推荐列表进行分类，订阅号里有目前所有的专栏推荐列表。截止到现在一共有26期。</p><p>那么对推荐列表进行整理就有2种方法。</p><ul><li>人工整理</li><li>爬虫分类</li></ul><p>26期的话，点开26条公众号文章，收集下所有的推荐专栏的二维码，倒也还好。</p><p>但是作为一个资深crud boy，能写代码就写代码。不能写代码，就让chatgpt帮我们写代码。</p><p>语言选择的是Java(资深java crud仔)。</p><p>选择的框架有如下几个</p><ul><li>Jsoup, 用于解析html</li><li>Fastjson2，用于字符串转json处理</li><li>Hutool，http&二维码识别</li><li>selenium, 用于浏览器模拟，一些异步加载的页面需要用到这个</li><li>commons-io，文件操作</li></ul><p>下面就是实操了</p><h2 id=如何拿到专栏推荐列表>如何拿到专栏推荐列表<a hidden class=anchor aria-hidden=true href=#如何拿到专栏推荐列表>#</a></h2><p>首先是进入小报童精选 公众号的聊天页面，左下角有个往期回顾，这里就是推荐专栏的合集页面。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407211448481.png alt=image-20240721144801453></p><p>然后点击右上角，选择复制链接，或者选择使用默认浏览器打开，就可以拿到订阅列表的url</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407211448061.png alt=image-20240721144817021></p><p>下面就是页面分析了，通过滑动页面猜测这个列表是分页加载的。</p><p>可以在控制台看网络请求，也可以看的出来。</p><p>uri中有一个关键的key，appmsgalbum， 这个看着像是列表的请求。经过测验，这个确实是分页参数。</p><p>浏览器地址栏的链接访问只能访问到第一页的页面。下面就要靠分页查询拿数据了。</p><p>下面的分页请求返回的是json数据，第一页是html数据。</p><p>分页参数有2个比较关键的key，begin_msgid和begin_itemidx，这个一个是分页参数，一个是消息id，传入页数和id，查询下面的消息</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407211502190.png alt=image-20240721150209139></p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407211523946.png alt=image-20240721152306897></p><p>这样的话就可以拿到所有的推荐文章的详细链接了。每一篇文章有一个专题推荐，包含数个专栏的推荐</p><p>经过页面元素审查以及debug，得到了如下获取订阅列表每篇文章地址的方法</p><p>常量类如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Constants</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String XIAOBOT_WECHAT_SUBSCRIBE_LIST_URL <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;__biz=Mzg4MTc0MDcyOA==&amp;scene=1&amp;album_id=2262723582487429130&amp;count=100&amp;uin=&amp;key=&amp;devicetype=iMac+MacBookPro18%2C1+OSX+OSX+14.5+build(23F79)&amp;version=13080811&amp;lang=zh_CN&amp;nettype=WIFI&amp;ascene=0&amp;fontScale=100&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String LOCAL_CHROME_DRIVER_PATH <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/Users/since/Downloads/chromedriver-mac-arm64/chromedriver&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String LIST_NEXT_URL_FORMAT <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;__biz=Mzg4MTc0MDcyOA==&amp;album_id=2262723582487429130&amp;count=100&amp;begin_msgid=%s&amp;begin_itemidx=%s&amp;uin=&amp;key=&amp;pass_ticket=&amp;wxtoken=&amp;devicetype=iMac&amp;nbsp;MacBookPro18,1&amp;nbsp;OSX&amp;nbsp;OSX&amp;nbsp;14.5&amp;nbsp;build(23F79)&amp;clientversion=13080811&amp;__biz=Mzg4MTc0MDcyOA==&amp;appmsg_token=&amp;x5=0&amp;f=json&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>获取订阅列表方法</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> cn.hutool.http.HttpUtil;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.alibaba.fastjson2.JSON;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.alibaba.fastjson2.JSONArray;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.alibaba.fastjson2.JSONObject;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.thend03.xiaobot.spider.constants.Constants;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.thend03.xiaobot.spider.model.ArticleDetail;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.thend03.xiaobot.spider.model.WechatModel;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.commons.collections4.CollectionUtils;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.commons.lang3.StringUtils;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.jsoup.Jsoup;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.jsoup.nodes.Attributes;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.jsoup.nodes.Document;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.jsoup.nodes.Element;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.jsoup.select.Elements;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.net.MalformedURLException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.nio.charset.StandardCharsets;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.ArrayList;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Objects;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.stream.Collectors;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 小报童专栏精选订阅号列表解析服务
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author since
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date 2024-07-17 08:12
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WechatSubscribeListService</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>ArticleDetail<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>parseArticleList</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        String content <span style=color:#f92672>=</span> HttpUtil.<span style=color:#a6e22e>downloadString</span>(Constants.<span style=color:#a6e22e>XIAOBOT_WECHAT_SUBSCRIBE_LIST_URL</span>, StandardCharsets.<span style=color:#a6e22e>UTF_8</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Document parse <span style=color:#f92672>=</span> Jsoup.<span style=color:#a6e22e>parse</span>(content);
</span></span><span style=display:flex><span>        Elements albumListItem <span style=color:#f92672>=</span> parse.<span style=color:#a6e22e>getElementsByClass</span>(<span style=color:#e6db74>&#34;album__list-item&#34;</span>);
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(1);
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>WechatModel<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> hasNext <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (Element element : albumListItem) {
</span></span><span style=display:flex><span>            Attributes attributes <span style=color:#f92672>=</span> element.<span style=color:#a6e22e>attributes</span>();
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(2);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (attributes.<span style=color:#a6e22e>isEmpty</span>()) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            String s <span style=color:#f92672>=</span> attributes.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;data-msgid&#34;</span>);
</span></span><span style=display:flex><span>            String s1 <span style=color:#f92672>=</span> attributes.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;data-itemidx&#34;</span>);
</span></span><span style=display:flex><span>            String s2 <span style=color:#f92672>=</span> attributes.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;data-link&#34;</span>);
</span></span><span style=display:flex><span>            String s3 <span style=color:#f92672>=</span> attributes.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;data-title&#34;</span>);
</span></span><span style=display:flex><span>            String s4 <span style=color:#f92672>=</span> attributes.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;data-pos_num&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            WechatModel wechatModel <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> WechatModel();
</span></span><span style=display:flex><span>            wechatModel.<span style=color:#a6e22e>setDataMsgId</span>(parseLong(s));
</span></span><span style=display:flex><span>            wechatModel.<span style=color:#a6e22e>setDataItemIndex</span>(parseInt(s1));
</span></span><span style=display:flex><span>            wechatModel.<span style=color:#a6e22e>setDataLink</span>(s2);
</span></span><span style=display:flex><span>            wechatModel.<span style=color:#a6e22e>setDataTitle</span>(s3);
</span></span><span style=display:flex><span>            wechatModel.<span style=color:#a6e22e>setDataPosNum</span>(parseInt(s4));
</span></span><span style=display:flex><span>            list.<span style=color:#a6e22e>add</span>(wechatModel);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (wechatModel.<span style=color:#a6e22e>getDataPosNum</span>() <span style=color:#f92672>==</span> 1) {
</span></span><span style=display:flex><span>                hasNext <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (hasNext) {
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>WechatModel<span style=color:#f92672>&gt;</span> list1 <span style=color:#f92672>=</span> nextParse(list.<span style=color:#a6e22e>get</span>(list.<span style=color:#a6e22e>size</span>() <span style=color:#f92672>-</span> 1));
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (CollectionUtils.<span style=color:#a6e22e>isNotEmpty</span>(list1)) {
</span></span><span style=display:flex><span>                list.<span style=color:#a6e22e>addAll</span>(list1);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (list1.<span style=color:#a6e22e>get</span>(list1.<span style=color:#a6e22e>size</span>() <span style=color:#f92672>-</span> 1).<span style=color:#a6e22e>getDataPosNum</span>() <span style=color:#f92672>==</span> 1) {
</span></span><span style=display:flex><span>                hasNext <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> urlList <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        list.<span style=color:#a6e22e>stream</span>().<span style=color:#a6e22e>filter</span>(Objects::nonNull).<span style=color:#a6e22e>forEach</span>(s <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> urlList1 <span style=color:#f92672>=</span> WechatDetailService.<span style=color:#a6e22e>getUrlList</span>(s.<span style=color:#a6e22e>getDataLink</span>());
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (CollectionUtils.<span style=color:#a6e22e>isNotEmpty</span>(urlList1)) {
</span></span><span style=display:flex><span>                urlList.<span style=color:#a6e22e>addAll</span>(urlList1);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> collect <span style=color:#f92672>=</span> urlList.<span style=color:#a6e22e>stream</span>().<span style=color:#a6e22e>filter</span>(StringUtils::isNotBlank).<span style=color:#a6e22e>filter</span>(s <span style=color:#f92672>-&gt;</span> s.<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;http&#34;</span>) <span style=color:#f92672>&amp;&amp;</span> s.<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;xiaobot.net/p&#34;</span>)).<span style=color:#a6e22e>map</span>(s <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            String<span style=color:#f92672>[]</span> split <span style=color:#f92672>=</span> s.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;\\?&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> split<span style=color:#f92672>[</span>0<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>        }).<span style=color:#a6e22e>distinct</span>().<span style=color:#a6e22e>collect</span>(Collectors.<span style=color:#a6e22e>toList</span>());
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>ArticleDetail<span style=color:#f92672>&gt;</span> collect1 <span style=color:#f92672>=</span> collect.<span style=color:#a6e22e>stream</span>().<span style=color:#a6e22e>filter</span>(Objects::nonNull).<span style=color:#a6e22e>map</span>(url <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            String host <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>            String uniqueId <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                host <span style=color:#f92672>=</span> WechatDetailService.<span style=color:#a6e22e>getHost</span>(url);
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (MalformedURLException e) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                uniqueId <span style=color:#f92672>=</span> WechatDetailService.<span style=color:#a6e22e>getArticleUniqueId</span>(url);
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (MalformedURLException e) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(e);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> WechatDetailService.<span style=color:#a6e22e>getArticleDetail</span>(host, uniqueId);
</span></span><span style=display:flex><span>        }).<span style=color:#a6e22e>collect</span>(Collectors.<span style=color:#a6e22e>toList</span>());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> collect1;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>parseLong</span>(String dataMsgId) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Long.<span style=color:#a6e22e>parseLong</span>(dataMsgId);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>1;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>parseInt</span>(String itemIndex) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Integer.<span style=color:#a6e22e>parseInt</span>(itemIndex);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>1;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>WechatModel<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>nextParse</span>(WechatModel wechatModel) {
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>WechatModel<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        String format <span style=color:#f92672>=</span> String.<span style=color:#a6e22e>format</span>(Constants.<span style=color:#a6e22e>LIST_NEXT_URL_FORMAT</span>, wechatModel.<span style=color:#a6e22e>getDataMsgId</span>(), wechatModel.<span style=color:#a6e22e>getDataItemIndex</span>());
</span></span><span style=display:flex><span>        String content <span style=color:#f92672>=</span> HttpUtil.<span style=color:#a6e22e>downloadString</span>(format, StandardCharsets.<span style=color:#a6e22e>UTF_8</span>);
</span></span><span style=display:flex><span>        JSONObject jsonObject <span style=color:#f92672>=</span> JSON.<span style=color:#a6e22e>parseObject</span>(content);
</span></span><span style=display:flex><span>        JSONObject getalbumResp <span style=color:#f92672>=</span> jsonObject.<span style=color:#a6e22e>getJSONObject</span>(<span style=color:#e6db74>&#34;getalbum_resp&#34;</span>);
</span></span><span style=display:flex><span>        JSONArray articleList <span style=color:#f92672>=</span> getalbumResp.<span style=color:#a6e22e>getJSONArray</span>(<span style=color:#e6db74>&#34;article_list&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> articleList.<span style=color:#a6e22e>size</span>(); i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            Object o <span style=color:#f92672>=</span> articleList.<span style=color:#a6e22e>get</span>(i);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (o <span style=color:#66d9ef>instanceof</span> JSONObject) {
</span></span><span style=display:flex><span>                JSONObject json <span style=color:#f92672>=</span> (JSONObject) o;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>long</span> msgid <span style=color:#f92672>=</span> json.<span style=color:#a6e22e>getLongValue</span>(<span style=color:#e6db74>&#34;msgid&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> itemidx <span style=color:#f92672>=</span> json.<span style=color:#a6e22e>getIntValue</span>(<span style=color:#e6db74>&#34;itemidx&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> posNum <span style=color:#f92672>=</span> json.<span style=color:#a6e22e>getIntValue</span>(<span style=color:#e6db74>&#34;pos_num&#34;</span>);
</span></span><span style=display:flex><span>                String title <span style=color:#f92672>=</span> json.<span style=color:#a6e22e>getString</span>(<span style=color:#e6db74>&#34;title&#34;</span>);
</span></span><span style=display:flex><span>                String link <span style=color:#f92672>=</span> json.<span style=color:#a6e22e>getString</span>(<span style=color:#e6db74>&#34;url&#34;</span>);
</span></span><span style=display:flex><span>                WechatModel nextWechatModel <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> WechatModel();
</span></span><span style=display:flex><span>                nextWechatModel.<span style=color:#a6e22e>setDataMsgId</span>(msgid);
</span></span><span style=display:flex><span>                nextWechatModel.<span style=color:#a6e22e>setDataItemIndex</span>(itemidx);
</span></span><span style=display:flex><span>                nextWechatModel.<span style=color:#a6e22e>setDataLink</span>(link);
</span></span><span style=display:flex><span>                nextWechatModel.<span style=color:#a6e22e>setDataTitle</span>(title);
</span></span><span style=display:flex><span>                nextWechatModel.<span style=color:#a6e22e>setDataPosNum</span>(posNum);
</span></span><span style=display:flex><span>                list.<span style=color:#a6e22e>add</span>(nextWechatModel);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> list;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=如何拿到专栏地址>如何拿到专栏地址<a hidden class=anchor aria-hidden=true href=#如何拿到专栏地址>#</a></h2><p>在上一步 我们拿到了26篇精选推荐的文章地址列表，这一步我们需要解析每一篇文章详情，拿到这一批推荐的专栏合集。</p><p>每一篇文章里都会推荐1~N篇文章，数量不等。</p><p>我拿几篇文章分析了一下，每篇文章的专栏没有特定的标签，但是由于是公众号文章，所以专栏都是以图片二维码的形式提供的。</p><p>即能拿到所有的专栏二维码图片即可。</p><p>以<a href="https://mp.weixin.qq.com/s?__biz=Mzg4MTc0MDcyOA==&amp;mid=2247484196&amp;idx=1&amp;sn=7034ef1197b8658d86cef8db1d04f3a9&amp;chksm=cf601df3f81794e5e074a30892c95c54e1b33fcef5cbea7a4590a95f37652e0f890e72265efb&amp;scene=178&amp;cur_album_id=2262723582487429130#rd">序号26</a>的这篇文章为例</p><p>推荐的专栏以文字介绍+二维码的图片格式提供出来。</p><p>这篇文章一共推荐了4个专栏，理论上我们拿到这4个专栏的图片二维码就可以了。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407250847107.png alt=image-20240725084710014></p><p>那么打开浏览器的控制台，进行元素审查，在img标签里的data-src字段可以拿到图片地址</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407250900864.png alt=image-20240725090035806></p><p>现在的获取图片地址的方法过于生硬了，需要从script里解析变量重重硬解析才能拿到图片地址</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> result <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        String content <span style=color:#f92672>=</span> HttpUtil.<span style=color:#a6e22e>downloadString</span>(wechatUrl, StandardCharsets.<span style=color:#a6e22e>UTF_8</span>);
</span></span><span style=display:flex><span>        Document parse <span style=color:#f92672>=</span> Jsoup.<span style=color:#a6e22e>parse</span>(content);
</span></span><span style=display:flex><span>        Elements scripts <span style=color:#f92672>=</span> parse.<span style=color:#a6e22e>getElementsByTag</span>(<span style=color:#e6db74>&#34;script&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (Element script : scripts) {
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>Node<span style=color:#f92672>&gt;</span> nodes <span style=color:#f92672>=</span> script.<span style=color:#a6e22e>childNodes</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (Node node : nodes) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (node <span style=color:#66d9ef>instanceof</span> DataNode) {
</span></span><span style=display:flex><span>                    DataNode dataNode <span style=color:#f92672>=</span> (DataNode) node;
</span></span><span style=display:flex><span>                    String wholeData <span style=color:#f92672>=</span> dataNode.<span style=color:#a6e22e>getWholeData</span>();
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> (wholeData.<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;cdn_url&#34;</span>)) {
</span></span><span style=display:flex><span>                        String<span style=color:#f92672>[]</span> split <span style=color:#f92672>=</span> wholeData.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;var&#34;</span>);
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> split.<span style=color:#a6e22e>length</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                            String s <span style=color:#f92672>=</span> split<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>if</span> (s.<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;picturePageInfoList&#34;</span>) <span style=color:#f92672>&amp;&amp;</span> s.<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;http&#34;</span>)) {
</span></span><span style=display:flex><span>                                String<span style=color:#f92672>[]</span> split1 <span style=color:#f92672>=</span> s.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;picturePageInfoList&#34;</span>);
</span></span><span style=display:flex><span>                                String cdnUrl <span style=color:#f92672>=</span> split1<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>                                String s1 <span style=color:#f92672>=</span> cdnUrl.<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;\\[&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>                                        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;]&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>                                        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;\\{&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>                                        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;}&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>                                        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;&#39;&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>                                        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;\&#34;&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>                                String<span style=color:#f92672>[]</span> split2 <span style=color:#f92672>=</span> s1.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;,&#34;</span>);
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> j <span style=color:#f92672>=</span> 0; j <span style=color:#f92672>&lt;</span> split2.<span style=color:#a6e22e>length</span>; j<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                                    <span style=color:#66d9ef>if</span> (split2<span style=color:#f92672>[</span>j<span style=color:#f92672>]</span>.<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;cdn_url&#34;</span>)) {
</span></span><span style=display:flex><span>                                        String<span style=color:#f92672>[]</span> split3 <span style=color:#f92672>=</span> split2<span style=color:#f92672>[</span>j<span style=color:#f92672>]</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;cdn_url:&#34;</span>);
</span></span><span style=display:flex><span>                                        result.<span style=color:#a6e22e>add</span>(split3<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>);
</span></span><span style=display:flex><span>                                    }
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></div><p>其实换个方法，一句话就可以提取所有图片地址了, 使用select方法，标签+属性即可。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407250902466.png alt=image-20240725090232398></p><p>那么拿到图片地址之后，使用hutool进行二维码识别，报错了就忽略异常，有二维码的能成功解析，那么正常解析的就是二维码地址了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>hutoolOcr</span>(String imageUrl) <span style=color:#66d9ef>throws</span> IOException, URISyntaxException {
</span></span><span style=display:flex><span>        String finalUrl <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        File file <span style=color:#f92672>=</span> HttpUtil.<span style=color:#a6e22e>downloadFileFromUrl</span>(imageUrl, <span style=color:#e6db74>&#34;static/&#34;</span> <span style=color:#f92672>+</span> COUNT.<span style=color:#a6e22e>getAndIncrement</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.png&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            finalUrl <span style=color:#f92672>=</span> QrCodeUtil.<span style=color:#a6e22e>decode</span>(file);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> finalUrl;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>这样就拿到每期精选的所有的推荐专栏列表了</p><h2 id=如何获取专栏的详情>如何获取专栏的详情<a hidden class=anchor aria-hidden=true href=#如何获取专栏的详情>#</a></h2><p>那么拿到专栏地址之后，就是去处理专栏了，我们上一步拿到的只是专栏的地址，专栏标题、作者、专栏头像、专栏介绍、专栏的已购数、文章数，都需要从专栏里获取。</p><p>打开控制台，这几个接口把所有的数据都返回了，且返回的是json数据，所以看着很美好。</p><p>但是这几个接口都是要签名的，整个页面是异步加载的，无法使用jsoup进行解析。而且也不知道签名规则，所以这条路行不通。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407250910028.png alt=image-20240725091033955></p><p>后来经过一番搜索，可以使用selenium模拟浏览器，等待页面异步加载完成，这样就可以使用jsoup解析页面了。</p><p>使用selenium需要在下载chrome驱动到本地，chrome驱动需要和自己的chrome浏览器版本相等或相近，版本不要差太多。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407250919847.png alt=image-20240725091920785></p><p>114之前的版本在https://chromedriver.storage.googleapis.com/index.html下载</p><p>127之后的版本在https://googlechromelabs.github.io/chrome-for-testing/下载</p><p>115-126的暂时没找到，随着时间推移，这个最新的版本也可能会发生变化</p><p>记得是下载chromedriver</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/thend03/mdPic/picGo/202407251050362.png alt=image-20240725105043283></p><p>拿到driver之后，就可以使用代码模拟浏览器的页面异步加载过程，得到完整的页面了，然后就可以使用jsoup解析页面元素</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getArticleFullPage</span>(String url) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置 ChromeDriver 路径</span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>setProperty</span>(<span style=color:#e6db74>&#34;webdriver.chrome.driver&#34;</span>, Constants.<span style=color:#a6e22e>LOCAL_CHROME_DRIVER_PATH</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置 Chrome 选项</span>
</span></span><span style=display:flex><span>        ChromeOptions options <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ChromeOptions();
</span></span><span style=display:flex><span>        options.<span style=color:#a6e22e>addArguments</span>(<span style=color:#e6db74>&#34;--headless&#34;</span>); <span style=color:#75715e>// 无头模式</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 启动 Chrome 浏览器</span>
</span></span><span style=display:flex><span>        WebDriver driver <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ChromeDriver(options);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 访问目标网页</span>
</span></span><span style=display:flex><span>        driver.<span style=color:#a6e22e>get</span>(url);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        String pageContent <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 等待网页加载完成（根据需要调整等待时间）</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            Thread.<span style=color:#a6e22e>sleep</span>(2000);
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 获取网页内容</span>
</span></span><span style=display:flex><span>            pageContent <span style=color:#f92672>=</span> driver.<span style=color:#a6e22e>getPageSource</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 打印网页内容</span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(pageContent);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            driver.<span style=color:#a6e22e>quit</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pageContent;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>整体解析文章详情的方法如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> ArticleDetail <span style=color:#a6e22e>getArticleDetail</span>(String host, String uniqueId) {
</span></span><span style=display:flex><span>        String url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://&#34;</span> <span style=color:#f92672>+</span> host <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/p/&#34;</span> <span style=color:#f92672>+</span> uniqueId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        String articleFullPage <span style=color:#f92672>=</span> getArticleFullPage(url);
</span></span><span style=display:flex><span>        Document document <span style=color:#f92672>=</span> Jsoup.<span style=color:#a6e22e>parse</span>(articleFullPage);
</span></span><span style=display:flex><span>        Elements title <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByTag</span>(<span style=color:#e6db74>&#34;title&#34;</span>);
</span></span><span style=display:flex><span>        Elements intro <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByClass</span>(<span style=color:#e6db74>&#34;intro&#34;</span>);
</span></span><span style=display:flex><span>        Elements description <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByClass</span>(<span style=color:#e6db74>&#34;description&#34;</span>);
</span></span><span style=display:flex><span>        Elements posts <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByClass</span>(<span style=color:#e6db74>&#34;posts&#34;</span>);
</span></span><span style=display:flex><span>        Elements elementsByClass <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByClass</span>(<span style=color:#e6db74>&#34;paper&#34;</span>);
</span></span><span style=display:flex><span>        Elements num <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByClass</span>(<span style=color:#e6db74>&#34;num&#34;</span>);
</span></span><span style=display:flex><span>        Elements avatar <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByClass</span>(<span style=color:#e6db74>&#34;avatar&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        String articleTitle <span style=color:#f92672>=</span> getArticleTitle(title);
</span></span><span style=display:flex><span>        String articleDescription <span style=color:#f92672>=</span> getArticleDescription(description);
</span></span><span style=display:flex><span>        String articleIntro <span style=color:#f92672>=</span> getArticleIntro(intro);
</span></span><span style=display:flex><span>        Map<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;</span> articleNum <span style=color:#f92672>=</span> getArticleNum(num);
</span></span><span style=display:flex><span>        String articleAvatar <span style=color:#f92672>=</span> getArticleAvatar(avatar);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ArticleDetail articleDetail <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArticleDetail();
</span></span><span style=display:flex><span>        articleDetail.<span style=color:#a6e22e>setAvatarBase64</span>(articleAvatar);
</span></span><span style=display:flex><span><span style=color:#75715e>//        articleDetail.setGmtCreate(createdAt);</span>
</span></span><span style=display:flex><span>        articleDetail.<span style=color:#a6e22e>setIntroduction</span>(articleIntro);
</span></span><span style=display:flex><span><span style=color:#75715e>//        articleDetail.setFreePostCount(freePostCount);</span>
</span></span><span style=display:flex><span>        articleDetail.<span style=color:#a6e22e>setPostCount</span>(articleNum.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;post&#34;</span>));
</span></span><span style=display:flex><span>        articleDetail.<span style=color:#a6e22e>setTitle</span>(articleTitle);
</span></span><span style=display:flex><span>        articleDetail.<span style=color:#a6e22e>setSubscriberCount</span>(articleNum.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;reader&#34;</span>));
</span></span><span style=display:flex><span>        articleDetail.<span style=color:#a6e22e>setUrl</span>(url);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(1);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> articleDetail;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getHost</span>(String articleUrl) <span style=color:#66d9ef>throws</span> MalformedURLException {
</span></span><span style=display:flex><span>        java.<span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>URL</span> url <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> URL(articleUrl);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> url.<span style=color:#a6e22e>getHost</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getArticleUniqueId</span>(String articleUrl) <span style=color:#66d9ef>throws</span> MalformedURLException {
</span></span><span style=display:flex><span>        java.<span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>URL</span> url <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> URL(articleUrl);
</span></span><span style=display:flex><span>        String path <span style=color:#f92672>=</span> url.<span style=color:#a6e22e>getPath</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> path.<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;/p/&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getArticleFullPage</span>(String url) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置 ChromeDriver 路径</span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>setProperty</span>(<span style=color:#e6db74>&#34;webdriver.chrome.driver&#34;</span>, Constants.<span style=color:#a6e22e>LOCAL_CHROME_DRIVER_PATH</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置 Chrome 选项</span>
</span></span><span style=display:flex><span>        ChromeOptions options <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ChromeOptions();
</span></span><span style=display:flex><span>        options.<span style=color:#a6e22e>addArguments</span>(<span style=color:#e6db74>&#34;--headless&#34;</span>); <span style=color:#75715e>// 无头模式</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 启动 Chrome 浏览器</span>
</span></span><span style=display:flex><span>        WebDriver driver <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ChromeDriver(options);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 访问目标网页</span>
</span></span><span style=display:flex><span>        driver.<span style=color:#a6e22e>get</span>(url);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        String pageContent <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 等待网页加载完成（根据需要调整等待时间）</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            Thread.<span style=color:#a6e22e>sleep</span>(2000);
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 获取网页内容</span>
</span></span><span style=display:flex><span>            pageContent <span style=color:#f92672>=</span> driver.<span style=color:#a6e22e>getPageSource</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 打印网页内容</span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(pageContent);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            driver.<span style=color:#a6e22e>quit</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pageContent;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 专栏的标题
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param title title element
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return title
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getArticleTitle</span>(Elements title) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (Objects.<span style=color:#a6e22e>isNull</span>(title)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (title.<span style=color:#a6e22e>isEmpty</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> result <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (Element element : title) {
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>Node<span style=color:#f92672>&gt;</span> nodes <span style=color:#f92672>=</span> element.<span style=color:#a6e22e>childNodes</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (CollectionUtils.<span style=color:#a6e22e>isEmpty</span>(nodes)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> collect <span style=color:#f92672>=</span> nodes.<span style=color:#a6e22e>stream</span>().<span style=color:#a6e22e>filter</span>(Objects::nonNull).<span style=color:#a6e22e>map</span>(node <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (node <span style=color:#66d9ef>instanceof</span> TextNode) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> ((TextNode) node).<span style=color:#a6e22e>text</span>();
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>            }).<span style=color:#a6e22e>collect</span>(Collectors.<span style=color:#a6e22e>toList</span>());
</span></span><span style=display:flex><span>            result.<span style=color:#a6e22e>addAll</span>(collect);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> StringUtils.<span style=color:#a6e22e>join</span>(result, <span style=color:#e6db74>&#34;,&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getArticleDescription</span>(Elements description) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (Objects.<span style=color:#a6e22e>isNull</span>(description)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (description.<span style=color:#a6e22e>isEmpty</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> result <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        Iterator<span style=color:#f92672>&lt;</span>Element<span style=color:#f92672>&gt;</span> iterator <span style=color:#f92672>=</span> description.<span style=color:#a6e22e>iterator</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (iterator.<span style=color:#a6e22e>hasNext</span>()) {
</span></span><span style=display:flex><span>            Element next <span style=color:#f92672>=</span> iterator.<span style=color:#a6e22e>next</span>();
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> parseNode(next);
</span></span><span style=display:flex><span>            result.<span style=color:#a6e22e>add</span>(StringUtils.<span style=color:#a6e22e>join</span>(list, <span style=color:#e6db74>&#34;&#34;</span>));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        String join <span style=color:#f92672>=</span> StringUtils.<span style=color:#a6e22e>join</span>(result, <span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> join.<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;&lt;p&gt;&lt;/p&gt;&#34;</span>, <span style=color:#e6db74>&#34;\r\n\n&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getArticleIntro</span>(Elements intro) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (Objects.<span style=color:#a6e22e>isNull</span>(intro)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (intro.<span style=color:#a6e22e>isEmpty</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> result <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (Element next : intro) {
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> parseNode(next);
</span></span><span style=display:flex><span>            result.<span style=color:#a6e22e>add</span>(StringUtils.<span style=color:#a6e22e>join</span>(list, <span style=color:#e6db74>&#34;&#34;</span>));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        String join <span style=color:#f92672>=</span> StringUtils.<span style=color:#a6e22e>join</span>(result, <span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> join.<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>, <span style=color:#e6db74>&#34;\r\n&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Map<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getArticleNum</span>(Elements num) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (Objects.<span style=color:#a6e22e>isNull</span>(num)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Collections.<span style=color:#a6e22e>emptyMap</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (num.<span style=color:#a6e22e>isEmpty</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Collections.<span style=color:#a6e22e>emptyMap</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        Element reader <span style=color:#f92672>=</span> num.<span style=color:#a6e22e>get</span>(0);
</span></span><span style=display:flex><span>        Element post <span style=color:#f92672>=</span> num.<span style=color:#a6e22e>get</span>(1);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        TextNode node <span style=color:#f92672>=</span> (TextNode) reader.<span style=color:#a6e22e>childNodes</span>().<span style=color:#a6e22e>get</span>(0);
</span></span><span style=display:flex><span>        String text <span style=color:#f92672>=</span> node.<span style=color:#a6e22e>text</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        TextNode postNode <span style=color:#f92672>=</span> (TextNode) post.<span style=color:#a6e22e>childNodes</span>().<span style=color:#a6e22e>get</span>(0);
</span></span><span style=display:flex><span>        String text1 <span style=color:#f92672>=</span> postNode.<span style=color:#a6e22e>text</span>();
</span></span><span style=display:flex><span>        Map<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>(4);
</span></span><span style=display:flex><span>        map.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;reader&#34;</span>, Integer.<span style=color:#a6e22e>parseInt</span>(text));
</span></span><span style=display:flex><span>        map.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;post&#34;</span>, Integer.<span style=color:#a6e22e>parseInt</span>(text1));
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> map;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getArticleAvatar</span>(Elements avatar) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (Objects.<span style=color:#a6e22e>isNull</span>(avatar)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (avatar.<span style=color:#a6e22e>isEmpty</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        Element element <span style=color:#f92672>=</span> avatar.<span style=color:#a6e22e>get</span>(0);
</span></span><span style=display:flex><span>        String avatarUrl <span style=color:#f92672>=</span> element.<span style=color:#a6e22e>attributes</span>().<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;src&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> bytes <span style=color:#f92672>=</span> HttpUtil.<span style=color:#a6e22e>downloadBytes</span>(avatarUrl);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;data:image/jpeg;base64,&#34;</span> <span style=color:#f92672>+</span> Base64.<span style=color:#a6e22e>getEncoder</span>().<span style=color:#a6e22e>encodeToString</span>(bytes);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 解析node详情，需要递归，text node/element
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param element element
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return list
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>parseNode</span>(Element element) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (Objects.<span style=color:#a6e22e>isNull</span>(element)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>Node<span style=color:#f92672>&gt;</span> nodes <span style=color:#f92672>=</span> element.<span style=color:#a6e22e>childNodes</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (CollectionUtils.<span style=color:#a6e22e>isEmpty</span>(nodes)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> result <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (Node node : nodes) {
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>Node<span style=color:#f92672>&gt;</span> textNodeList <span style=color:#f92672>=</span> node.<span style=color:#a6e22e>childNodes</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (CollectionUtils.<span style=color:#a6e22e>isEmpty</span>(textNodeList)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (node <span style=color:#66d9ef>instanceof</span> TextNode) {
</span></span><span style=display:flex><span>                    result.<span style=color:#a6e22e>add</span>(((TextNode) node).<span style=color:#a6e22e>text</span>());
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                    result.<span style=color:#a6e22e>add</span>(node.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> subList <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (Node text : textNodeList) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (Objects.<span style=color:#a6e22e>isNull</span>(text)) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (text <span style=color:#66d9ef>instanceof</span> TextNode) {
</span></span><span style=display:flex><span>                    subList.<span style=color:#a6e22e>add</span>(((TextNode) text).<span style=color:#a6e22e>text</span>());
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (text <span style=color:#66d9ef>instanceof</span> Element) {
</span></span><span style=display:flex><span>                    List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> parseNode((Element) text);
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> (CollectionUtils.<span style=color:#a6e22e>isNotEmpty</span>(list)) {
</span></span><span style=display:flex><span>                        subList.<span style=color:#a6e22e>add</span>(StringUtils.<span style=color:#a6e22e>join</span>(list, <span style=color:#e6db74>&#34;&#34;</span>));
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                    subList.<span style=color:#a6e22e>add</span>(text.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            result.<span style=color:#a6e22e>add</span>(StringUtils.<span style=color:#a6e22e>join</span>(subList, <span style=color:#e6db74>&#34;&#34;</span>));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> result;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h1 id=前端页面展示>前端页面展示<a hidden class=anchor aria-hidden=true href=#前端页面展示>#</a></h1><p>由于我是前端废，找了个开源的导航项目当模板，找我的前端朋友改了一下。</p><p>开源项目地址如下: <a href=https://github.com/jic999/moon-web-start>https://github.com/jic999/moon-web-start</a></p><p>经过修改的前端项目地址如下: <a href=https://github.com/gloaming123/moon-web-start>https://github.com/gloaming123/moon-web-start</a></p><p>后端代码项目地址如下: <a href=https://github.com/thend03/xiaobot-spider>https://github.com/thend03/xiaobot-spider</a></p><p>这个导航项目自动github pages部署，可以直接在仓库的actions点击运行，可以在job的运行日志里得到页面访问地址。</p><p>为了优化加载速度，我这边生成的详情，将专栏的头像转成了base64，前端再将base64转成本地图片，优化了加载速度。</p><h1 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h1><p>那么经过一系列的勾兑，就拿到了专栏的详情。</p><p>总得来说，后端就是使用了http+jsoup解析了页面，没有什么难的。对api熟悉的话速度会更快一点。</p><p>没有涉及大规模的爬虫，算是一次简单的尝试吧。</p><p>对我来说难的果然还是前端呀，需要我的前端合伙人持续发力，实现前端页面了。</p><p>前端地址，那个专属分销码需要自己替换，由于我不懂前端，没法给出详细的使用说明，我自己的分销码是我的前端朋友帮我专门写到一个分支里了。</p><p>另外爬精选列表，只能拿到部分上推荐的专栏，其他不在推荐里的，要么去其他的导航站爬，要么靠其他散落的地方传播了。</p><p>小报童的专栏价格都不大贵，适合当知识付费的小册来购买，有的可以来点启发我觉得就能值回票价了。</p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://blog.thend03.com/img/wechat-pay.png alt=wechat_pay></a><p>微信</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://blog.thend03.com/img/alipay.png alt=alipay></a><p>支付宝</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>🧧 鼓励</span></button></div></div><footer class=post-footer><nav class=paginav><a class=next href=https://blog.thend03.com/posts/incorrect-use-of-grep/><span class=title>下一页 »</span><br><span>grep使用不当引起的惨案</span></a></nav></footer></div><style>.comments_details summary::marker{font-size:20px;content:'👉展开评论';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'👇关闭评论';color:var(--content)}</style><div><details class=comments_details><summary style="cursor:pointer;margin:50px 0 20px;width:130px"><span style=font-size:20px;color:var(--content)>...</span></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>twikoo.init({envId:null,el:"#tcomment",lang:"zh-CN",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><span>Copyright
&copy;
2020-2024
<a href=https://blog.thend03.com/ style=color:#939393>Fayy&amp;Fc's Blog</a>
All Rights Reserved
</span><a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src style="float:left;margin:0 5px 0 0">
</a></span><span id=busuanzi_container><span class="fa fa-user"></span> <span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye"></span> <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString(),s=window.getSelection().toString();t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="复制";function i(){t.innerText="已复制！",setTimeout(()=>{t.innerText="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>